import{m as C,h as M,k as u,j as S,r as f,b as y,g as b,w as I,e as n,H as g,t as v,d as s,u as t,ao as q,ap as k,I as T,z as B}from"./index-9a3d44ca.js";import{T as O}from"./Link-b1fdcf99.js";const z={class:"flex flex-col gap-4"},H={class:"flex sm:flex-row flex-col gap-4"},J={class:"flex-1"},L={class:"mb-1.5 text-sm text-gray-600"},P=n("span",{class:"text-red-500"},"*",-1),$={class:"flex-1"},A={class:"mb-1.5 text-sm text-gray-600"},G={class:"mb-1.5 text-sm text-gray-600"},K=n("span",{class:"text-red-500"},"*",-1),Q={class:"mb-1.5 text-sm text-gray-600"},W=n("span",{class:"text-red-500"},"*",-1),ee={__name:"EmailTemplateModal",props:C({emailTemplate:{type:Object,default:{}}},{modelValue:{},modelModifiers:{},reloadEmailTemplates:{},reloadEmailTemplatesModifiers:{}}),emits:C(["after"],["update:modelValue","update:reloadEmailTemplates"]),setup(p,{emit:X}){const _=p,r=M(p,"modelValue"),D=M(p,"reloadEmailTemplates"),m=u(""),V=u(null),w=u(null),d=u(!1);let a=u({});async function R(){if(!E())return;const e={..._.emailTemplate},l={...a.value},i=e.name!==l.name;delete e.name,delete l.name;const c=JSON.stringify(e)!==JSON.stringify(l),h=l;if(!i&&!c){r.value=!1;return}i&&await U(),c&&await j(h),x()}async function U(){return await T("frappe.client.rename_doc",{doctype:"Email Template",old_name:_.emailTemplate.name,new_name:a.value.name})}async function j(e){return(await T("frappe.client.set_value",{doctype:"Email Template",name:a.value.name,fieldname:e})).name}async function N(){if(!E())return;(await T("frappe.client.insert",{doc:{doctype:"Email Template",...a.value}})).name&&x()}function x(e){var l;(l=D.value)==null||l.reload(),r.value=!1}function E(){return a.value.name?a.value.subject?!a.value.response||a.value.response==="<p></p>"?(m.value="Content is required",!1):!0:(m.value="Subject is required",!1):(m.value="Name is required",!1)}return S(()=>r.value,e=>{e&&(d.value=!1,m.value="",B(()=>{a.value.name?V.value.el.focus():w.value.el.focus(),a.value={..._.emailTemplate},a.value.name&&(d.value=!0)}))}),(e,l)=>{const i=f("TextInput"),c=f("FormControl"),h=f("ErrorMessage"),F=f("Dialog");return y(),b(F,{modelValue:r.value,"onUpdate:modelValue":l[7]||(l[7]=o=>r.value=o),options:{title:d.value?e.__(p.emailTemplate.name):e.__("Create Email Template"),size:"xl",actions:[{label:d.value?e.__("Update"):e.__("Create"),variant:"solid",onClick:()=>d.value?R():N()}]}},{"body-content":I(()=>[n("div",z,[n("div",H,[n("div",J,[n("div",L,[g(v(e.__("Name"))+" ",1),P]),s(i,{ref_key:"nameRef",ref:w,variant:"outline",modelValue:t(a).name,"onUpdate:modelValue":l[0]||(l[0]=o=>t(a).name=o),placeholder:e.__("Payment Reminder")},null,8,["modelValue","placeholder"])]),n("div",$,[n("div",A,v(e.__("Doctype")),1),s(t(q),{variant:"outline",modelValue:t(a).reference_doctype,"onUpdate:modelValue":l[1]||(l[1]=o=>t(a).reference_doctype=o),options:["CRM Deal","CRM Lead"],placeholder:e.__("CRM Deal")},null,8,["modelValue","placeholder"])])]),n("div",null,[n("div",G,[g(v(e.__("Subject"))+" ",1),K]),s(i,{ref_key:"subjectRef",ref:V,variant:"outline",modelValue:t(a).subject,"onUpdate:modelValue":l[2]||(l[2]=o=>t(a).subject=o),placeholder:e.__("Payment Reminder from Frappé - (#{{ name }})")},null,8,["modelValue","placeholder"])]),n("div",null,[n("div",Q,[g(v(e.__("Content"))+" ",1),W]),t(a).use_html?(y(),b(c,{key:0,type:"textarea",variant:"outline",ref:"content",rows:10,modelValue:t(a).response_html,"onUpdate:modelValue":l[3]||(l[3]=o=>t(a).response_html=o),placeholder:e.__(`<p>Dear {{ lead_name }},</p>

<p>This is a reminder for the payment of {{ grand_total }}.</p>

<p>Thanks,</p>
<p>Frappé</p>`)},null,8,["modelValue","placeholder"])):(y(),b(t(O),{key:1,variant:"outline",ref:"content","editor-class":"!prose-sm overflow-auto min-h-[180px] max-h-80 py-1.5 px-2 rounded border border-gray-300 bg-white hover:border-gray-400 hover:shadow-sm focus:bg-white focus:border-gray-500 focus:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-gray-400 text-gray-800 transition-colors",bubbleMenu:!0,content:t(a).response,onChange:l[4]||(l[4]=o=>t(a).response=o),placeholder:e.__(`Dear {{ lead_name }}, 

This is a reminder for the payment of {{ grand_total }}. 

Thanks, 
Frappé`)},null,8,["content","placeholder"]))]),n("div",null,[s(t(k),{modelValue:t(a).enabled,"onUpdate:modelValue":l[5]||(l[5]=o=>t(a).enabled=o),label:e.__("Enabled")},null,8,["modelValue","label"])]),n("div",null,[s(t(k),{modelValue:t(a).use_html,"onUpdate:modelValue":l[6]||(l[6]=o=>t(a).use_html=o),label:e.__("Use HTML")},null,8,["modelValue","label"])]),s(h,{message:e.__(m.value)},null,8,["message"])])]),_:1},8,["modelValue","options"])}}};export{ee as _};
//# sourceMappingURL=EmailTemplateModal-8f279830.js.map
