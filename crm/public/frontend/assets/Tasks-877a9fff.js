import{m as K,h as H,i as P,s as Z,j as N,k as h,r as B,b as s,c as n,d as a,w as u,u as m,F as D,f as O,g as y,n as J,l as k,e as x,t as $,p as W,q as ee,v as te,I as se}from"./index-9a3d44ca.js";import{_ as oe}from"./CustomActions-dd6491ed.js";import{A as ae}from"./ArrowUpRightIcon-4de3e6ce.js";import{d as j,k as S,_ as Y,t as le,a as ne}from"./index-23e032df.js";import{E as ie}from"./EmailIcon-5d882006.js";import{_ as re,a as ue}from"./LayoutHeader-f400e0a9.js";import{_ as de}from"./ViewControls-4002c267.js";import{_ as ce,H as G,a as pe,f as me,b as fe,g as _e,c as ke,d as ve,e as ye}from"./ListBulkActions-9fa5be79.js";import{C as ge}from"./CalendarIcon-e7721136.js";import{_ as I,b as q}from"./global-005ed632.js";import{D as Q}from"./Dropdown-d1bc143c.js";import{_ as be}from"./ListFooter-3ed6863c.js";import{_ as Ce}from"./KanbanView-ad95323d.js";import{T as we}from"./TaskModal-74495bbe.js";import{T as he}from"./Link-b1fdcf99.js";import"./settings-5e848745.js";import"./DetailsIcon-e1b98c12.js";import"./NestedPopover-767b5999.js";import"./EditIcon-5c615a04.js";import"./views-43c0d23f.js";import"./FadedScrollableDiv-3ad27946.js";import"./DragVerticalIcon-21aa16a4.js";import"./AssignmentModal-b9aa1b53.js";import"./label-c0466358.js";import"./IndicatorIcon-8bdc1dd8.js";const xe={key:0},$e={class:"flex items-center gap-2 truncate text-base"},Me={key:0,class:"truncate"},Ve={key:0},Te={key:1},Le={key:2},Ue=["onClick"],Ae={key:1},ze={key:2},Re=["onClick"],De={__name:"TasksListView",props:K({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:K(["loadMore","updatePageCount","showTask","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(v,{expose:E,emit:z}){const b=z,M=H(v,"modelValue"),i=H(v,"list"),T=P(()=>{var o,c;return!!((c=(o=i.value.params)==null?void 0:o.filters)!=null&&c._liked_by)}),{user:L}=Z();function V(o){if(o)return JSON.parse(o).includes(L)}N(M,(o,c)=>{o!==c&&b("updatePageCount",o)});const C=h(null);return E({customListActions:P(()=>{var o;return(o=C.value)==null?void 0:o.customListActions})}),(o,c)=>{const U=B("Button"),R=B("FormControl");return s(),n(D,null,[a(m(ve),{columns:v.columns,rows:v.rows,options:{onRowClick:r=>b("showTask",r.name),selectable:v.options.selectable,showTooltip:v.options.showTooltip,resizeColumn:v.options.resizeColumn},"row-key":"name"},{default:u(()=>[a(m(ce),{class:"mx-3 sm:mx-5",onColumnWidthUpdated:c[1]||(c[1]=r=>b("columnWidthUpdated"))},{default:u(()=>[(s(!0),n(D,null,O(v.columns,r=>(s(),y(m(pe),{key:r.key,item:r,onColumnWidthUpdated:w=>b("columnWidthUpdated",r)},{default:u(()=>[r.key=="_liked_by"?(s(),y(U,{key:0,variant:"ghosted",class:J(["!h-4",T.value?"fill-red-500":"fill-white"]),onClick:c[0]||(c[0]=()=>b("applyLikeFilter"))},{default:u(()=>[a(G,{class:"h-4 w-4"})]),_:1},8,["class"])):k("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),a(m(me),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:u(()=>[(s(!0),n(D,null,O(v.rows,r=>(s(),y(m(_e),{key:r.name,row:r},{default:u(({idx:w,column:g,item:f})=>[g.key==="due_date"?(s(),n("div",xe,[a(m(I),{text:m(j)(f,"ddd, MMM D, YYYY | hh:mm a")},{default:u(()=>[x("div",$e,[a(ge),f?(s(),n("div",Me,$(m(j)(f,"D MMM, hh:mm a")),1)):k("",!0)])]),_:2},1032,["text"])])):(s(),y(m(fe),{key:1,item:f},{prefix:u(()=>[g.key==="status"?(s(),n("div",Ve,[a(S,{status:f},null,8,["status"])])):g.key==="priority"?(s(),n("div",Te,[a(Y,{priority:f},null,8,["priority"])])):g.key==="assigned_to"?(s(),n("div",Le,[f.full_name?(s(),y(m(q),{key:0,class:"flex items-center",image:f.user_image,label:f.full_name,size:"sm"},null,8,["image","label"])):k("",!0)])):k("",!0)]),default:u(({label:F})=>[["modified","creation"].includes(g.key)?(s(),n("div",{key:0,class:"truncate text-base",onClick:A=>b("applyFilter",{event:A,idx:w,column:g,item:f,firstColumn:v.columns[0]})},[a(m(I),{text:f.label},{default:u(()=>[x("div",null,$(f.timeAgo),1)]),_:2},1032,["text"])],8,Ue)):g.type==="Check"?(s(),n("div",Ae,[a(R,{type:"checkbox",modelValue:f,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):g.key==="_liked_by"?(s(),n("div",ze,[g.key=="_liked_by"?(s(),y(U,{key:0,variant:"ghosted",class:J(V(f)?"fill-red-500":"fill-white"),onClick:W(()=>b("likeDoc",{name:r.name,liked:V(f)}),["stop","prevent"])},{default:u(()=>[a(G,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):k("",!0)])):(s(),n("div",{key:3,class:"truncate text-base",onClick:A=>b("applyFilter",{event:A,idx:w,column:g,item:f,firstColumn:v.columns[0]})},$(F),9,Re))]),_:2},1032,["item"]))]),_:2},1032,["row"]))),128))]),_:1}),a(m(ke),null,{actions:u(({selections:r,unselectAll:w})=>[a(m(Q),{options:C.value.bulkActions(r,w)},{default:u(()=>[a(U,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},8,["columns","rows","options"]),a(m(be),{class:"border-t px-3 py-2 sm:px-5",modelValue:M.value,"onUpdate:modelValue":c[2]||(c[2]=r=>M.value=r),options:{rowCount:v.options.rowCount,totalCount:v.options.totalCount},onLoadMore:c[3]||(c[3]=r=>b("loadMore"))},null,8,["modelValue","options"]),a(ye,{ref_key:"listBulkActionsRef",ref:C,modelValue:i.value,"onUpdate:modelValue":c[4]||(c[4]=r=>i.value=r),doctype:"CRM Task",options:{hideAssign:!0}},null,8,["modelValue"])],64)}}},Be={class:"flex items-center gap-2"},Ie={key:0},Ee={key:1},Fe={key:2},Pe={key:3,class:"truncate text-base"},We={key:4,class:"truncate text-base"},je={key:5,class:"text-gray-500"},Se={key:0,class:"truncate flex items-center gap-2"},Ye={key:0},qe={key:1},Ke={key:2},He={key:3,class:"truncate text-base"},Oe={key:4,class:"truncate text-base max-h-44"},Je={key:5,class:"truncate text-base"},Ge={class:"flex gap-2 items-center justify-between"},Qe={key:2,class:"flex h-full items-center justify-center"},Xe={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},ht={__name:"Tasks",setup(v){const E=[{label:__("Tasks"),route:{name:"Tasks"}}],{getUser:z}=ee(),b=te(),M=h(null),i=h({}),T=h(1),L=h(1),V=h(20),C=h(null);function o(l,t){var _;function d(e){return e&&typeof e=="object"?e:{label:e}}return d((_=c.value)==null?void 0:_.find(e=>e.name==l)[t])}const c=P(()=>{var l,t,d;return(t=(l=i.value)==null?void 0:l.data)!=null&&t.data?i.value.data.view_type==="kanban"?U(i.value.data.data):R((d=i.value)==null?void 0:d.data.data):[]});function U(l){let t=[];return l.forEach(d=>{var _;(_=d.data)==null||_.forEach(e=>{t.push(e)})}),R(t)}function R(l){return l.map(t=>{var _;let d={};return(_=i.value)==null||_.data.rows.forEach(e=>{d[e]=t[e],["modified","creation"].includes(e)?d[e]={label:j(t[e],ne),timeAgo:__(le(t[e]))}:e=="assigned_to"&&(d[e]={label:t.assigned_to&&z(t.assigned_to).full_name,...t.assigned_to&&z(t.assigned_to)})}),d})}const r=h(!1),w=h({name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""});function g(l){var d,_;let t=(d=c.value)==null?void 0:d.find(e=>e.name===l);w.value={name:t.name,title:t.title,description:t.description,assigned_to:((_=t.assigned_to)==null?void 0:_.email)||"",due_date:t.due_date,status:t.status,priority:t.priority,reference_doctype:t.reference_doctype,reference_docname:t.reference_docname},r.value=!0}function f(l){var t;if(w.value={name:"",title:"",description:"",assigned_to:"",due_date:"",status:"Backlog",priority:"Low",reference_doctype:"CRM Lead",reference_docname:""},(t=l.column)!=null&&t.name){let d=i.value.params.column_field;d&&(w.value[d]=l.column.name)}r.value=!0}function F(l){return[{label:__("Delete"),icon:"trash-2",onClick:()=>{A(l),i.value.reload()}}]}async function A(l){await se("frappe.client.delete",{doctype:"CRM Task",name:l})}function X(l,t){if(!t)return;let d=l=="CRM Deal"?"Deal":"Lead",_={leadId:t};d=="Deal"&&(_={dealId:t}),b.push({name:d,params:_})}return(l,t)=>{const d=B("FeatherIcon"),_=B("Button");return s(),n(D,null,[a(re,null,{"left-header":u(()=>[a(m(ue),{items:E})]),"right-header":u(()=>{var e;return[(e=M.value)!=null&&e.customListActions?(s(),y(oe,{key:0,actions:M.value.customListActions},null,8,["actions"])):k("",!0),a(_,{variant:"solid",label:l.__("Create"),onClick:f},{prefix:u(()=>[a(d,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),a(de,{ref_key:"viewControls",ref:C,modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),loadMore:T.value,"onUpdate:loadMore":t[1]||(t[1]=e=>T.value=e),resizeColumn:L.value,"onUpdate:resizeColumn":t[2]||(t[2]=e=>L.value=e),updatedPageCount:V.value,"onUpdate:updatedPageCount":t[3]||(t[3]=e=>V.value=e),doctype:"CRM Task",options:{allowedViews:["list","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),l.$route.params.viewType=="kanban"&&c.value.length?(s(),y(Ce,{key:0,modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=e=>i.value=e),options:{onClick:e=>g(e.name),onNewClick:e=>f(e)},onUpdate:t[6]||(t[6]=e=>C.value.updateKanbanSettings(e)),onLoadMore:t[7]||(t[7]=e=>C.value.loadMoreKanban(e))},{title:u(({titleField:e,itemName:p})=>[x("div",Be,[e==="status"?(s(),n("div",Ie,[a(S,{status:o(p,e).label},null,8,["status"])])):e==="priority"?(s(),n("div",Ee,[a(Y,{priority:o(p,e).label},null,8,["priority"])])):e==="assigned_to"?(s(),n("div",Fe,[o(p,e).full_name?(s(),y(m(q),{key:0,class:"flex items-center",image:o(p,e).user_image,label:o(p,e).full_name,size:"sm"},null,8,["image","label"])):k("",!0)])):k("",!0),["modified","creation"].includes(e)?(s(),n("div",Pe,[a(m(I),{text:o(p,e).label},{default:u(()=>[x("div",null,$(o(p,e).timeAgo),1)]),_:2},1032,["text"])])):o(p,e).label?(s(),n("div",We,$(o(p,e).label),1)):(s(),n("div",je,$(l.__("No Title")),1))])]),fields:u(({fieldName:e,itemName:p})=>[o(p,e).label?(s(),n("div",Se,[e==="status"?(s(),n("div",Ye,[a(S,{class:"size-3",status:o(p,e).label},null,8,["status"])])):e==="priority"?(s(),n("div",qe,[a(Y,{priority:o(p,e).label},null,8,["priority"])])):e==="assigned_to"?(s(),n("div",Ke,[o(p,e).full_name?(s(),y(m(q),{key:0,class:"flex items-center",image:o(p,e).user_image,label:o(p,e).full_name,size:"sm"},null,8,["image","label"])):k("",!0)])):k("",!0),["modified","creation"].includes(e)?(s(),n("div",He,[a(m(I),{text:o(p,e).label},{default:u(()=>[x("div",null,$(o(p,e).timeAgo),1)]),_:2},1032,["text"])])):e=="description"?(s(),n("div",Oe,[o(p,e).label?(s(),y(m(he),{key:0,content:o(p,e).label,editable:!1,"editor-class":"!prose-sm max-w-none focus:outline-none",class:"flex-1 overflow-hidden"},null,8,["content"])):k("",!0)])):(s(),n("div",Je,$(o(p,e).label),1))])):k("",!0)]),actions:u(({itemName:e})=>[x("div",Ge,[x("div",null,[o(e,"reference_docname").label?(s(),y(_,{key:0,class:"-ml-2",variant:"ghost",size:"sm",label:o(e,"reference_doctype").label=="CRM Deal"?l.__("Deal"):l.__("Lead"),onClick:W(p=>X(o(e,"reference_doctype").label,o(e,"reference_docname").label),["stop"])},{suffix:u(()=>[a(ae,{class:"h-4 w-4"})]),_:2},1032,["label","onClick"])):k("",!0)]),a(m(Q),{class:"flex items-center gap-2",options:F(e),variant:"ghost",onClick:t[4]||(t[4]=W(()=>{},["stop","prevent"]))},{default:u(()=>[a(_,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):i.value.data&&c.value.length?(s(),y(De,{key:1,ref_key:"tasksListView",ref:M,modelValue:i.value.data.page_length_count,"onUpdate:modelValue":t[8]||(t[8]=e=>i.value.data.page_length_count=e),list:i.value,"onUpdate:list":t[9]||(t[9]=e=>i.value=e),rows:c.value,columns:i.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:i.value.data.row_count,totalCount:i.value.data.total_count},onLoadMore:t[10]||(t[10]=()=>T.value++),onColumnWidthUpdated:t[11]||(t[11]=()=>L.value++),onUpdatePageCount:t[12]||(t[12]=e=>V.value=e),onShowTask:g,onApplyFilter:t[13]||(t[13]=e=>C.value.applyFilter(e)),onApplyLikeFilter:t[14]||(t[14]=e=>C.value.applyLikeFilter(e)),onLikeDoc:t[15]||(t[15]=e=>C.value.likeDoc(e))},null,8,["modelValue","list","rows","columns","options"])):i.value.data?(s(),n("div",Qe,[x("div",Xe,[a(ie,{class:"h-10 w-10"}),x("span",null,$(l.__("No {0} Found",[l.__("Tasks")])),1),a(_,{label:l.__("Create"),onClick:t[16]||(t[16]=e=>r.value=!0)},{prefix:u(()=>[a(d,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):k("",!0),r.value?(s(),y(we,{key:3,modelValue:r.value,"onUpdate:modelValue":t[17]||(t[17]=e=>r.value=e),reloadTasks:i.value,"onUpdate:reloadTasks":t[18]||(t[18]=e=>i.value=e),task:w.value},null,8,["modelValue","reloadTasks","task"])):k("",!0)],64)}}};export{ht as default};
//# sourceMappingURL=Tasks-877a9fff.js.map
