import{_ as K}from"./CustomActions-dd6491ed.js";import{P as X}from"./PhoneIcon-2b0b9034.js";import{_ as Y,a as ee}from"./LayoutHeader-f400e0a9.js";import{_ as le}from"./ViewControls-4002c267.js";import{m as S,h as H,i as P,s as te,j as Z,k as w,r as D,b as n,c as d,d as c,w as p,u as f,F as U,f as W,g as $,n as N,l as M,e as g,t as F,p as oe,C as ae,_ as J,q as ne,v as se,B as E,D as T,E as re,G as ie,H as ue,I as ce,J as q}from"./index-9a3d44ca.js";import{_ as de,H as Q,a as me,f as pe,b as ve,g as _e,c as fe,d as ge,e as Ce}from"./ListBulkActions-9fa5be79.js";import{b as j,_ as O}from"./global-005ed632.js";import{D as ye}from"./Dropdown-d1bc143c.js";import{_ as ke}from"./ListFooter-3ed6863c.js";import{A as he}from"./ArrowUpRightIcon-4de3e6ce.js";import{D as be}from"./DurationIcon-31a1b254.js";import{C as we}from"./ContactsIcon-5941e60f.js";import{L as Le}from"./LeadsIcon-6f6c2324.js";import{D as xe}from"./DealsIcon-3bb51480.js";import{C as $e}from"./CalendarIcon-e7721136.js";import{N as Me,_ as Ve}from"./NoteModal-67a2219e.js";import{_ as Fe}from"./FadedScrollableDiv-3ad27946.js";import{s as Ie,d as De,t as Ue,a as Ae}from"./index-23e032df.js";import{c as Be}from"./contacts-111adff3.js";import"./settings-5e848745.js";import"./DetailsIcon-e1b98c12.js";import"./Link-b1fdcf99.js";import"./NestedPopover-767b5999.js";import"./EditIcon-5c615a04.js";import"./views-43c0d23f.js";import"./DragVerticalIcon-21aa16a4.js";import"./AssignmentModal-b9aa1b53.js";import"./label-c0466358.js";const Re={key:0},ze={key:1},Pe=["onClick"],Ne={key:1,class:"truncate text-base"},Te={key:2},Se={key:3},He=["onClick"],We={__name:"CallLogsListView",props:S({rows:{type:Array,required:!0},columns:{type:Array,required:!0},options:{type:Object,default:()=>({selectable:!0,showTooltip:!0,resizeColumn:!1,totalCount:0,rowCount:0})}},{modelValue:{},modelModifiers:{},list:{},listModifiers:{}}),emits:S(["loadMore","updatePageCount","columnWidthUpdated","applyFilter","applyLikeFilter","likeDoc"],["update:modelValue","update:list"]),setup(r,{expose:i,emit:C}){const o=C,k=H(r,"modelValue"),y=H(r,"list"),s=P(()=>{var l,u;return!!((u=(l=y.value.params)==null?void 0:l.filters)!=null&&u._liked_by)}),{user:L}=te();function x(l){if(l)return JSON.parse(l).includes(L)}Z(k,(l,u)=>{l!==u&&o("updatePageCount",l)});const m=w(null);return i({customListActions:P(()=>{var l;return(l=m.value)==null?void 0:l.customListActions})}),(l,u)=>{const h=D("Button"),t=D("FeatherIcon"),a=D("Badge"),I=D("FormControl");return n(),d(U,null,[c(f(ge),ae({columns:r.columns,rows:r.rows,options:{onRowClick:e=>o("showCallLog",e.name),selectable:r.options.selectable,showTooltip:r.options.showTooltip,resizeColumn:r.options.resizeColumn},"row-key":"name"},l.$attrs),{default:p(()=>[c(f(de),{class:"sm:mx-5 mx-3",onColumnWidthUpdated:u[1]||(u[1]=e=>o("columnWidthUpdated"))},{default:p(()=>[(n(!0),d(U,null,W(r.columns,e=>(n(),$(f(me),{key:e.key,item:e,onColumnWidthUpdated:b=>o("columnWidthUpdated",e)},{default:p(()=>[e.key=="_liked_by"?(n(),$(h,{key:0,variant:"ghosted",class:N(["!h-4",s.value?"fill-red-500":"fill-white"]),onClick:u[0]||(u[0]=()=>o("applyLikeFilter"))},{default:p(()=>[c(Q,{class:"h-4 w-4"})]),_:1},8,["class"])):M("",!0)]),_:2},1032,["item","onColumnWidthUpdated"]))),128))]),_:1}),c(f(pe),{class:"mx-3 sm:mx-5",id:"list-rows"},{default:p(()=>[(n(!0),d(U,null,W(r.rows,e=>(n(),$(f(_e),{key:e.name,row:e},{default:p(({idx:b,column:_,item:v})=>[c(f(ve),{item:v},{prefix:p(()=>[["caller","receiver"].includes(_.key)?(n(),d("div",Re,[v.label?(n(),$(f(j),{key:0,class:"flex items-center",image:v.image,label:v.label,size:"sm"},null,8,["image","label"])):M("",!0)])):["type","duration"].includes(_.key)?(n(),d("div",ze,[c(t,{name:v.icon,class:"h-3 w-3"},null,8,["name"])])):M("",!0)]),default:p(({label:A})=>[["modified","creation"].includes(_.key)?(n(),d("div",{key:0,class:"truncate text-base",onClick:V=>o("applyFilter",{event:V,idx:b,column:_,item:v,firstColumn:r.columns[0]})},[c(f(O),{text:v.label},{default:p(()=>[g("div",null,F(v.timeAgo),1)]),_:2},1032,["text"])],8,Pe)):_.key==="status"?(n(),d("div",Ne,[c(a,{variant:"subtle",theme:v.color,size:"md",label:l.__(v.label),onClick:V=>o("applyFilter",{event:V,idx:b,column:_,item:v,firstColumn:r.columns[0]})},null,8,["theme","label","onClick"])])):_.type==="Check"?(n(),d("div",Te,[c(I,{type:"checkbox",modelValue:v,disabled:!0,class:"text-gray-900"},null,8,["modelValue"])])):_.key==="_liked_by"?(n(),d("div",Se,[_.key=="_liked_by"?(n(),$(h,{key:0,variant:"ghosted",class:N(x(v)?"fill-red-500":"fill-white"),onClick:oe(()=>o("likeDoc",{name:e.name,liked:x(v)}),["stop","prevent"])},{default:p(()=>[c(Q,{class:"h-4 w-4"})]),_:2},1032,["class","onClick"])):M("",!0)])):(n(),d("div",{key:4,class:"truncate text-base",onClick:V=>o("applyFilter",{event:V,idx:b,column:_,item:v,firstColumn:r.columns[0]})},F(A),9,He))]),_:2},1032,["item"])]),_:2},1032,["row"]))),128))]),_:1}),c(f(fe),null,{actions:p(({selections:e,unselectAll:b})=>[c(f(ye),{options:m.value.bulkActions(e,b)},{default:p(()=>[c(h,{icon:"more-horizontal",variant:"ghost"})]),_:2},1032,["options"])]),_:1})]),_:1},16,["columns","rows","options"]),c(f(ke),{class:"border-t sm:px-5 px-3 py-2",modelValue:k.value,"onUpdate:modelValue":u[2]||(u[2]=e=>k.value=e),options:{rowCount:r.options.rowCount,totalCount:r.options.totalCount},onLoadMore:u[3]||(u[3]=e=>o("loadMore"))},null,8,["modelValue","options"]),c(Ce,{ref_key:"listBulkActionsRef",ref:m,modelValue:y.value,"onUpdate:modelValue":u[4]||(u[4]=e=>y.value=e),doctype:"CRM Call Log",options:{hideEdit:!0,hideAssign:!0}},null,8,["modelValue"])],64)}}},je={},Ee={width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},qe=g("g",{"clip-path":"url(#clip0_3668_69185)"},[g("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M14.25 8C14.25 11.4518 11.4518 14.25 8 14.25C4.54822 14.25 1.75 11.4518 1.75 8C1.75 4.54822 4.54822 1.75 8 1.75C11.4518 1.75 14.25 4.54822 14.25 8ZM15.25 8C15.25 12.0041 12.0041 15.25 8 15.25C3.99594 15.25 0.75 12.0041 0.75 8C0.75 3.99594 3.99594 0.75 8 0.75C12.0041 0.75 15.25 3.99594 15.25 8ZM11.2909 5.98482C11.4666 5.77175 11.4363 5.45663 11.2232 5.28096C11.0101 5.1053 10.695 5.13561 10.5193 5.34868L7.07001 9.53239L5.72845 7.79857C5.55946 7.58018 5.24543 7.54012 5.02703 7.70911C4.80863 7.8781 4.76858 8.19214 4.93756 8.41053L6.66217 10.6394C6.7552 10.7596 6.89788 10.831 7.04988 10.8334C7.20188 10.8357 7.3467 10.7688 7.4434 10.6515L11.2909 5.98482Z",fill:"currentColor"})],-1),Qe=g("defs",null,[g("clipPath",{id:"clip0_3668_69185"},[g("rect",{width:"16",height:"16",fill:"white"})])],-1),Ze=[qe,Qe];function Je(r,i){return n(),d("svg",Ee,Ze)}const Oe=J(je,[["render",Je]]),{getUser:B}=ne(),{getContact:R,getLeadContact:z}=Be();function G(r,i){var o,k,y,s,L,x,m,l;let C=i.type==="Incoming";return r==="caller"?{label:C?((o=R(i.from))==null?void 0:o.full_name)||((k=z(i.from))==null?void 0:k.full_name)||"Unknown":B(i.caller).full_name,image:C?((y=R(i.from))==null?void 0:y.image)||((s=z(i.from))==null?void 0:s.image):B(i.caller).user_image}:r==="receiver"?{label:C?B(i.receiver).full_name:((L=R(i.to))==null?void 0:L.full_name)||((x=z(i.to))==null?void 0:x.full_name)||"Unknown",image:C?B(i.receiver).user_image:((m=R(i.to))==null?void 0:m.image)||((l=z(i.to))==null?void 0:l.image)}:r==="duration"?{label:Ie(i.duration),icon:"clock"}:r==="type"?{label:i.type,icon:C?"phone-incoming":"phone-outgoing"}:r==="status"?{label:Ge[i.status],color:Ke[i.status]}:["modified","creation"].includes(r)?{label:De(i[r],Ae),timeAgo:__(Ue(i[r]))}:i[r]}const Ge={Completed:"Completed",Initiated:"Initiated",Busy:"Declined",Failed:"Failed",Queued:"Queued",Cancelled:"Cancelled",Ringing:"Ringing","No Answer":"Missed Call","In Progress":"In Progress"},Ke={Completed:"green",Busy:"orange",Failed:"red",Initiated:"gray",Queued:"gray",Cancelled:"gray",Ringing:"gray","No Answer":"red","In Progress":"blue"};const Xe={class:"flex items-center gap-3"},Ye={class:"text-2xl font-semibold leading-6 text-gray-900"},el={class:"flex flex-col gap-3.5"},ll={class:"grid size-7 place-content-center"},tl={class:"flex min-h-7 w-full items-center gap-2"},ol={key:0,class:"flex items-center gap-1"},al={class:"ml-1 flex flex-col gap-1"},nl={class:"ml-1 flex flex-col gap-1"},sl={key:2,class:"w-full"},rl=["src"],il=["innerHTML"],ul=["innerHTML"],cl={key:5},dl={__name:"CallLogModal",props:S({name:{type:String,default:{}}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r){const i=r,C=H(r,"modelValue"),o=w(!1),k=se(),y=w(null),s=w({}),L=P(()=>{var l;return s.value.doc?[{icon:E(T,{name:s.value.doc.type.icon,class:"h-3.5 w-3.5"}),name:"type",value:s.value.doc.type.label+" Call"},{icon:we,name:"receiver",value:{receiver:s.value.doc.receiver,caller:s.value.doc.caller}},{icon:s.value.doc.reference_doctype=="CRM Lead"?Le:xe,name:"reference_doctype",value:s.value.doc.reference_doctype=="CRM Lead"?"Lead":"Deal",link:()=>{s.value.doc.reference_doctype=="CRM Lead"?k.push({name:"Lead",params:{leadId:s.value.doc.reference_docname}}):k.push({name:"Deal",params:{dealId:s.value.doc.reference_docname}})},condition:()=>s.value.doc.reference_docname},{icon:$e,name:"creation",value:s.value.doc.creation.label,tooltip:s.value.doc.creation.label},{icon:be,name:"duration",value:s.value.doc.duration.label},{icon:Oe,name:"status",value:s.value.doc.status.label,color:s.value.doc.status.color},{icon:E(T,{name:"play-circle",class:"h-4 w-4 mt-2"}),name:"recording_url",value:s.value.doc.recording_url},{icon:Me,name:"note",value:(l=y.value)==null?void 0:l.doc}].filter(u=>u.value).filter(u=>u.condition?u.condition():!0):[]});function x(){ce("crm.fcrm.doctype.crm_call_log.crm_call_log.create_lead_from_call_log",{call_log:s.value.doc}).then(m=>{m&&k.push({name:"Lead",params:{leadId:m}})})}return Z(C,m=>{m&&(s.value=q({doctype:"CRM Call Log",name:i.name,fields:["name","caller","receiver","duration","type","status","from","to","note","recording_url","reference_doctype","reference_docname","creation"],cache:["call_log",i.name],auto:!0,transform:l=>{for(const u in l)l[u]=G(u,l);return l},onSuccess:l=>{if(!l.note){y.value=null;return}y.value=q({doctype:"FCRM Note",name:l.note,fields:["title","content"],cache:["note",l.note],auto:!0})}}))}),(m,l)=>{var t,a,I;const u=D("Button"),h=D("Dialog");return n(),d(U,null,[c(h,{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=e=>C.value=e)},re({"body-title":p(()=>[g("div",Xe,[g("h3",Ye,F(m.__("Call Details")),1)])]),"body-content":p(()=>[g("div",el,[(n(!0),d(U,null,W(L.value,e=>(n(),d("div",{key:e.name,class:"flex gap-2 text-base text-gray-800"},[g("div",ll,[(n(),$(ie(e.icon)))]),g("div",tl,[e.name=="receiver"?(n(),d("div",ol,[c(f(j),{image:e.value.caller.image,label:e.value.caller.label,size:"sm"},null,8,["image","label"]),g("div",al,F(e.value.caller.label),1),c(f(T),{name:"arrow-right",class:"mx-1 h-4 w-4 text-gray-600"}),c(f(j),{image:e.value.receiver.image,label:e.value.receiver.label,size:"sm"},null,8,["image","label"]),g("div",nl,F(e.value.receiver.label),1)])):e.tooltip?(n(),$(f(O),{key:1,text:e.tooltip},{default:p(()=>[ue(F(e.value),1)]),_:2},1032,["text"])):e.name=="recording_url"?(n(),d("div",sl,[g("audio",{class:"audio-control w-full",controls:"",src:e.value},null,8,rl)])):e.name=="note"?(n(),d("div",{key:3,class:"w-full cursor-pointer rounded border px-2 pt-1.5 text-base text-gray-700",onClick:l[0]||(l[0]=()=>o.value=!0)},[c(Fe,{class:"max-h-24 min-h-16 overflow-y-auto"},{default:p(()=>{var b,_,v,A,V;return[(b=e.value)!=null&&b.title?(n(),d("div",{key:0,class:N([(_=e.value)!=null&&_.content?"mb-1 font-bold":""]),innerHTML:(v=e.value)==null?void 0:v.title},null,10,il)):M("",!0),(A=e.value)!=null&&A.content?(n(),d("div",{key:1,innerHTML:(V=e.value)==null?void 0:V.content},null,8,ul)):M("",!0)]}),_:2},1024)])):(n(),d("div",{key:4,class:N(e.color?`text-${e.color}-600`:"")},F(e.value),3)),e.link?(n(),d("div",cl,[c(he,{class:"h-4 w-4 shrink-0 cursor-pointer text-gray-600 hover:text-gray-800",onClick:()=>e.link()},null,8,["onClick"])])):M("",!0)])]))),128))])]),_:2},[((t=s.value.doc)==null?void 0:t.type.label)=="Incoming"&&!((a=s.value.doc)!=null&&a.reference_docname)?{name:"actions",fn:p(()=>[c(u,{class:"w-full",variant:"solid",label:m.__("Create lead"),onClick:x},null,8,["label"])]),key:"0"}:void 0]),1032,["modelValue"]),c(Ve,{modelValue:o.value,"onUpdate:modelValue":l[2]||(l[2]=e=>o.value=e),note:(I=y.value)==null?void 0:I.doc},null,8,["modelValue","note"])],64)}}},ml=J(dl,[["__scopeId","data-v-f1ebee8d"]]),pl={key:1,class:"flex h-full items-center justify-center"},vl={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},jl={__name:"CallLogs",setup(r){const i=[{label:__("Call Logs"),route:{name:"Call Logs"}}],C=w(null),o=w({}),k=w(1),y=w(1),s=w(20),L=w(null),x=P(()=>{var h,t,a;return!((t=(h=o.value)==null?void 0:h.data)!=null&&t.data)||!["list","group_by"].includes(o.value.data.view_type)?[]:(a=o.value)==null?void 0:a.data.data.map(I=>{var b;let e={};return(b=o.value)==null||b.data.rows.forEach(_=>{e[_]=G(_,I)}),e})}),m=w(!1),l=w(null);function u(h){l.value=h,m.value=!0}return(h,t)=>(n(),d(U,null,[c(Y,null,{"left-header":p(()=>[c(f(ee),{items:i})]),"right-header":p(()=>{var a;return[(a=C.value)!=null&&a.customListActions?(n(),$(K,{key:0,actions:C.value.customListActions},null,8,["actions"])):M("",!0)]}),_:1}),c(le,{ref_key:"viewControls",ref:L,modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),loadMore:k.value,"onUpdate:loadMore":t[1]||(t[1]=a=>k.value=a),resizeColumn:y.value,"onUpdate:resizeColumn":t[2]||(t[2]=a=>y.value=a),updatedPageCount:s.value,"onUpdate:updatedPageCount":t[3]||(t[3]=a=>s.value=a),doctype:"CRM Call Log"},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),o.value.data&&x.value.length?(n(),$(We,{key:0,ref_key:"callLogsListView",ref:C,modelValue:o.value.data.page_length_count,"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.data.page_length_count=a),list:o.value,"onUpdate:list":t[5]||(t[5]=a=>o.value=a),rows:x.value,columns:o.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:o.value.data.row_count,totalCount:o.value.data.total_count},onShowCallLog:u,onLoadMore:t[6]||(t[6]=()=>k.value++),onColumnWidthUpdated:t[7]||(t[7]=()=>y.value++),onUpdatePageCount:t[8]||(t[8]=a=>s.value=a),onApplyFilter:t[9]||(t[9]=a=>L.value.applyFilter(a)),onApplyLikeFilter:t[10]||(t[10]=a=>L.value.applyLikeFilter(a)),onLikeDoc:t[11]||(t[11]=a=>L.value.likeDoc(a))},null,8,["modelValue","list","rows","columns","options"])):o.value.data?(n(),d("div",pl,[g("div",vl,[c(X,{class:"h-10 w-10"}),g("span",null,F(h.__("No {0} Found",[h.__("Logs")])),1)])])):M("",!0),c(ml,{modelValue:m.value,"onUpdate:modelValue":t[12]||(t[12]=a=>m.value=a),name:l.value},null,8,["modelValue","name"])],64))}};export{jl as default};
//# sourceMappingURL=CallLogs-a6592a05.js.map
