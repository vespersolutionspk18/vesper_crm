import{C as tr}from"./ContactsIcon-5941e60f.js";import{W as nr}from"./WhatsAppIcon-a922c570.js";import{P as ge}from"./PhoneIcon-2b0b9034.js";import{_ as mt,b as z,c as Z,al as rr,am as ir,e as V,h as ln,r as Te,g as ue,w as re,n as ye,t as ae,d as $,H as or,l as pe,u as q,q as dn,i as me,k as ee,a as fn,F as Me,V as pn,x as hn,J as ar,U as sr,v as cr,A as ur,L as dt,G as vn,ak as it,f as Ft,s as lr,C as mn,aC as N,j as dr,S as Bt,T as Vt,O as fr,M as pr,N as hr,p as je,I as Ue}from"./index-9a3d44ca.js";import{F as vr}from"./FileUploader-e02978ad.js";import{b as ze,_ as Wt,g as mr}from"./global-005ed632.js";import{F as _r}from"./Fields-bccd83f4.js";import{i as gr,m as yr,a as br}from"./settings-5e848745.js";import{C as Sr}from"./CRMLogo-c061fa7d.js";import{D as wr,j as Cr,m as Tr}from"./Dropdown-d1bc143c.js";import{N as Er,_ as Pr}from"./NoteModal-67a2219e.js";import{c as Ir}from"./contacts-111adff3.js";const kr={},_n=t=>(rr("data-v-3926adc3"),t=t(),ir(),t),Rr={class:"spinner",viewBox:"0 0 50 50"},Ar=_n(()=>V("defs",null,[V("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[V("stop",{offset:"0%","stop-color":"rgba(0,110,219,1)"}),V("stop",{offset:"100%","stop-color":"rgba(255,255,255,0)"})])],-1)),xr=_n(()=>V("circle",{stroke:"url(#gradient)",class:"spinner-path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"},null,-1)),Dr=[Ar,xr];function Or(t,n){return z(),Z("svg",Rr,Dr)}const Mr=mt(kr,[["render",Or],["__scopeId","data-v-3926adc3"]]),Lr={class:"flex flex-col items-center"},jr=["onClick"],Ur={class:"inline-block rounded-md bg-gray-900/60 px-2 py-1 text-white"},Nr=["src"],Fr={key:1,class:"h-64 w-64 rounded-full bg-gray-100"},Br={class:"mt-4 flex items-center gap-4"},Vr={__name:"ProfileImageEditor",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(t){const n=ln(t,"modelValue");function e(o){n.value.user_image=o}function r(o){let i=o.name.split(".").pop().toLowerCase();if(!["png","jpg"].includes(i))return"Only PNG and JPG images are allowed"}return(o,i)=>{const c=Te("ErrorMessage"),a=Te("Button");return z(),ue(q(vr),{onSuccess:i[1]||(i[1]=p=>e(p.file_url)),validateFile:r},{default:re(({file:p,progress:d,error:f,uploading:u,openFileSelector:l})=>[V("div",Lr,[V("button",{class:"group relative rounded-full border-2",onClick:l},[V("div",{class:ye(["absolute inset-0 grid place-items-center rounded-full bg-gray-400/20 text-base text-gray-600 transition-opacity",[u?"opacity-100":"opacity-0 group-hover:opacity-100","drop-shadow-sm"]])},[V("span",Ur,ae(u?`Uploading ${d}%`:n.value.user_image?"Change Image":"Upload Image"),1)],2),n.value.user_image?(z(),Z("img",{key:0,class:"h-64 w-64 rounded-full object-cover",src:n.value.user_image,alt:"Profile Photo"},null,8,Nr)):(z(),Z("div",Fr))],8,jr),$(c,{class:"mt-4",message:f},null,8,["message"]),V("div",Br,[n.value.user_image?(z(),ue(a,{key:0,onClick:i[0]||(i[0]=m=>e(null))},{default:re(()=>[or(" Remove ")]),_:1})):pe("",!0)])])]),_:1})}}},Wr={key:0,class:"flex w-full items-center justify-between p-12 pt-14"},Gr={class:"flex items-center gap-4"},Hr={class:"flex flex-col gap-1"},$r={class:"text-2xl font-semibold"},qr={class:"text-base text-gray-700"},zr={key:0,class:"space-y-4"},Jr={class:"flex items-center gap-4"},Kr={__name:"ProfileSettings",setup(t){const{getUser:n,users:e}=dn(),r=me(()=>n()||{}),o=ee(!1),i=ee(!1),c=ee({}),a=ee(!1);function p(){a.value=!0;const d={first_name:c.value.first_name,last_name:c.value.last_name,user_image:c.value.user_image};hn({url:"frappe.client.set_value",params:{doctype:"User",name:r.value.name,fieldname:d},auto:!0,onSuccess:()=>{a.value=!1,o.value=!1,e.reload()}})}return fn(()=>{c.value={...r.value}}),(d,f)=>{const u=Te("Button"),l=Te("FormControl");return c.value?(z(),Z("div",Wr,[V("div",Gr,[$(q(ze),{class:"!size-16",image:c.value.user_image,label:c.value.full_name},null,8,["image","label"]),V("div",Hr,[V("span",$r,ae(c.value.full_name),1),V("span",qr,ae(c.value.email),1)])]),$(u,{label:d.__("Edit profile"),onClick:f[0]||(f[0]=m=>o.value=!0)},null,8,["label"]),$(q(pn),{options:{title:d.__("Edit Profile")},modelValue:o.value,"onUpdate:modelValue":f[6]||(f[6]=m=>o.value=m),onAfterLeave:f[7]||(f[7]=m=>i.value=!1)},{"body-content":re(()=>[r.value?(z(),Z("div",zr,[i.value?(z(),ue(Vr,{key:0,modelValue:c.value,"onUpdate:modelValue":f[1]||(f[1]=m=>c.value=m)},null,8,["modelValue"])):(z(),Z(Me,{key:1},[V("div",Jr,[$(q(ze),{size:"lg",image:c.value.user_image,label:c.value.full_name},null,8,["image","label"]),$(u,{label:d.__("Edit Profile Photo"),onClick:f[2]||(f[2]=m=>i.value=!0)},null,8,["label"])]),$(l,{label:"First Name",modelValue:c.value.first_name,"onUpdate:modelValue":f[3]||(f[3]=m=>c.value.first_name=m)},null,8,["modelValue"]),$(l,{label:"Last Name",modelValue:c.value.last_name,"onUpdate:modelValue":f[4]||(f[4]=m=>c.value.last_name=m)},null,8,["modelValue"])],64))])):pe("",!0)]),actions:re(()=>[i.value?(z(),ue(u,{key:0,class:"mb-2 w-full",onClick:f[5]||(f[5]=m=>i.value=!1),label:d.__("Back")},null,8,["label"])):pe("",!0),$(u,{variant:"solid",class:"w-full",loading:a.value,onClick:p,label:d.__("Save")},null,8,["loading","label"])]),_:1},8,["options","modelValue"])])):pe("",!0)}}},Qr={class:"flex h-full flex-col gap-8"},Xr={class:"flex gap-2 text-xl font-semibold leading-none h-5"},Yr={key:0,class:"flex-1 overflow-y-auto"},Zr={key:1,class:"flex flex-1 items-center justify-center"},ei={class:"flex flex-row-reverse"},gn={__name:"SettingsPage",props:{doctype:{type:String,required:!0}},setup(t){const n=t,e=hn({url:"crm.api.doc.get_fields",cache:["fields",n.doctype],params:{doctype:n.doctype,allow_all_fieldtypes:!0},auto:!0}),r=ar({doctype:n.doctype,name:n.doctype,fields:["*"],cache:n.doctype,auto:!0}),o=me(()=>{if(!e.data)return[];let c=[],a=e.data;return a[0].type!=="Section Break"&&c.push({label:"General",hideLabel:!0,columns:1,fields:[]}),a.forEach(p=>{p.type==="Section Break"?c.push({label:p.value,hideLabel:!0,columns:1,fields:[]}):p.type==="Column Break"?c[c.length-1].columns+=1:c[c.length-1].fields.push({...p,name:p.value})}),c});function i(){r.save.submit()}return(c,a)=>{var d;const p=Te("Button");return z(),Z("div",Qr,[V("h2",Xr,[V("div",null,ae(c.__(t.doctype)),1),q(r).isDirty?(z(),ue(q(sr),{key:0,label:c.__("Not Saved"),variant:"subtle",theme:"orange"},null,8,["label"])):pe("",!0)]),q(r).get.loading?(z(),Z("div",Zr,[$(q(Mr),{class:"size-8"})])):(z(),Z("div",Yr,[(d=q(r))!=null&&d.doc&&o.value?(z(),ue(_r,{key:0,sections:o.value,data:q(r).doc},null,8,["sections","data"])):pe("",!0)])),V("div",ei,[$(p,{loading:q(r).save.loading,label:c.__("Update"),variant:"solid",onClick:i},null,8,["loading","label"])])])}}},ti={__name:"WhatsAppSettings",setup(t){return(n,e)=>(z(),ue(gn,{doctype:"WhatsApp Settings",class:"p-8"}))}},ni={__name:"TwilioSettings",setup(t){return(n,e)=>(z(),ue(gn,{doctype:"Twilio Settings",class:"p-8"}))}},ri={class:"flex items-center truncate"},ii={class:"grid flex-shrink-0 place-items-center"},oi={__name:"SidebarLink",props:{icon:{type:Object},label:{type:String,default:""},to:{type:[Object,String],default:""},isCollapsed:{type:Boolean,default:!1}},setup(t){const n=cr(),e=ur(),r=t;function o(){r.to&&(typeof r.to=="object"?n.push(r.to):n.push({name:r.to}),gr.value&&(yr.value=!1))}let i=me(()=>{var c,a;return e.query.view?e.query.view==((a=(c=r.to)==null?void 0:c.query)==null?void 0:a.view):e.name===r.to});return(c,a)=>{const p=Te("FeatherIcon");return z(),Z("button",{class:ye(["flex h-7 cursor-pointer items-center rounded text-gray-700 duration-300 ease-in-out focus:outline-none focus:transition-none focus-visible:rounded focus-visible:ring-2 focus-visible:ring-gray-400",q(i)?"bg-white shadow-sm":"hover:bg-gray-100"]),onClick:o},[V("div",{class:ye(["flex w-full items-center justify-between duration-300 ease-in-out",t.isCollapsed?"ml-[3px] p-1":"px-2 py-1"])},[V("div",ri,[$(q(Wt),{text:t.label,placement:"right",disabled:!t.isCollapsed},{default:re(()=>[dt(c.$slots,"icon",{},()=>[V("span",ii,[typeof t.icon=="string"?(z(),ue(p,{key:0,name:t.icon,class:"size-4.5 text-gray-700"},null,8,["name"])):(z(),ue(vn(t.icon),{key:1,class:"size-4.5 text-gray-700"}))])])]),_:3},8,["text","disabled"]),$(q(Wt),{text:t.label,placement:"right",disabled:t.isCollapsed,hoverDelay:1.5},{default:re(()=>[V("span",{class:ye(["flex-1 flex-shrink-0 truncate text-base duration-300 ease-in-out",t.isCollapsed?"ml-0 w-0 overflow-hidden opacity-0":"ml-2 w-auto opacity-100"])},ae(t.label),3)]),_:1},8,["text","disabled"])]),dt(c.$slots,"right")],2)],2)}}},ai={class:"flex h-[calc(100vh_-_8rem)]"},si={class:"flex w-52 shrink-0 flex-col bg-gray-50 p-2"},ci={class:"mb-3 px-2 pt-2 text-lg font-semibold"},ui={key:0,class:"mb-2 mt-3 flex cursor-pointer gap-1.5 px-1 text-base font-medium text-gray-600 transition-all duration-300 ease-in-out"},li={class:"space-y-1"},di={class:"flex flex-1 flex-col overflow-y-auto"},fi={__name:"SettingsModal",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(t){const n=ln(t,"modelValue"),e=me(()=>[{label:"Settings",hideLabel:!0,items:[{label:"Profile",icon:tr,component:it(Kr)}]},{label:"Integrations",items:[{label:"Twilio",icon:ge,component:it(ni)},{label:"WhatsApp",icon:nr,component:it(ti),condition:()=>br.value}]}].map(i=>(i.items=i.items.filter(c=>c.condition?c.condition():!0),i))),r=ee(e.value[0].items[0]);return(o,i)=>(z(),ue(q(pn),{modelValue:n.value,"onUpdate:modelValue":i[0]||(i[0]=c=>n.value=c),options:{size:"5xl"}},{body:re(()=>[V("div",ai,[V("div",si,[V("h1",ci,ae(o.__("Settings")),1),(z(!0),Z(Me,null,Ft(e.value,c=>(z(),Z("div",null,[c.hideLabel?pe("",!0):(z(),Z("div",ui,[V("span",null,ae(o.__(c.label)),1)])),V("nav",li,[(z(!0),Z(Me,null,Ft(c.items,a=>{var p;return z(),ue(oi,{icon:a.icon,label:o.__(a.label),class:ye(["w-full",((p=r.value)==null?void 0:p.label)==a.label?"bg-white shadow-sm":"hover:bg-gray-100"]),onClick:d=>r.value=a},null,8,["icon","label","class","onClick"])}),256))])]))),256))]),V("div",di,[r.value?(z(),ue(vn(r.value.component),{key:0})):pe("",!0)])])]),_:1},8,["modelValue"]))}},pi={class:"text-base font-medium leading-none text-gray-900"},hi={class:"mt-1 text-sm leading-none text-gray-700"},As={__name:"UserDropdown",props:{isCollapsed:{type:Boolean,default:!1}},setup(t){const{logout:n}=lr(),{getUser:e}=dn(),r=me(()=>e()||{}),o=ee(!1);let i=ee([{group:"Manage",hideLabel:!0,items:[{icon:"corner-up-left",label:me(()=>__("Switch to Desk")),onClick:()=>window.location.replace("/app")},{icon:"life-buoy",label:me(()=>__("Support")),onClick:()=>window.open("https://t.me/frappecrm","_blank")},{icon:"book-open",label:me(()=>__("Docs")),onClick:()=>window.open("https://docs.frappe.io/crm","_blank")}]},{group:"Others",hideLabel:!0,items:[{icon:"settings",label:me(()=>__("Settings")),onClick:()=>o.value=!0},{icon:"log-out",label:me(()=>__("Log out")),onClick:()=>n.submit()}]}]);return(c,a)=>{const p=Te("FeatherIcon");return z(),Z(Me,null,[$(q(wr),mn({options:q(i)},c.$attrs),{default:re(({open:d})=>[V("button",{class:ye(["flex h-12 items-center rounded-md py-2 duration-300 ease-in-out",t.isCollapsed?"w-auto px-0":d?"w-52 bg-white px-2 shadow-sm":"w-52 px-2 hover:bg-gray-200"])},[$(Sr,{class:"size-8 flex-shrink-0 rounded"}),V("div",{class:ye(["flex flex-1 flex-col text-left duration-300 ease-in-out",t.isCollapsed?"ml-0 w-0 overflow-hidden opacity-0":"ml-2 w-auto opacity-100"])},[V("div",pi,ae(c.__("CRM")),1),V("div",hi,ae(r.value.full_name),1)],2),V("div",{class:ye(["duration-300 ease-in-out",t.isCollapsed?"ml-0 w-0 overflow-hidden opacity-0":"ml-2 w-auto opacity-100"])},[$(p,{name:"chevron-down",class:"size-4 text-gray-600","aria-hidden":"true"})],2)],2)]),_:1},16,["options"]),o.value?(z(),ue(fi,{key:0,modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=d=>o.value=d)},null,8,["modelValue"])):pe("",!0)],64)}}},vi={},mi={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-minimize-2"},_i=V("polyline",{points:"4 14 10 14 10 20"},null,-1),gi=V("polyline",{points:"20 10 14 10 14 4"},null,-1),yi=V("line",{x1:"14",y1:"10",x2:"21",y2:"3"},null,-1),bi=V("line",{x1:"3",y1:"21",x2:"10",y2:"14"},null,-1),Si=[_i,gi,yi,bi];function wi(t,n){return z(),Z("svg",mi,Si)}const Ci=mt(vi,[["render",wi]]),Ti={__name:"CountUpTimer",setup(t,{expose:n}){const e=ee(0),r=ee(0),o=ee(0),i=ee(null),c=ee("0:00");function a(){o.value===59&&(o.value=0,r.value=r.value+1,o.value--),r.value===60&&(r.value=0,e.value=e.value+1),o.value++;let f=r.value,u=o.value<10?"0"+o.value:o.value,l=e.value>0?e.value+":":"";l&&(f=f<10?"0"+f:f,u=u<10?"0"+u:u,f===0&&(f="00")),c.value=l+f+":"+u}function p(){i.value=setInterval(()=>a(),1e3)}function d(){clearInterval(i.value);let f=c.value;return e.value=0,r.value=0,o.value=0,c.value="0:00",f}return n({start:p,stop:d,updatedTime:c}),(f,u)=>dt(f.$slots,"default")}};var yn={},Ne={},_t={exports:{}},Ae=typeof Reflect=="object"?Reflect:null,Gt=Ae&&typeof Ae.apply=="function"?Ae.apply:function(n,e,r){return Function.prototype.apply.call(n,e,r)},Ge;Ae&&typeof Ae.ownKeys=="function"?Ge=Ae.ownKeys:Object.getOwnPropertySymbols?Ge=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Ge=function(n){return Object.getOwnPropertyNames(n)};function Ei(t){console&&console.warn&&console.warn(t)}var bn=Number.isNaN||function(n){return n!==n};function X(){X.init.call(this)}_t.exports=X;_t.exports.once=Ri;X.EventEmitter=X;X.prototype._events=void 0;X.prototype._eventsCount=0;X.prototype._maxListeners=void 0;var Ht=10;function Qe(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(X,"defaultMaxListeners",{enumerable:!0,get:function(){return Ht},set:function(t){if(typeof t!="number"||t<0||bn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Ht=t}});X.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};X.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||bn(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function Sn(t){return t._maxListeners===void 0?X.defaultMaxListeners:t._maxListeners}X.prototype.getMaxListeners=function(){return Sn(this)};X.prototype.emit=function(n){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var o=n==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var c;if(e.length>0&&(c=e[0]),c instanceof Error)throw c;var a=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw a.context=c,a}var p=i[n];if(p===void 0)return!1;if(typeof p=="function")Gt(p,this,e);else for(var d=p.length,f=Pn(p,d),r=0;r<d;++r)Gt(f[r],this,e);return!0};function wn(t,n,e,r){var o,i,c;if(Qe(e),i=t._events,i===void 0?(i=t._events=Object.create(null),t._eventsCount=0):(i.newListener!==void 0&&(t.emit("newListener",n,e.listener?e.listener:e),i=t._events),c=i[n]),c===void 0)c=i[n]=e,++t._eventsCount;else if(typeof c=="function"?c=i[n]=r?[e,c]:[c,e]:r?c.unshift(e):c.push(e),o=Sn(t),o>0&&c.length>o&&!c.warned){c.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=n,a.count=c.length,Ei(a)}return t}X.prototype.addListener=function(n,e){return wn(this,n,e,!1)};X.prototype.on=X.prototype.addListener;X.prototype.prependListener=function(n,e){return wn(this,n,e,!0)};function Pi(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Cn(t,n,e){var r={fired:!1,wrapFn:void 0,target:t,type:n,listener:e},o=Pi.bind(r);return o.listener=e,r.wrapFn=o,o}X.prototype.once=function(n,e){return Qe(e),this.on(n,Cn(this,n,e)),this};X.prototype.prependOnceListener=function(n,e){return Qe(e),this.prependListener(n,Cn(this,n,e)),this};X.prototype.removeListener=function(n,e){var r,o,i,c,a;if(Qe(e),o=this._events,o===void 0)return this;if(r=o[n],r===void 0)return this;if(r===e||r.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[n],o.removeListener&&this.emit("removeListener",n,r.listener||e));else if(typeof r!="function"){for(i=-1,c=r.length-1;c>=0;c--)if(r[c]===e||r[c].listener===e){a=r[c].listener,i=c;break}if(i<0)return this;i===0?r.shift():Ii(r,i),r.length===1&&(o[n]=r[0]),o.removeListener!==void 0&&this.emit("removeListener",n,a||e)}return this};X.prototype.off=X.prototype.removeListener;X.prototype.removeAllListeners=function(n){var e,r,o;if(r=this._events,r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete r[n]),this;if(arguments.length===0){var i=Object.keys(r),c;for(o=0;o<i.length;++o)c=i[o],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=r[n],typeof e=="function")this.removeListener(n,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(n,e[o]);return this};function Tn(t,n,e){var r=t._events;if(r===void 0)return[];var o=r[n];return o===void 0?[]:typeof o=="function"?e?[o.listener||o]:[o]:e?ki(o):Pn(o,o.length)}X.prototype.listeners=function(n){return Tn(this,n,!0)};X.prototype.rawListeners=function(n){return Tn(this,n,!1)};X.listenerCount=function(t,n){return typeof t.listenerCount=="function"?t.listenerCount(n):En.call(t,n)};X.prototype.listenerCount=En;function En(t){var n=this._events;if(n!==void 0){var e=n[t];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}X.prototype.eventNames=function(){return this._eventsCount>0?Ge(this._events):[]};function Pn(t,n){for(var e=new Array(n),r=0;r<n;++r)e[r]=t[r];return e}function Ii(t,n){for(;n+1<t.length;n++)t[n]=t[n+1];t.pop()}function ki(t){for(var n=new Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];return n}function Ri(t,n){return new Promise(function(e,r){function o(c){t.removeListener(n,i),r(c)}function i(){typeof t.removeListener=="function"&&t.removeListener("error",o),e([].slice.call(arguments))}In(t,n,i,{once:!0}),n!=="error"&&Ai(t,o,{once:!0})})}function Ai(t,n,e){typeof t.on=="function"&&In(t,"error",n,e)}function In(t,n,e,r){if(typeof t.on=="function")r.once?t.once(n,e):t.on(n,e);else if(typeof t.addEventListener=="function")t.addEventListener(n,function o(i){r.once&&t.removeEventListener(n,o),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var ve=_t.exports,Xe={},xi=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(Xe,"__esModule",{value:!0});var Di=ve,Oi=function(t){xi(n,t);function n(e){var r=t.call(this)||this;return Object.defineProperties(r,{_attempts:{value:0,writable:!0},_duration:{enumerable:!1,get:function(){var o=this._min*Math.pow(this._factor,this._attempts);if(this._jitter){var i=Math.random(),c=Math.floor(i*this._jitter*o);o=Math.floor(i*10)&1?o+c:o-c}return Math.min(o,this._max)|0}},_factor:{value:e.factor||2},_jitter:{value:e.jitter>0&&e.jitter<=1?e.jitter:0},_max:{value:e.max||1e4},_min:{value:e.min||100},_timeoutID:{value:null,writable:!0}}),r}return n.prototype.backoff=function(){var e=this,r=this._duration;this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null),this.emit("backoff",this._attempts,r),this._timeoutID=setTimeout(function(){e.emit("ready",e._attempts,r),e._attempts++},r)},n.prototype.reset=function(){this._attempts=0,this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=null)},n}(Di.EventEmitter);Xe.default=Oi;var Fe={},kn={exports:{}};(function(t){(function(n,e){t.exports?t.exports=e():n.log=e()})(N,function(){var n=function(){},e="undefined",r=typeof window!==e&&typeof window.navigator!==e&&/Trident\/|MSIE /.test(window.navigator.userAgent),o=["trace","debug","info","warn","error"];function i(w,v){var b=w[v];if(typeof b.bind=="function")return b.bind(w);try{return Function.prototype.bind.call(b,w)}catch{return function(){return Function.prototype.apply.apply(b,[w,arguments])}}}function c(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(w){return w==="debug"&&(w="log"),typeof console===e?!1:w==="trace"&&r?c:console[w]!==void 0?i(console,w):console.log!==void 0?i(console,"log"):n}function p(w,v){for(var b=0;b<o.length;b++){var g=o[b];this[g]=b<w?n:this.methodFactory(g,w,v)}this.log=this.debug}function d(w,v,b){return function(){typeof console!==e&&(p.call(this,v,b),this[w].apply(this,arguments))}}function f(w,v,b){return a(w)||d.apply(this,arguments)}function u(w,v,b){var g=this,T,_="loglevel";w&&(_+=":"+w);function y(h){var L=(o[h]||"silent").toUpperCase();if(typeof window!==e){try{window.localStorage[_]=L;return}catch{}try{window.document.cookie=encodeURIComponent(_)+"="+L+";"}catch{}}}function S(){var h;if(typeof window!==e){try{h=window.localStorage[_]}catch{}if(typeof h===e)try{var L=window.document.cookie,U=L.indexOf(encodeURIComponent(_)+"=");U!==-1&&(h=/^([^;]+)/.exec(L.slice(U))[1])}catch{}return g.levels[h]===void 0&&(h=void 0),h}}g.name=w,g.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},g.methodFactory=b||f,g.getLevel=function(){return T},g.setLevel=function(h,L){if(typeof h=="string"&&g.levels[h.toUpperCase()]!==void 0&&(h=g.levels[h.toUpperCase()]),typeof h=="number"&&h>=0&&h<=g.levels.SILENT){if(T=h,L!==!1&&y(h),p.call(g,h,w),typeof console===e&&h<g.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+h},g.setDefaultLevel=function(h){S()||g.setLevel(h,!1)},g.enableAll=function(h){g.setLevel(g.levels.TRACE,h)},g.disableAll=function(h){g.setLevel(g.levels.SILENT,h)};var D=S();D==null&&(D=v??"WARN"),g.setLevel(D,!1)}var l=new u,m={};l.getLogger=function(v){if(typeof v!="string"||v==="")throw new TypeError("You must supply a name when creating a logger.");var b=m[v];return b||(b=m[v]=new u(v,l.getLevel(),l.methodFactory)),b};var E=typeof window!==e?window.log:void 0;return l.noConflict=function(){return typeof window!==e&&window.log===l&&(window.log=E),l},l.getLoggers=function(){return m},l})})(kn);var Rn=kn.exports,Be={},oe={},An={},gt={},Mi=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(gt,"__esModule",{value:!0});var Li=function(t){Mi(n,t);function n(e,r){var o=t.call(this)||this;Object.setPrototypeOf(o,n.prototype);var i=typeof e=="string"?e:o.explanation,c=typeof e=="object"?e:r;return o.message=o.name+" ("+o.code+"): "+i,o.originalError=c,o}return n}(Error);gt.default=Li;(function(t){var n=N&&N.__extends||function(){var l=function(m,E){return l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,v){w.__proto__=v}||function(w,v){for(var b in v)Object.prototype.hasOwnProperty.call(v,b)&&(w[b]=v[b])},l(m,E)};return function(m,E){l(m,E);function w(){this.constructor=m}m.prototype=E===null?Object.create(E):(w.prototype=E.prototype,new w)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.errorsByCode=t.MediaErrors=t.SignalingErrors=t.UserMediaErrors=t.MalformedRequestErrors=t.GeneralErrors=t.SIPServerErrors=t.ClientErrors=t.SignatureValidationErrors=t.AuthorizationErrors=t.TwilioError=void 0;var e=gt;t.TwilioError=e.default;var r;(function(l){var m=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=[],_.code=20101,_.description="Invalid access token",_.explanation="Twilio was unable to validate your Access Token",_.name="AccessTokenInvalid",_.solutions=[],Object.setPrototypeOf(_,l.AccessTokenInvalid.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.AccessTokenInvalid=m;var E=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=[],_.code=20104,_.description="Access token expired or expiration date invalid",_.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future",_.name="AccessTokenExpired",_.solutions=[],Object.setPrototypeOf(_,l.AccessTokenExpired.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.AccessTokenExpired=E;var w=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=[],_.code=20151,_.description="Authentication Failed",_.explanation="The Authentication with the provided JWT failed",_.name="AuthenticationFailed",_.solutions=[],Object.setPrototypeOf(_,l.AuthenticationFailed.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.AuthenticationFailed=w})(r=t.AuthorizationErrors||(t.AuthorizationErrors={}));var o;(function(l){var m=function(E){n(w,E);function w(v,b){var g=E.call(this,v,b)||this;g.causes=["The access token has an invalid Account SID, API Key, or API Key Secret."],g.code=31202,g.description="Signature validation failed.",g.explanation="The provided access token failed signature validation.",g.name="AccessTokenSignatureValidationFailed",g.solutions=["Ensure the Account SID, API Key, and API Key Secret are valid when generating your access token."],Object.setPrototypeOf(g,l.AccessTokenSignatureValidationFailed.prototype);var T=typeof v=="string"?v:g.explanation,_=typeof v=="object"?v:b;return g.message=g.name+" ("+g.code+"): "+T,g.originalError=_,g}return w}(e.default);l.AccessTokenSignatureValidationFailed=m})(o=t.SignatureValidationErrors||(t.SignatureValidationErrors={}));var i;(function(l){var m=function(b){n(g,b);function g(T,_){var y=b.call(this,T,_)||this;y.causes=[],y.code=31400,y.description="Bad Request (HTTP/SIP)",y.explanation="The request could not be understood due to malformed syntax.",y.name="BadRequest",y.solutions=[],Object.setPrototypeOf(y,l.BadRequest.prototype);var S=typeof T=="string"?T:y.explanation,D=typeof T=="object"?T:_;return y.message=y.name+" ("+y.code+"): "+S,y.originalError=D,y}return g}(e.default);l.BadRequest=m;var E=function(b){n(g,b);function g(T,_){var y=b.call(this,T,_)||this;y.causes=["The outbound call was made to an invalid phone number.","The TwiML application sid is missing a Voice URL."],y.code=31404,y.description="Not Found (HTTP/SIP)",y.explanation="The server has not found anything matching the request.",y.name="NotFound",y.solutions=["Ensure the phone number dialed is valid.","Ensure the TwiML application is configured correctly with a Voice URL link."],Object.setPrototypeOf(y,l.NotFound.prototype);var S=typeof T=="string"?T:y.explanation,D=typeof T=="object"?T:_;return y.message=y.name+" ("+y.code+"): "+S,y.originalError=D,y}return g}(e.default);l.NotFound=E;var w=function(b){n(g,b);function g(T,_){var y=b.call(this,T,_)||this;y.causes=[],y.code=31480,y.description="Temporarily Unavailable (SIP)",y.explanation="The callee is currently unavailable.",y.name="TemporarilyUnavailable",y.solutions=[],Object.setPrototypeOf(y,l.TemporarilyUnavailable.prototype);var S=typeof T=="string"?T:y.explanation,D=typeof T=="object"?T:_;return y.message=y.name+" ("+y.code+"): "+S,y.originalError=D,y}return g}(e.default);l.TemporarilyUnavailable=w;var v=function(b){n(g,b);function g(T,_){var y=b.call(this,T,_)||this;y.causes=[],y.code=31486,y.description="Busy Here (SIP)",y.explanation="The callee is busy.",y.name="BusyHere",y.solutions=[],Object.setPrototypeOf(y,l.BusyHere.prototype);var S=typeof T=="string"?T:y.explanation,D=typeof T=="object"?T:_;return y.message=y.name+" ("+y.code+"): "+S,y.originalError=D,y}return g}(e.default);l.BusyHere=v})(i=t.ClientErrors||(t.ClientErrors={}));var c;(function(l){var m=function(E){n(w,E);function w(v,b){var g=E.call(this,v,b)||this;g.causes=[],g.code=31603,g.description="Decline (SIP)",g.explanation="The callee does not wish to participate in the call.",g.name="Decline",g.solutions=[],Object.setPrototypeOf(g,l.Decline.prototype);var T=typeof v=="string"?v:g.explanation,_=typeof v=="object"?v:b;return g.message=g.name+" ("+g.code+"): "+T,g.originalError=_,g}return w}(e.default);l.Decline=m})(c=t.SIPServerErrors||(t.SIPServerErrors={}));var a;(function(l){var m=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31e3,h.description="Unknown Error",h.explanation="An unknown error has occurred. See error details for more information.",h.name="UnknownError",h.solutions=[],Object.setPrototypeOf(h,l.UnknownError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.UnknownError=m;var E=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31001,h.description="Application Not Found",h.explanation="",h.name="ApplicationNotFoundError",h.solutions=[],Object.setPrototypeOf(h,l.ApplicationNotFoundError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.ApplicationNotFoundError=E;var w=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31002,h.description="Connection Declined",h.explanation="",h.name="ConnectionDeclinedError",h.solutions=[],Object.setPrototypeOf(h,l.ConnectionDeclinedError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.ConnectionDeclinedError=w;var v=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31003,h.description="Connection Timeout",h.explanation="The server could not produce a response within a suitable amount of time.",h.name="ConnectionTimeoutError",h.solutions=[],Object.setPrototypeOf(h,l.ConnectionTimeoutError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.ConnectionTimeoutError=v;var b=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31005,h.description="Connection error",h.explanation="A connection error occurred during the call",h.name="ConnectionError",h.solutions=[],Object.setPrototypeOf(h,l.ConnectionError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.ConnectionError=b;var g=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=["The incoming call was cancelled because it was not answered in time or it was accepted/rejected by another application instance registered with the same identity."],h.code=31008,h.description="Call cancelled",h.explanation="Unable to answer because the call has ended",h.name="CallCancelledError",h.solutions=[],Object.setPrototypeOf(h,l.CallCancelledError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.CallCancelledError=g;var T=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31009,h.description="Transport error",h.explanation="No transport available to send or receive messages",h.name="TransportError",h.solutions=[],Object.setPrototypeOf(h,l.TransportError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.TransportError=T})(a=t.GeneralErrors||(t.GeneralErrors={}));var p;(function(l){var m=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=["Invalid content or MessageType passed to sendMessage method."],h.code=31100,h.description="The request had malformed syntax.",h.explanation="The request could not be understood due to malformed syntax.",h.name="MalformedRequestError",h.solutions=["Ensure content and MessageType passed to sendMessage method are valid."],Object.setPrototypeOf(h,l.MalformedRequestError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.MalformedRequestError=m;var E=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31101,h.description="Missing parameter array in request",h.explanation="",h.name="MissingParameterArrayError",h.solutions=[],Object.setPrototypeOf(h,l.MissingParameterArrayError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.MissingParameterArrayError=E;var w=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31102,h.description="Authorization token missing in request.",h.explanation="",h.name="AuthorizationTokenMissingError",h.solutions=[],Object.setPrototypeOf(h,l.AuthorizationTokenMissingError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.AuthorizationTokenMissingError=w;var v=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31103,h.description="Maximum parameter length has been exceeded.",h.explanation="Length of parameters cannot exceed MAX_PARAM_LENGTH.",h.name="MaxParameterLengthExceededError",h.solutions=[],Object.setPrototypeOf(h,l.MaxParameterLengthExceededError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.MaxParameterLengthExceededError=v;var b=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31104,h.description="Invalid bridge token",h.explanation="",h.name="InvalidBridgeTokenError",h.solutions=[],Object.setPrototypeOf(h,l.InvalidBridgeTokenError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.InvalidBridgeTokenError=b;var g=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=["Client name contains invalid characters."],h.code=31105,h.description="Invalid client name",h.explanation="Client name should not contain control, space, delims, or unwise characters.",h.name="InvalidClientNameError",h.solutions=["Make sure that client name does not contain any of the invalid characters."],Object.setPrototypeOf(h,l.InvalidClientNameError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.InvalidClientNameError=g;var T=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31107,h.description="The reconnect parameter is invalid",h.explanation="",h.name="ReconnectParameterInvalidError",h.solutions=[],Object.setPrototypeOf(h,l.ReconnectParameterInvalidError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.ReconnectParameterInvalidError=T})(p=t.MalformedRequestErrors||(t.MalformedRequestErrors={})),function(l){var m=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31201,h.description="Authorization error",h.explanation="The request requires user authentication. The server understood the request, but is refusing to fulfill it.",h.name="AuthorizationError",h.solutions=[],Object.setPrototypeOf(h,l.AuthorizationError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.AuthorizationError=m;var E=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31203,h.description="No valid account",h.explanation="",h.name="NoValidAccountError",h.solutions=[],Object.setPrototypeOf(h,l.NoValidAccountError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.NoValidAccountError=E;var w=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31204,h.description="Invalid JWT token",h.explanation="",h.name="InvalidJWTTokenError",h.solutions=[],Object.setPrototypeOf(h,l.InvalidJWTTokenError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.InvalidJWTTokenError=w;var v=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31205,h.description="JWT token expired",h.explanation="",h.name="JWTTokenExpiredError",h.solutions=[],Object.setPrototypeOf(h,l.JWTTokenExpiredError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.JWTTokenExpiredError=v;var b=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=["Rate limit exceeded."],h.code=31206,h.description="Rate exceeded authorized limit.",h.explanation="The request performed exceeds the authorized limit.",h.name="RateExceededError",h.solutions=["Ensure message send rate does not exceed authorized limits."],Object.setPrototypeOf(h,l.RateExceededError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.RateExceededError=b;var g=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=[],h.code=31207,h.description="JWT token expiration too long",h.explanation="",h.name="JWTTokenExpirationTooLongError",h.solutions=[],Object.setPrototypeOf(h,l.JWTTokenExpirationTooLongError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.JWTTokenExpirationTooLongError=g;var T=function(_){n(y,_);function y(S,D){var h=_.call(this,S,D)||this;h.causes=["The payload size of Call Message Event exceeds the authorized limit."],h.code=31209,h.description="Call Message Event Payload size exceeded authorized limit.",h.explanation="The request performed to send a Call Message Event exceeds the payload size authorized limit",h.name="PayloadSizeExceededError",h.solutions=["Reduce payload size of Call Message Event to be within the authorized limit and try again."],Object.setPrototypeOf(h,l.PayloadSizeExceededError.prototype);var L=typeof S=="string"?S:h.explanation,U=typeof S=="object"?S:D;return h.message=h.name+" ("+h.code+"): "+L,h.originalError=U,h}return y}(e.default);l.PayloadSizeExceededError=T}(r=t.AuthorizationErrors||(t.AuthorizationErrors={}));var d;(function(l){var m=function(w){n(v,w);function v(b,g){var T=w.call(this,b,g)||this;T.causes=["The user denied the getUserMedia request.","The browser denied the getUserMedia request."],T.code=31401,T.description="UserMedia Permission Denied Error",T.explanation="The browser or end-user denied permissions to user media. Therefore we were unable to acquire input audio.",T.name="PermissionDeniedError",T.solutions=["The user should accept the request next time prompted. If the browser saved the deny, the user should change that permission in their browser.","The user should to verify that the browser has permission to access the microphone at this address."],Object.setPrototypeOf(T,l.PermissionDeniedError.prototype);var _=typeof b=="string"?b:T.explanation,y=typeof b=="object"?b:g;return T.message=T.name+" ("+T.code+"): "+_,T.originalError=y,T}return v}(e.default);l.PermissionDeniedError=m;var E=function(w){n(v,w);function v(b,g){var T=w.call(this,b,g)||this;T.causes=["NotFoundError - The deviceID specified was not found.","The getUserMedia constraints were overconstrained and no devices matched."],T.code=31402,T.description="UserMedia Acquisition Failed Error",T.explanation="The browser and end-user allowed permissions, however getting the media failed. Usually this is due to bad constraints, but can sometimes fail due to browser, OS or hardware issues.",T.name="AcquisitionFailedError",T.solutions=["Ensure the deviceID being specified exists.","Try acquiring media with fewer constraints."],Object.setPrototypeOf(T,l.AcquisitionFailedError.prototype);var _=typeof b=="string"?b:T.explanation,y=typeof b=="object"?b:g;return T.message=T.name+" ("+T.code+"): "+_,T.originalError=y,T}return v}(e.default);l.AcquisitionFailedError=E})(d=t.UserMediaErrors||(t.UserMediaErrors={}));var f;(function(l){var m=function(w){n(v,w);function v(b,g){var T=w.call(this,b,g)||this;T.causes=[],T.code=53e3,T.description="Signaling connection error",T.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.",T.name="ConnectionError",T.solutions=[],Object.setPrototypeOf(T,l.ConnectionError.prototype);var _=typeof b=="string"?b:T.explanation,y=typeof b=="object"?b:g;return T.message=T.name+" ("+T.code+"): "+_,T.originalError=y,T}return v}(e.default);l.ConnectionError=m;var E=function(w){n(v,w);function v(b,g){var T=w.call(this,b,g)||this;T.causes=["The device running your application lost its Internet connection."],T.code=53001,T.description="Signaling connection disconnected",T.explanation="Raised whenever the signaling connection is unexpectedly disconnected.",T.name="ConnectionDisconnected",T.solutions=["Ensure the device running your application has access to a stable Internet connection."],Object.setPrototypeOf(T,l.ConnectionDisconnected.prototype);var _=typeof b=="string"?b:T.explanation,y=typeof b=="object"?b:g;return T.message=T.name+" ("+T.code+"): "+_,T.originalError=y,T}return v}(e.default);l.ConnectionDisconnected=E})(f=t.SignalingErrors||(t.SignalingErrors={}));var u;(function(l){var m=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."],_.code=53400,_.description="Client is unable to create or apply a local media description",_.explanation="Raised whenever a Client is unable to create or apply a local media description.",_.name="ClientLocalDescFailed",_.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(_,l.ClientLocalDescFailed.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.ClientLocalDescFailed=m;var E=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."],_.code=53402,_.description="Client is unable to apply a remote media description",_.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.",_.name="ClientRemoteDescFailed",_.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(_,l.ClientRemoteDescFailed.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.ClientRemoteDescFailed=E;var w=function(v){n(b,v);function b(g,T){var _=v.call(this,g,T)||this;_.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."],_.code=53405,_.description="Media connection failed",_.explanation="Raised by the Client or Server whenever a media connection fails.",_.name="ConnectionError",_.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."],Object.setPrototypeOf(_,l.ConnectionError.prototype);var y=typeof g=="string"?g:_.explanation,S=typeof g=="object"?g:T;return _.message=_.name+" ("+_.code+"): "+y,_.originalError=S,_}return b}(e.default);l.ConnectionError=w})(u=t.MediaErrors||(t.MediaErrors={})),t.errorsByCode=new Map([[20101,r.AccessTokenInvalid],[20104,r.AccessTokenExpired],[20151,r.AuthenticationFailed],[31202,o.AccessTokenSignatureValidationFailed],[31400,i.BadRequest],[31404,i.NotFound],[31480,i.TemporarilyUnavailable],[31486,i.BusyHere],[31603,c.Decline],[31e3,a.UnknownError],[31001,a.ApplicationNotFoundError],[31002,a.ConnectionDeclinedError],[31003,a.ConnectionTimeoutError],[31005,a.ConnectionError],[31008,a.CallCancelledError],[31009,a.TransportError],[31100,p.MalformedRequestError],[31101,p.MissingParameterArrayError],[31102,p.AuthorizationTokenMissingError],[31103,p.MaxParameterLengthExceededError],[31104,p.InvalidBridgeTokenError],[31105,p.InvalidClientNameError],[31107,p.ReconnectParameterInvalidError],[31201,r.AuthorizationError],[31203,r.NoValidAccountError],[31204,r.InvalidJWTTokenError],[31205,r.JWTTokenExpiredError],[31206,r.RateExceededError],[31207,r.JWTTokenExpirationTooLongError],[31209,r.PayloadSizeExceededError],[31401,d.PermissionDeniedError],[31402,d.AcquisitionFailedError],[53e3,f.ConnectionError],[53001,f.ConnectionDisconnected],[53400,u.ClientLocalDescFailed],[53402,u.ClientRemoteDescFailed],[53405,u.ConnectionError]]),Object.freeze(t.errorsByCode)})(An);(function(t){var n=N&&N.__extends||function(){var f=function(u,l){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,E){m.__proto__=E}||function(m,E){for(var w in E)Object.prototype.hasOwnProperty.call(E,w)&&(m[w]=E[w])},f(u,l)};return function(u,l){f(u,l);function m(){this.constructor=u}u.prototype=l===null?Object.create(l):(m.prototype=l.prototype,new m)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.UserMediaErrors=t.TwilioError=t.SIPServerErrors=t.SignatureValidationErrors=t.SignalingErrors=t.MediaErrors=t.MalformedRequestErrors=t.GeneralErrors=t.ClientErrors=t.AuthorizationErrors=t.hasErrorByCode=t.getErrorByCode=t.NotSupportedError=t.InvalidStateError=t.InvalidArgumentError=t.getPreciseSignalingErrorByCode=void 0;var e=An;Object.defineProperty(t,"AuthorizationErrors",{enumerable:!0,get:function(){return e.AuthorizationErrors}}),Object.defineProperty(t,"ClientErrors",{enumerable:!0,get:function(){return e.ClientErrors}}),Object.defineProperty(t,"GeneralErrors",{enumerable:!0,get:function(){return e.GeneralErrors}}),Object.defineProperty(t,"MalformedRequestErrors",{enumerable:!0,get:function(){return e.MalformedRequestErrors}}),Object.defineProperty(t,"MediaErrors",{enumerable:!0,get:function(){return e.MediaErrors}}),Object.defineProperty(t,"SignalingErrors",{enumerable:!0,get:function(){return e.SignalingErrors}}),Object.defineProperty(t,"SignatureValidationErrors",{enumerable:!0,get:function(){return e.SignatureValidationErrors}}),Object.defineProperty(t,"SIPServerErrors",{enumerable:!0,get:function(){return e.SIPServerErrors}}),Object.defineProperty(t,"TwilioError",{enumerable:!0,get:function(){return e.TwilioError}}),Object.defineProperty(t,"UserMediaErrors",{enumerable:!0,get:function(){return e.UserMediaErrors}});var r=new Set([31001,31002,31003,31101,31102,31103,31104,31105,31107,31201,31202,31203,31204,31205,31207,31404,31480,31486,31603]);function o(f,u){if(typeof u=="number"&&d(u)){var l=f?!0:!r.has(u);if(l)return p(u)}}t.getPreciseSignalingErrorByCode=o;var i=function(f){n(u,f);function u(l){var m=f.call(this,l)||this;return m.name="InvalidArgumentError",m}return u}(Error);t.InvalidArgumentError=i;var c=function(f){n(u,f);function u(l){var m=f.call(this,l)||this;return m.name="InvalidStateError",m}return u}(Error);t.InvalidStateError=c;var a=function(f){n(u,f);function u(l){var m=f.call(this,l)||this;return m.name="NotSupportedError",m}return u}(Error);t.NotSupportedError=a;function p(f){var u=e.errorsByCode.get(f);if(!u)throw new i("Error code "+f+" not found");return u}t.getErrorByCode=p;function d(f){return e.errorsByCode.has(f)}t.hasErrorByCode=d})(oe);var se={},ie={};Object.defineProperty(ie,"__esModule",{value:!0});ie.SOUNDS_BASE_URL=ie.RELEASE_VERSION=ie.PACKAGE_NAME=ie.ECHO_TEST_DURATION=ie.COWBELL_AUDIO_URL=void 0;var ji="@twilio/voice-sdk";ie.PACKAGE_NAME=ji;var xn="2.10.2";ie.RELEASE_VERSION=xn;var Dn="https://sdk.twilio.com/js/client/sounds/releases/1.0.0";ie.SOUNDS_BASE_URL=Dn;var Ui=Dn+"/cowbell.mp3?cache="+xn;ie.COWBELL_AUDIO_URL=Ui;var Ni=2e4;ie.ECHO_TEST_DURATION=Ni;var Ve=N&&N.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],c=0,a=i.length;c<a;c++,o++)r[o]=i[c];return r};Object.defineProperty(se,"__esModule",{value:!0});se.Logger=void 0;var $t=Rn,Fi=ie,On=function(){function t(n,e){this._log=t.getLogLevelInstance(e),this._prefix="[TwilioVoice]["+n+"]"}return t.getLogLevelInstance=function(n){if(!t.loglevelInstance)try{t.loglevelInstance=(n&&n.LogLevelModule?n.LogLevelModule:$t).getLogger(Fi.PACKAGE_NAME)}catch{console.warn("Cannot create custom logger"),t.loglevelInstance=console}return t.loglevelInstance},t.prototype.debug=function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(n=this._log).debug.apply(n,Ve([this._prefix],e))},t.prototype.error=function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(n=this._log).error.apply(n,Ve([this._prefix],e))},t.prototype.info=function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(n=this._log).info.apply(n,Ve([this._prefix],e))},t.prototype.setDefaultLevel=function(n){this._log.setDefaultLevel?this._log.setDefaultLevel(n):console.warn("Logger cannot setDefaultLevel")},t.prototype.warn=function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(n=this._log).warn.apply(n,Ve([this._prefix],e))},t.levels=$t.levels,t}();se.Logger=On.getLogLevelInstance();se.default=On;var yt={};Object.defineProperty(yt,"__esModule",{value:!0});var Bi=ie,De=oe,Vi=se,Wi=Bi.SOUNDS_BASE_URL+"/outgoing.mp3",Gi=function(){function t(n,e,r,o){this._name=n,this._availableDevices=e,this._beforeChange=r,this._isSupported=o,this._activeDevices=new Set,this._log=new Vi.default("OutputDeviceCollection")}return t.prototype.delete=function(n){this._log.debug(".delete",n);var e=!!this._activeDevices.delete(n),r=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&r&&this._activeDevices.add(r);var o=Array.from(this._activeDevices.values()).map(function(i){return i.deviceId});return this._beforeChange(this._name,o),!!e},t.prototype.get=function(){return this._activeDevices},t.prototype.set=function(n){var e=this;if(this._log.debug(".set",n),!this._isSupported)return Promise.reject(new De.NotSupportedError("This browser does not support audio output selection"));var r=Array.isArray(n)?n:[n];if(!r.length)return Promise.reject(new De.InvalidArgumentError("Must specify at least one device to set"));var o=[],i=r.map(function(c){var a=e._availableDevices.get(c);return a||o.push(c),a});return o.length?Promise.reject(new De.InvalidArgumentError("Devices not found: "+o.join(", "))):new Promise(function(c){c(e._beforeChange(e._name,r))}).then(function(){e._activeDevices.clear(),i.forEach(e._activeDevices.add,e._activeDevices)})},t.prototype.test=function(n){return n===void 0&&(n=Wi),this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(e){var r;return new Promise(function(o){r=new Audio(n),r.oncanplay=o}).then(function(){return r.setSinkId(e.deviceId).then(function(){return r.play()})})})):Promise.reject(new De.InvalidStateError("No active output devices to test")):Promise.reject(new De.NotSupportedError("This browser does not support audio output selection"))},t}();yt.default=Gi;var bt={};Object.defineProperty(bt,"__esModule",{value:!0});var Hi=function(){function t(n){Object.defineProperties(this,{deviceId:{get:function(){return n.deviceId}},groupId:{get:function(){return n.groupId}},kind:{get:function(){return n.kind}},label:{get:function(){return n.label}}})}return t}();bt.default=Hi;var K={};Object.defineProperty(K,"__esModule",{value:!0});K.promisifyEvents=K.flatMap=K.queryToJson=K.isUnifiedPlanDefault=K.isSafari=K.isLegacyEdge=K.isFirefox=K.isChrome=K.isElectron=K.difference=K.average=K.Exception=void 0;function Je(t){if(!(this instanceof Je))return new Je(t);this.message=t}Je.prototype.toString=function(){return"Twilio.Exception: "+this.message};function $i(t){return t&&t.length?t.reduce(function(n,e){return n+e})/t.length:0}K.average=$i;function qi(t,n,e){e=e||function(o){return o};var r=new Set(n.map(e));return t.filter(function(o){return!r.has(e(o))})}K.difference=qi;function Mn(t){return!!t.userAgent.match("Electron")}K.isElectron=Mn;function Ln(t,n){var e=!!n.userAgent.match("CriOS"),r=!!n.userAgent.match("HeadlessChrome"),o=typeof t.chrome<"u"&&n.vendor==="Google Inc."&&n.userAgent.indexOf("OPR")===-1&&n.userAgent.indexOf("Edge")===-1;return e||Mn(n)||o||r}K.isChrome=Ln;function jn(t){return t=t||(typeof window>"u"?N.navigator:window.navigator),!!t&&typeof t.userAgent=="string"&&/firefox|fxios/i.test(t.userAgent)}K.isFirefox=jn;function zi(t){return t=t||(typeof window>"u"?N.navigator:window.navigator),!!t&&typeof t.userAgent=="string"&&/edge\/\d+/i.test(t.userAgent)}K.isLegacyEdge=zi;function Un(t){return!!t.vendor&&t.vendor.indexOf("Apple")!==-1&&t.userAgent&&t.userAgent.indexOf("CriOS")===-1&&t.userAgent.indexOf("FxiOS")===-1}K.isSafari=Un;function Ji(t,n,e,r){if(typeof t>"u"||typeof n>"u"||typeof e>"u"||typeof r>"u"||typeof e.prototype>"u"||typeof r.prototype>"u")return!1;if(Ln(t,n)&&e.prototype.addTransceiver){var o=new e,i=!0;try{o.addTransceiver("audio")}catch{i=!1}return o.close(),i}else{if(jn(n))return!0;if(Un(n))return"currentDirection"in r.prototype}return!1}K.isUnifiedPlanDefault=Ji;function Ki(t){return t?t.split("&").reduce(function(n,e){var r=e.split("="),o=r[0],i=decodeURIComponent((r[1]||"").replace(/\+/g,"%20"));return o&&(n[o]=i),n},{}):""}K.queryToJson=Ki;function Qi(t,n){var e=t instanceof Map||t instanceof Set?Array.from(t.values()):t;return n=n||function(r){return r},e.reduce(function(r,o){var i=n(o);return r.concat(i)},[])}K.flatMap=Qi;function Xi(t,n,e){return new Promise(function(r,o){function i(){t.removeListener(e,c),r()}function c(){t.removeListener(n,i),o()}t.once(n,i),t.once(e,c)})}K.promisifyEvents=Xi;var Yi=Je;K.Exception=Yi;var qt;function Zi(){if(qt)return Be;qt=1;var t=N&&N.__extends||function(){var f=function(u,l){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(m,E){m.__proto__=E}||function(m,E){for(var w in E)Object.prototype.hasOwnProperty.call(E,w)&&(m[w]=E[w])},f(u,l)};return function(u,l){f(u,l);function m(){this.constructor=u}u.prototype=l===null?Object.create(l):(m.prototype=l.prototype,new m)}}();Object.defineProperty(Be,"__esModule",{value:!0});var n=ve,e=nt(),r=oe,o=se,i=yt,c=bt,a=K,p={audioinput:"Audio Input",audiooutput:"Audio Output"},d=function(f){t(u,f);function u(l,m,E){var w,v=f.call(this)||this;v.availableInputDevices=new Map,v.availableOutputDevices=new Map,v._audioConstraints=null,v._defaultInputDeviceStream=null,v._enabledSounds=(w={},w[e.default.SoundName.Disconnect]=!0,w[e.default.SoundName.Incoming]=!0,w[e.default.SoundName.Outgoing]=!0,w),v._inputDevice=null,v._isPollingInputVolume=!1,v._log=new o.default("AudioHelper"),v._processedStream=null,v._selectedInputDeviceStream=null,v._unknownDeviceIndexes={audioinput:{},audiooutput:{}},v._updateAvailableDevices=function(){return!v._mediaDevices||!v._enumerateDevices?Promise.reject("Enumeration not supported"):v._enumerateDevices().then(function(_){v._updateDevices(_.filter(function(S){return S.kind==="audiooutput"}),v.availableOutputDevices,v._removeLostOutput),v._updateDevices(_.filter(function(S){return S.kind==="audioinput"}),v.availableInputDevices,v._removeLostInput);var y=v.availableOutputDevices.get("default")||Array.from(v.availableOutputDevices.values())[0];[v.speakerDevices,v.ringtoneDevices].forEach(function(S){!S.get().size&&v.availableOutputDevices.size&&v.isOutputSelectionSupported&&S.set(y.deviceId).catch(function(D){v._log.warn("Unable to set audio output devices. "+D)})})})},v._removeLostInput=function(_){if(!v.inputDevice||v.inputDevice.deviceId!==_.deviceId)return!1;v._destroyProcessedStream(),v._replaceStream(null),v._inputDevice=null,v._maybeStopPollingVolume();var y=v.availableInputDevices.get("default")||Array.from(v.availableInputDevices.values())[0];return y&&v.setInputDevice(y.deviceId),!0},v._removeLostOutput=function(_){var y=v.speakerDevices.delete(_),S=v.ringtoneDevices.delete(_);return y||S},E=Object.assign({AudioContext:typeof AudioContext<"u"&&AudioContext,setSinkId:typeof HTMLAudioElement<"u"&&HTMLAudioElement.prototype.setSinkId},E),v._updateUserOptions(E),v._audioProcessorEventObserver=E.audioProcessorEventObserver,v._mediaDevices=E.mediaDevices||navigator.mediaDevices,v._onActiveInputChanged=m,v._enumerateDevices=typeof E.enumerateDevices=="function"?E.enumerateDevices:v._mediaDevices&&v._mediaDevices.enumerateDevices.bind(v._mediaDevices);var b=!!(E.AudioContext||E.audioContext),g=!!v._enumerateDevices;E.enabledSounds&&(v._enabledSounds=E.enabledSounds);var T=typeof E.setSinkId=="function";return v.isOutputSelectionSupported=g&&T,v.isVolumeSupported=b,v.isVolumeSupported&&(v._audioContext=E.audioContext||E.AudioContext&&new E.AudioContext,v._audioContext&&(v._inputVolumeAnalyser=v._audioContext.createAnalyser(),v._inputVolumeAnalyser.fftSize=32,v._inputVolumeAnalyser.smoothingTimeConstant=.3)),v.ringtoneDevices=new i.default("ringtone",v.availableOutputDevices,l,v.isOutputSelectionSupported),v.speakerDevices=new i.default("speaker",v.availableOutputDevices,l,v.isOutputSelectionSupported),v.addListener("newListener",function(_){_==="inputVolume"&&v._maybeStartPollingVolume()}),v.addListener("removeListener",function(_){_==="inputVolume"&&v._maybeStopPollingVolume()}),v.once("newListener",function(){v.isOutputSelectionSupported||v._log.warn("Warning: This browser does not support audio output selection."),v.isVolumeSupported||v._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")}),g&&v._initializeEnumeration(),v}return Object.defineProperty(u.prototype,"audioConstraints",{get:function(){return this._audioConstraints},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"inputDevice",{get:function(){return this._inputDevice},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"inputStream",{get:function(){return this._processedStream||this._selectedInputDeviceStream},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"processedStream",{get:function(){return this._processedStream},enumerable:!1,configurable:!0}),u.prototype._destroy=function(){this._stopDefaultInputDeviceStream(),this._stopSelectedInputDeviceStream(),this._destroyProcessedStream(),this._maybeStopPollingVolume(),this.removeAllListeners(),this._unbind()},u.prototype._maybeStartPollingVolume=function(){var l=this;if(!(!this.isVolumeSupported||!this.inputStream)&&(this._updateVolumeSource(),!(this._isPollingInputVolume||!this._inputVolumeAnalyser))){var m=this._inputVolumeAnalyser.frequencyBinCount,E=new Uint8Array(m);this._isPollingInputVolume=!0;var w=function(){if(l._isPollingInputVolume){if(l._inputVolumeAnalyser){l._inputVolumeAnalyser.getByteFrequencyData(E);var v=a.average(E);l.emit("inputVolume",v/255)}requestAnimationFrame(w)}};requestAnimationFrame(w)}},u.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this.inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),delete this._inputVolumeSource),this._isPollingInputVolume=!1))},u.prototype._openDefaultDeviceWithConstraints=function(l){var m=this;return this._log.info("Opening default device with constraints",l),this._getUserMedia(l).then(function(E){return m._log.info("Opened default device. Updating available devices."),m._updateAvailableDevices().catch(function(w){m._log.warn("Unable to updateAvailableDevices after gUM call",w)}),m._defaultInputDeviceStream=E,m._maybeCreateProcessedStream(E)})},u.prototype._stopDefaultInputDeviceStream=function(){this._defaultInputDeviceStream&&(this._log.info("stopping default device stream"),this._defaultInputDeviceStream.getTracks().forEach(function(l){return l.stop()}),this._defaultInputDeviceStream=null,this._destroyProcessedStream())},u.prototype._unbind=function(){if(!this._mediaDevices||!this._enumerateDevices)throw new r.NotSupportedError("Enumeration is not supported");this._mediaDevices.removeEventListener&&this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices)},u.prototype._updateUserOptions=function(l){typeof l.enumerateDevices=="function"&&(this._enumerateDevices=l.enumerateDevices),typeof l.getUserMedia=="function"&&(this._getUserMedia=l.getUserMedia)},u.prototype.addProcessor=function(l){if(this._log.debug(".addProcessor"),this._processor)throw new r.NotSupportedError("Adding multiple AudioProcessors is not supported at this time.");if(typeof l!="object"||l===null)throw new r.InvalidArgumentError("Missing AudioProcessor argument.");if(typeof l.createProcessedStream!="function")throw new r.InvalidArgumentError("Missing createProcessedStream() method.");if(typeof l.destroyProcessedStream!="function")throw new r.InvalidArgumentError("Missing destroyProcessedStream() method.");return this._processor=l,this._audioProcessorEventObserver.emit("add"),this._restartStreams()},u.prototype.disconnect=function(l){return this._log.debug(".disconnect",l),this._maybeEnableSound(e.default.SoundName.Disconnect,l)},u.prototype.incoming=function(l){return this._log.debug(".incoming",l),this._maybeEnableSound(e.default.SoundName.Incoming,l)},u.prototype.outgoing=function(l){return this._log.debug(".outgoing",l),this._maybeEnableSound(e.default.SoundName.Outgoing,l)},u.prototype.removeProcessor=function(l){if(this._log.debug(".removeProcessor"),typeof l!="object"||l===null)throw new r.InvalidArgumentError("Missing AudioProcessor argument.");if(this._processor!==l)throw new r.InvalidArgumentError("Cannot remove an AudioProcessor that has not been previously added.");return this._destroyProcessedStream(),this._processor=null,this._audioProcessorEventObserver.emit("remove"),this._restartStreams()},u.prototype.setAudioConstraints=function(l){return this._log.debug(".setAudioConstraints",l),this._audioConstraints=Object.assign({},l),delete this._audioConstraints.deviceId,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},u.prototype.setInputDevice=function(l){return this._log.debug(".setInputDevice",l),this._setInputDevice(l,!1)},u.prototype.unsetAudioConstraints=function(){return this._log.debug(".unsetAudioConstraints"),this._audioConstraints=null,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},u.prototype.unsetInputDevice=function(){var l=this;return this._log.debug(".unsetInputDevice",this.inputDevice),this.inputDevice?(this._destroyProcessedStream(),this._onActiveInputChanged(null).then(function(){l._replaceStream(null),l._inputDevice=null,l._maybeStopPollingVolume()})):Promise.resolve()},u.prototype._destroyProcessedStream=function(){if(this._processor&&this._processedStream){this._log.info("destroying processed stream");var l=this._processedStream;this._processedStream.getTracks().forEach(function(m){return m.stop()}),this._processedStream=null,this._processor.destroyProcessedStream(l),this._audioProcessorEventObserver.emit("destroy")}},u.prototype._getUnknownDeviceIndex=function(l){var m=l.deviceId,E=l.kind,w=this._unknownDeviceIndexes[E][m];return w||(w=Object.keys(this._unknownDeviceIndexes[E]).length+1,this._unknownDeviceIndexes[E][m]=w),w},u.prototype._initializeEnumeration=function(){var l=this;if(!this._mediaDevices||!this._enumerateDevices)throw new r.NotSupportedError("Enumeration is not supported");this._mediaDevices.addEventListener&&this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices),this._updateAvailableDevices().then(function(){l.isOutputSelectionSupported&&Promise.all([l.speakerDevices.set("default"),l.ringtoneDevices.set("default")]).catch(function(m){l._log.warn("Warning: Unable to set audio output devices. "+m)})})},u.prototype._maybeCreateProcessedStream=function(l){var m=this;return this._processor?(this._log.info("Creating processed stream"),this._processor.createProcessedStream(l).then(function(E){return m._processedStream=E,m._audioProcessorEventObserver.emit("create"),m._processedStream})):Promise.resolve(l)},u.prototype._maybeEnableSound=function(l,m){return typeof m<"u"&&(this._enabledSounds[l]=m),this._enabledSounds[l]},u.prototype._replaceStream=function(l){this._log.info("Replacing with new stream."),this._selectedInputDeviceStream&&(this._log.info("Old stream detected. Stopping tracks."),this._stopSelectedInputDeviceStream()),this._selectedInputDeviceStream=l},u.prototype._restartStreams=function(){if(this.inputDevice&&this._selectedInputDeviceStream)return this._log.info("Restarting selected input device"),this._setInputDevice(this.inputDevice.deviceId,!0);if(this._defaultInputDeviceStream){var l=this.availableInputDevices.get("default")||Array.from(this.availableInputDevices.values())[0];return this._log.info("Restarting default input device, now becoming selected."),this._setInputDevice(l.deviceId,!0)}return Promise.resolve()},u.prototype._setInputDevice=function(l,m){var E=this;if(typeof l!="string")return Promise.reject(new r.InvalidArgumentError("Must specify the device to set"));var w=this.availableInputDevices.get(l);if(!w)return Promise.reject(new r.InvalidArgumentError("Device not found: "+l));if(this._log.info("Setting input device. ID: "+l),this._inputDevice&&this._inputDevice.deviceId===l&&this._selectedInputDeviceStream){if(!m)return Promise.resolve();this._log.info("Same track detected on setInputDevice, stopping old tracks."),this._stopSelectedInputDeviceStream()}this._stopDefaultInputDeviceStream();var v={audio:Object.assign({deviceId:{exact:l}},this.audioConstraints)};return this._log.info("setInputDevice: getting new tracks."),this._getUserMedia(v).then(function(b){return E._destroyProcessedStream(),E._maybeCreateProcessedStream(b).then(function(g){return E._log.info("setInputDevice: invoking _onActiveInputChanged."),E._onActiveInputChanged(g).then(function(){E._replaceStream(b),E._inputDevice=w,E._maybeStartPollingVolume()})})})},u.prototype._stopSelectedInputDeviceStream=function(){this._selectedInputDeviceStream&&(this._log.info("Stopping selected device stream"),this._selectedInputDeviceStream.getTracks().forEach(function(l){return l.stop()}))},u.prototype._updateDevices=function(l,m,E){var w=this,v=l.map(function(y){return y.deviceId}),b=Array.from(m.values()).map(function(y){return y.deviceId}),g=[],T=a.difference(b,v);T.forEach(function(y){var S=m.get(y);S&&(m.delete(y),E(S)&&g.push(S))});var _=!1;l.forEach(function(y){var S=m.get(y.deviceId),D=w._wrapMediaDeviceInfo(y);(!S||S.label!==D.label)&&(m.set(y.deviceId,D),_=!0)}),(_||T.length)&&(this.inputDevice!==null&&this.inputDevice.deviceId==="default"&&(this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale."),this._setInputDevice(this.inputDevice.deviceId,!0)),this._log.debug("#deviceChange",g),this.emit("deviceChange",g))},u.prototype._updateVolumeSource=function(){if(!(!this.inputStream||!this._audioContext||!this._inputVolumeAnalyser)){this._inputVolumeSource&&this._inputVolumeSource.disconnect();try{this._inputVolumeSource=this._audioContext.createMediaStreamSource(this.inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser)}catch(l){this._log.warn("Unable to update volume source",l),delete this._inputVolumeSource}}},u.prototype._wrapMediaDeviceInfo=function(l){var m={deviceId:l.deviceId,groupId:l.groupId,kind:l.kind,label:l.label};if(!m.label)if(m.deviceId==="default")m.label="Default";else{var E=this._getUnknownDeviceIndex(l);m.label="Unknown "+p[m.kind]+" Device "+E}return new c.default(m)},u}(n.EventEmitter);return d||(d={}),Be.default=d,Be}var Ye={},eo=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(Ye,"__esModule",{value:!0});Ye.AudioProcessorEventObserver=void 0;var to=ve,no=se,ro=function(t){eo(n,t);function n(){var e=t.call(this)||this;return e._log=new no.default("AudioProcessorEventObserver"),e._log.info("Creating AudioProcessorEventObserver instance"),e.on("enabled",function(){return e._reEmitEvent("enabled")}),e.on("add",function(){return e._reEmitEvent("add")}),e.on("remove",function(){return e._reEmitEvent("remove")}),e.on("create",function(){return e._reEmitEvent("create-processed-stream")}),e.on("destroy",function(){return e._reEmitEvent("destroy-processed-stream")}),e}return n.prototype.destroy=function(){this.removeAllListeners()},n.prototype._reEmitEvent=function(e){this._log.info("AudioProcessor:"+e),this.emit("event",{name:e,group:"audio-processor"})},n}(to.EventEmitter);Ye.AudioProcessorEventObserver=ro;var St={};Object.defineProperty(St,"__esModule",{value:!0});var io=oe,oo={dtmf0:[1360,960],dtmf1:[1230,720],dtmf2:[1360,720],dtmf3:[1480,720],dtmf4:[1230,790],dtmf5:[1360,790],dtmf6:[1480,790],dtmf7:[1230,870],dtmf8:[1360,870],dtmf9:[1480,870],dtmfh:[1480,960],dtmfs:[1230,960]},ao=function(){function t(n){var e=this;this._context=n,this._gainNodes=[],this._gainNodes=[this._context.createGain(),this._context.createGain()],this._gainNodes.forEach(function(r){r.connect(e._context.destination),r.gain.value=.1,e._gainNodes.push(r)})}return t.prototype.cleanup=function(){this._gainNodes.forEach(function(n){n.disconnect()})},t.prototype.play=function(n){var e=this,r=oo[n];if(!r)throw new io.InvalidArgumentError("Invalid DTMF sound name");var o=[this._context.createOscillator(),this._context.createOscillator()];o.forEach(function(i,c){i.type="sine",i.frequency.value=r[c],i.connect(e._gainNodes[c]),i.start(),i.stop(e._context.currentTime+.1),i.addEventListener("ended",function(){return i.disconnect()})})},t}();St.default=ao;var wt={},Ct={};Object.defineProperty(Ct,"__esModule",{value:!0});function so(t,n,e){var r=JSON.stringify(n.body||{}),o=new Headers;n.headers=n.headers||[],Object.entries(n.headers).forEach(function(i){var c=i[0],a=i[1];return o.append(c,a)}),fetch(n.url,{body:r,headers:o,method:t}).then(function(i){return i.text()},e).then(function(i){return e(null,i)},e)}var Tt=so;Tt.get=function(n,e){return new this("GET",n,e)};Tt.post=function(n,e){return new this("POST",n,e)};Ct.default=Tt;var co=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(wt,"__esModule",{value:!0});var uo=ve,lo=se,fo=Ct,fe=function(t){co(n,t);function n(e,r,o){var i=t.call(this)||this;if(!(i instanceof n))return new n(e,r,o);o=Object.assign({defaultPayload:function(){return{}}},o);var c=o.defaultPayload;typeof c!="function"&&(c=function(){return Object.assign({},o.defaultPayload)});var a=!0,p=Object.assign({app_name:void 0,app_version:void 0},o.metadata);return Object.defineProperties(i,{_defaultPayload:{value:c},_host:{value:o.host,writable:!0},_isEnabled:{get:function(){return a},set:function(d){a=d}},_log:{value:new lo.default("EventPublisher")},_request:{value:o.request||fo.default,writable:!0},_token:{value:r,writable:!0},isEnabled:{enumerable:!0,get:function(){return a}},metadata:{enumerable:!0,get:function(){return p}},productName:{enumerable:!0,value:e},token:{enumerable:!0,get:function(){return this._token}}}),i}return n}(uo.EventEmitter);fe.prototype._post=function(n,e,r,o,i,c,a){var p=this;if(!this.isEnabled&&!a||!this._host)return this._log.debug("Publishing cancelled",JSON.stringify({isEnabled:this.isEnabled,force:a,host:this._host})),Promise.resolve();if(!c||(!c.parameters||!c.parameters.CallSid)&&!c.outboundConnectionId)return c?this._log.debug("Publishing cancelled. Missing connection info",JSON.stringify({outboundConnectionId:c.outboundConnectionId,parameters:c.parameters})):this._log.debug("Publishing cancelled. Missing connection object"),Promise.resolve();var d={group:r,level:e.toUpperCase(),name:o,payload:i&&i.forEach?i.slice(0):Object.assign(this._defaultPayload(c),i),payload_type:"application/json",private:!1,publisher:this.productName,timestamp:new Date().toISOString()};this.metadata&&(d.publisher_metadata=this.metadata),n==="EndpointEvents"&&this._log.debug("Publishing insights",JSON.stringify({endpointName:n,event:d,force:a,host:this._host}));var f={body:d,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token},url:"https://"+this._host+"/v4/"+n};return new Promise(function(u,l){p._request.post(f,function(m){m?(p.emit("error",m),l(m)):u()})}).catch(function(u){p._log.error("Unable to post "+r+" "+o+" event to Insights. Received error: "+u)})};fe.prototype.post=function(n,e,r,o,i,c){return this._post("EndpointEvents",n,e,r,o,i,c)};fe.prototype.debug=function(n,e,r,o){return this.post("debug",n,e,r,o)};fe.prototype.info=function(n,e,r,o){return this.post("info",n,e,r,o)};fe.prototype.warn=function(n,e,r,o){return this.post("warning",n,e,r,o)};fe.prototype.error=function(n,e,r,o){return this.post("error",n,e,r,o)};fe.prototype.postMetrics=function(n,e,r,o,i){var c=this;return new Promise(function(a){var p=r.map(po).map(function(d){return Object.assign(d,o)});a(c._post("EndpointMetrics","info",n,e,p,i))})};fe.prototype.setHost=function(n){this._host=n};fe.prototype.setToken=function(n){this._token=n};fe.prototype.enable=function(){this._isEnabled=!0};fe.prototype.disable=function(){this._isEnabled=!1};function po(t){return{audio_codec:t.codecName,audio_level_in:t.audioInputLevel,audio_level_out:t.audioOutputLevel,bytes_received:t.bytesReceived,bytes_sent:t.bytesSent,call_volume_input:t.inputVolume,call_volume_output:t.outputVolume,jitter:t.jitter,mos:t.mos&&Math.round(t.mos*100)/100,packets_lost:t.packetsLost,packets_lost_fraction:t.packetsLostFraction&&Math.round(t.packetsLostFraction*100)/100,packets_received:t.packetsReceived,rtt:t.rtt,timestamp:new Date(t.timestamp).toISOString(),total_bytes_received:t.totals.bytesReceived,total_bytes_sent:t.totals.bytesSent,total_packets_lost:t.totals.packetsLost,total_packets_received:t.totals.packetsReceived,total_packets_sent:t.totals.packetsSent}}wt.default=fe;var ot={},Pe={},Et={};Object.defineProperty(Et,"__esModule",{value:!0});var zt=32767,Jt=typeof window<"u"?window.RTCStatsReport:void 0;function he(t){if(!(this instanceof he))return new he(t);var n=this;Object.defineProperties(this,{_map:{value:t},size:{enumerable:!0,get:function(){return n._map.size}}}),this[Symbol.iterator]=t[Symbol.iterator]}Jt&&(he.prototype=Object.create(Jt.prototype),he.prototype.constructor=he);["entries","forEach","get","has","keys","values"].forEach(function(t){he.prototype[t]=function(){for(var n,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return(n=this._map)[t].apply(n,e)}});he.fromArray=function(n){return new he(n.reduce(function(e,r){return e.set(r.id,r),e},new Map))};he.fromRTCStatsResponse=function(n){var e,r=new Map,o=n.result().reduce(function(c,a){var p=a.id;switch(a.type){case"googCertificate":c.set(p,yo(a));break;case"datachannel":c.set(p,bo(a));break;case"googCandidatePair":Fn(a,"googActiveConnection")&&(e=p),c.set(p,go(a));break;case"localcandidate":c.set(p,Qt(a,!1));break;case"remotecandidate":c.set(p,Qt(a,!0));break;case"ssrc":Ee(a,"packetsReceived")?c.set("rtp-"+p,mo(a)):c.set("rtp-"+p,_o(a)),c.set("track-"+p,vo(a)),c.set("codec-"+p,ho(a));break;case"googComponent":var d=Kt(a);r.set(d.selectedCandidatePairId,p),c.set(p,Kt(a));break}return c},new Map);if(e){var i=r.get(e);i&&(o.get(i).dtlsState="connected")}return new he(o)};function Kt(t){return{bytesReceived:void 0,bytesSent:void 0,dtlsState:void 0,id:t.id,localCertificateId:t.stat("localCertificateId"),remoteCertificateId:t.stat("remoteCertificateId"),rtcpTransportStatsId:void 0,selectedCandidatePairId:t.stat("selectedCandidatePairId"),timestamp:Date.parse(t.timestamp),type:"transport"}}function ho(t){return{channels:void 0,clockRate:void 0,id:t.id,implementation:void 0,mimeType:t.stat("mediaType")+"/"+t.stat("googCodecName"),payloadType:void 0,sdpFmtpLine:void 0,timestamp:Date.parse(t.timestamp),type:"codec"}}function vo(t){return{audioLevel:Ee(t,"audioOutputLevel")?Q(t,"audioOutputLevel")/zt:(Q(t,"audioInputLevel")||0)/zt,detached:void 0,echoReturnLoss:pt(t,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:pt(t,"googEchoCancellationReturnLossEnhancement"),ended:void 0,frameHeight:Ee(t,"googFrameHeightReceived")?Q(t,"googFrameHeightReceived"):Q(t,"googFrameHeightSent"),frameWidth:Ee(t,"googFrameWidthReceived")?Q(t,"googFrameWidthReceived"):Q(t,"googFrameWidthSent"),framesCorrupted:void 0,framesDecoded:Q(t,"framesDecoded"),framesDropped:void 0,framesPerSecond:void 0,framesReceived:void 0,framesSent:Q(t,"framesEncoded"),fullFramesLost:void 0,id:t.id,kind:t.stat("mediaType"),partialFramesLost:void 0,remoteSource:void 0,ssrcIds:void 0,timestamp:Date.parse(t.timestamp),trackIdentifier:t.stat("googTrackId"),type:"track"}}function Nn(t,n){return{associateStatsId:void 0,codecId:"codec-"+t.id,firCount:n?Q(t,"googFirsSent"):void 0,id:t.id,isRemote:void 0,mediaType:t.stat("mediaType"),nackCount:n?Q(t,"googNacksSent"):Q(t,"googNacksReceived"),pliCount:n?Q(t,"googPlisSent"):Q(t,"googPlisReceived"),qpSum:Q(t,"qpSum"),sliCount:void 0,ssrc:t.stat("ssrc"),timestamp:Date.parse(t.timestamp),trackId:"track-"+t.id,transportId:t.stat("transportId")}}function mo(t){var n=Nn(t,!0);return Object.assign(n,{burstDiscardCount:void 0,burstDiscardRate:void 0,burstLossCount:void 0,burstLossRate:void 0,burstPacketsDiscarded:void 0,burstPacketsLost:void 0,bytesReceived:Q(t,"bytesReceived"),fractionLost:void 0,framesDecoded:Q(t,"framesDecoded"),gapDiscardRate:void 0,gapLossRate:void 0,jitter:ft(t.stat("googJitterReceived")),packetsDiscarded:void 0,packetsLost:Q(t,"packetsLost"),packetsReceived:Q(t,"packetsReceived"),packetsRepaired:void 0,roundTripTime:ft(t.stat("googRtt")),type:"inbound-rtp"}),n}function _o(t){var n=Nn(t,!1);return Object.assign(n,{bytesSent:Q(t,"bytesSent"),framesEncoded:Q(t,"framesEncoded"),packetsSent:Q(t,"packetsSent"),remoteTimestamp:void 0,targetBitrate:void 0,type:"outbound-rtp"}),n}function Qt(t,n){return{candidateType:So(t.stat("candidateType")),deleted:void 0,id:t.id,ip:t.stat("ipAddress"),isRemote:n,port:Q(t,"portNumber"),priority:pt(t,"priority"),protocol:t.stat("transport"),relayProtocol:void 0,timestamp:Date.parse(t.timestamp),transportId:void 0,type:n?"remote-candidate":"local-candidate",url:void 0}}function go(t){return{availableIncomingBitrate:void 0,availableOutgoingBitrate:void 0,bytesReceived:Q(t,"bytesReceived"),bytesSent:Q(t,"bytesSent"),consentRequestsSent:Q(t,"consentRequestsSent"),currentRoundTripTime:ft(t.stat("googRtt")),id:t.id,lastPacketReceivedTimestamp:void 0,lastPacketSentTimestamp:void 0,localCandidateId:t.stat("localCandidateId"),nominated:void 0,priority:void 0,readable:void 0,remoteCandidateId:t.stat("remoteCandidateId"),requestsReceived:Q(t,"requestsReceived"),requestsSent:Q(t,"requestsSent"),responsesReceived:Q(t,"responsesReceived"),responsesSent:Q(t,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,state:void 0,timestamp:Date.parse(t.timestamp),totalRoundTripTime:void 0,transportId:t.stat("googChannelId"),type:"candidate-pair",writable:Fn(t,"googWritable")}}function yo(t){return{base64Certificate:t.stat("googDerBase64"),fingerprint:t.stat("googFingerprint"),fingerprintAlgorithm:t.stat("googFingerprintAlgorithm"),id:t.id,issuerCertificateId:t.stat("googIssuerId"),timestamp:Date.parse(t.timestamp),type:"certificate"}}function bo(t){return{bytesReceived:void 0,bytesSent:void 0,datachannelid:t.stat("datachannelid"),id:t.id,label:t.stat("label"),messagesReceived:void 0,messagesSent:void 0,protocol:t.stat("protocol"),state:t.stat("state"),timestamp:Date.parse(t.timestamp),transportId:t.stat("transportId"),type:"data-channel"}}function ft(t){return isNaN(t)||t===""?void 0:parseInt(t,10)/1e3}function So(t){switch(t){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return t}}function Q(t,n){var e=t.stat(n);return Ee(t,n)?parseInt(e,10):void 0}function pt(t,n){var e=t.stat(n);return Ee(t,n)?parseFloat(e):void 0}function Fn(t,n){var e=t.stat(n);return Ee(t,n)?e==="true"||e===!0:void 0}function Ee(t,n){var e=t.stat(n);return typeof e<"u"&&e!==""}Et.default=he;var wo=N&&N.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],c=0,a=i.length;c<a;c++,o++)r[o]=i[c];return r};Object.defineProperty(Pe,"__esModule",{value:!0});Pe.getRTCIceCandidateStatsReport=Pe.getRTCStats=void 0;var Xt=oe,Co=Et,To="PeerConnection is null",Eo="WebRTC statistics are unsupported";function Re(t,n){return typeof t.get=="function"?t.get(n):t.find(function(e){return e.id===n})}function Bn(t){if(!t)return Promise.reject(new Xt.InvalidArgumentError(To));if(typeof t.getStats!="function")return Promise.reject(new Xt.NotSupportedError(Eo));var n;try{n=t.getStats()}catch{n=new Promise(function(r){return t.getStats(r)}).then(Co.default.fromRTCStatsResponse)}return n}function Po(t,n){return n=Object.assign({createRTCSample:Ro},n),Bn(t).then(n.createRTCSample)}Pe.getRTCStats=Po;function Io(t){return Bn(t).then(function(n){var e=Array.from(n.values()).reduce(function(d,f){switch(["candidatePairs","localCandidates","remoteCandidates"].forEach(function(u){d[u]||(d[u]=[])}),f.type){case"candidate-pair":d.candidatePairs.push(f);break;case"local-candidate":d.localCandidates.push(f);break;case"remote-candidate":d.remoteCandidates.push(f);break;case"transport":f.selectedCandidatePairId&&(d.transport=f);break}return d},{}),r=e.candidatePairs,o=e.localCandidates,i=e.remoteCandidates,c=e.transport,a=r.find(function(d){return d.selected||c&&d.id===c.selectedCandidatePairId}),p;return a&&(p={localCandidate:o.find(function(d){return d.id===a.localCandidateId}),remoteCandidate:i.find(function(d){return d.id===a.remoteCandidateId})}),{iceCandidateStats:wo(o,i),selectedIceCandidatePairStats:p}})}Pe.getRTCIceCandidateStatsReport=Io;function ko(){}function Ro(t){var n=null,e=new ko,r;Array.from(t.values()).forEach(function(p){if(!p.isRemote){var d=p.type.replace("-","");if(r=r||p.timestamp,p.remoteId){var f=Re(t,p.remoteId);f&&f.roundTripTime&&(e.rtt=f.roundTripTime*1e3)}switch(d){case"inboundrtp":e.timestamp=e.timestamp||p.timestamp,e.jitter=p.jitter*1e3,e.packetsLost=p.packetsLost,e.packetsReceived=p.packetsReceived,e.bytesReceived=p.bytesReceived;break;case"outboundrtp":if(e.timestamp=p.timestamp,e.packetsSent=p.packetsSent,e.bytesSent=p.bytesSent,p.codecId){var u=Re(t,p.codecId);e.codecName=u?u.mimeType&&u.mimeType.match(/(.*\/)?(.*)/)[2]:p.codecId}break;case"transport":n=p.id;break}}}),e.timestamp||(e.timestamp=r);var o=Re(t,n);if(!o)return e;var i=Re(t,o.selectedCandidatePairId);if(!i)return e;var c=Re(t,i.localCandidateId),a=Re(t,i.remoteCandidateId);return e.rtt||(e.rtt=i&&i.currentRoundTripTime*1e3),Object.assign(e,{localAddress:c&&(c.address||c.ip),remoteAddress:a&&(a.address||a.ip)}),e}var Yt;function Vn(){return Yt||(Yt=1,function(t){var n=N&&N.__extends||function(){var m=function(E,w){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,b){v.__proto__=b}||function(v,b){for(var g in b)Object.prototype.hasOwnProperty.call(b,g)&&(v[g]=b[g])},m(E,w)};return function(E,w){m(E,w);function v(){this.constructor=E}E.prototype=w===null?Object.create(w):(v.prototype=w.prototype,new v)}}(),e=N&&N.__assign||function(){return e=Object.assign||function(m){for(var E,w=1,v=arguments.length;w<v;w++){E=arguments[w];for(var b in E)Object.prototype.hasOwnProperty.call(E,b)&&(m[b]=E[b])}return m},e.apply(this,arguments)},r=N&&N.__awaiter||function(m,E,w,v){function b(g){return g instanceof w?g:new w(function(T){T(g)})}return new(w||(w=Promise))(function(g,T){function _(D){try{S(v.next(D))}catch(h){T(h)}}function y(D){try{S(v.throw(D))}catch(h){T(h)}}function S(D){D.done?g(D.value):b(D.value).then(_,y)}S((v=v.apply(m,E||[])).next())})},o=N&&N.__generator||function(m,E){var w={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},v,b,g,T;return T={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(T[Symbol.iterator]=function(){return this}),T;function _(S){return function(D){return y([S,D])}}function y(S){if(v)throw new TypeError("Generator is already executing.");for(;w;)try{if(v=1,b&&(g=S[0]&2?b.return:S[0]?b.throw||((g=b.return)&&g.call(b),0):b.next)&&!(g=g.call(b,S[1])).done)return g;switch(b=0,g&&(S=[S[0]&2,g.value]),S[0]){case 0:case 1:g=S;break;case 4:return w.label++,{value:S[1],done:!1};case 5:w.label++,b=S[1],S=[0];continue;case 7:S=w.ops.pop(),w.trys.pop();continue;default:if(g=w.trys,!(g=g.length>0&&g[g.length-1])&&(S[0]===6||S[0]===2)){w=0;continue}if(S[0]===3&&(!g||S[1]>g[0]&&S[1]<g[3])){w.label=S[1];break}if(S[0]===6&&w.label<g[1]){w.label=g[1],g=S;break}if(g&&w.label<g[2]){w.label=g[2],w.ops.push(S);break}g[2]&&w.ops.pop(),w.trys.pop();continue}S=E.call(m,w)}catch(D){S=[6,D],b=0}finally{v=g=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PreflightTest=void 0;var i=ve,c=Nt(),a=nt(),p=oe,d=se,f=Pe,u=ie,l=function(m){n(E,m);function E(w,v){var b=m.call(this)||this;b._hasInsightsErrored=!1,b._log=new d.default("PreflightTest"),b._networkTiming={},b._options={codecPreferences:[c.default.Codec.PCMU,c.default.Codec.Opus],edge:"roaming",fakeMicInput:!1,logLevel:"error",signalingTimeoutMs:1e4},b._status=E.Status.Connecting,Object.assign(b._options,v),b._samples=[],b._warnings=[],b._startTime=Date.now(),b._initDevice(w,e(e({},b._options),{fileInputStream:b._options.fakeMicInput?b._getStreamFromFile():void 0}));var g=["codecPreferences","edge","fakeMicInput","logLevel","signalingTimeoutMs"],T=["audioContext","deviceFactory","fileInputStream","getRTCIceCandidateStatsReport","iceServers","rtcConfiguration"];if(typeof v=="object"){var _=e({},v);Object.keys(_).forEach(function(y){!g.includes(y)&&!T.includes(y)&&delete _[y],T.includes(y)&&(_[y]=!0)}),b._log.debug(".constructor",JSON.stringify(_))}return b}return E.prototype.stop=function(){var w=this;this._log.debug(".stop");var v=new p.GeneralErrors.CallCancelledError;this._device?(this._device.once(a.default.EventName.Unregistered,function(){return w._onFailed(v)}),this._device.destroy()):this._onFailed(v)},E.prototype._emitWarning=function(w,v,b){var g={name:w,description:v};b&&(g.rtcWarning=b),this._warnings.push(g),this._log.debug("#"+E.Events.Warning,JSON.stringify(g)),this.emit(E.Events.Warning,g)},E.prototype._getCallQuality=function(w){return w>4.2?E.CallQuality.Excellent:w>=4.1&&w<=4.2?E.CallQuality.Great:w>=3.7&&w<=4?E.CallQuality.Good:w>=3.1&&w<=3.6?E.CallQuality.Fair:E.CallQuality.Degraded},E.prototype._getReport=function(){var w=this._getRTCStats(),v={start:this._startTime};this._endTime&&(v.end=this._endTime,v.duration=this._endTime-this._startTime);var b={callSid:this._callSid,edge:this._edge,iceCandidateStats:this._rtcIceCandidateStatsReport.iceCandidateStats,networkTiming:this._networkTiming,samples:this._samples,selectedEdge:this._options.edge,stats:w,testTiming:v,totals:this._getRTCSampleTotals(),warnings:this._warnings},g=this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;return g&&(b.selectedIceCandidatePairStats=g,b.isTurnRequired=g.localCandidate.candidateType==="relay"||g.remoteCandidate.candidateType==="relay"),w&&(b.callQuality=this._getCallQuality(w.mos.average)),b},E.prototype._getRTCSampleTotals=function(){if(this._latestSample)return e({},this._latestSample.totals)},E.prototype._getRTCStats=function(){var w=this._samples.findIndex(function(b){return typeof b.mos=="number"&&b.mos>0}),v=w>=0?this._samples.slice(w):[];if(!(!v||!v.length))return["jitter","mos","rtt"].reduce(function(b,g){var T,_=v.map(function(y){return y[g]});return e(e({},b),(T={},T[g]={average:Number((_.reduce(function(y,S){return y+S})/_.length).toPrecision(5)),max:Math.max.apply(Math,_),min:Math.min.apply(Math,_)},T))},{})},E.prototype._getStreamFromFile=function(){var w=this._options.audioContext;if(!w)throw new p.NotSupportedError("Cannot fake input audio stream: AudioContext is not supported by this browser.");var v=new Audio(u.COWBELL_AUDIO_URL);v.addEventListener("canplaythrough",function(){return v.play()}),typeof v.setAttribute=="function"&&v.setAttribute("crossorigin","anonymous");var b=w.createMediaElementSource(v),g=w.createMediaStreamDestination();return b.connect(g),g.stream},E.prototype._initDevice=function(w,v){var b=this;try{this._device=new(v.deviceFactory||a.default)(w,{codecPreferences:v.codecPreferences,edge:v.edge,fileInputStream:v.fileInputStream,logLevel:v.logLevel,preflight:!0}),this._device.once(a.default.EventName.Registered,function(){b._onDeviceRegistered()}),this._device.once(a.default.EventName.Error,function(g){b._onDeviceError(g)}),this._device.register()}catch(g){setTimeout(function(){b._onFailed(g)});return}this._signalingTimeoutTimer=setTimeout(function(){b._onDeviceError(new p.SignalingErrors.ConnectionError("WebSocket Connection Timeout"))},v.signalingTimeoutMs)},E.prototype._onDeviceError=function(w){this._device.destroy(),this._onFailed(w)},E.prototype._onDeviceRegistered=function(){return r(this,void 0,void 0,function(){var w,v,b,g=this;return o(this,function(T){switch(T.label){case 0:return clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),w=this,[4,this._device.connect({rtcConfiguration:this._options.rtcConfiguration})];case 1:return w._call=T.sent(),this._networkTiming.signaling={start:Date.now()},this._setupCallHandlers(this._call),this._edge=this._device.edge||void 0,this._options.fakeMicInput&&(this._echoTimer=setTimeout(function(){return g._device.disconnectAll()},u.ECHO_TEST_DURATION),v=this._device.audio,v&&(v.disconnect(!1),v.outgoing(!1))),this._call.once("disconnect",function(){g._device.once(a.default.EventName.Unregistered,function(){return g._onUnregistered()}),g._device.destroy()}),b=this._call._publisher,b.on("error",function(){g._hasInsightsErrored||g._emitWarning("insights-connection-error","Received an error when attempting to connect to Insights gateway"),g._hasInsightsErrored=!0}),[2]}})})},E.prototype._onFailed=function(w){clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._releaseHandlers(),this._endTime=Date.now(),this._status=E.Status.Failed,this._log.debug("#"+E.Events.Failed,w),this.emit(E.Events.Failed,w)},E.prototype._onUnregistered=function(){var w=this;setTimeout(function(){w._status!==E.Status.Failed&&(clearTimeout(w._echoTimer),clearTimeout(w._signalingTimeoutTimer),w._releaseHandlers(),w._endTime=Date.now(),w._status=E.Status.Completed,w._report=w._getReport(),w._log.debug("#"+E.Events.Completed,JSON.stringify(w._report)),w.emit(E.Events.Completed,w._report))},10)},E.prototype._releaseHandlers=function(){[this._device,this._call].forEach(function(w){w&&w.eventNames().forEach(function(v){return w.removeAllListeners(v)})})},E.prototype._setupCallHandlers=function(w){var v=this;this._options.fakeMicInput&&w.once("volume",function(){w._mediaHandler.outputs.forEach(function(b){return b.audio.muted=!0})}),w.on("warning",function(b,g){v._emitWarning(b,"Received an RTCWarning. See .rtcWarning for the RTCWarning",g)}),w.once("accept",function(){v._callSid=w._mediaHandler.callSid,v._status=E.Status.Connected,v._log.debug("#"+E.Events.Connected),v.emit(E.Events.Connected)}),w.on("sample",function(b){return r(v,void 0,void 0,function(){var g;return o(this,function(T){switch(T.label){case 0:return this._latestSample?[3,2]:(g=this,[4,(this._options.getRTCIceCandidateStatsReport||f.getRTCIceCandidateStatsReport)(w._mediaHandler.version.pc)]);case 1:g._rtcIceCandidateStatsReport=T.sent(),T.label=2;case 2:return this._latestSample=b,this._samples.push(b),this._log.debug("#"+E.Events.Sample,JSON.stringify(b)),this.emit(E.Events.Sample,b),[2]}})})}),[{reportLabel:"peerConnection",type:"pcconnection"},{reportLabel:"ice",type:"iceconnection"},{reportLabel:"dtls",type:"dtlstransport"},{reportLabel:"signaling",type:"signaling"}].forEach(function(b){var g=b.type,T=b.reportLabel,_="on"+g+"statechange",y=w._mediaHandler[_];w._mediaHandler[_]=function(S){var D=v._networkTiming[T]=v._networkTiming[T]||{start:0};S==="connecting"||S==="checking"?D.start=Date.now():(S==="connected"||S==="stable")&&!D.duration&&(D.end=Date.now(),D.duration=D.end-D.start),y(S)}})},Object.defineProperty(E.prototype,"callSid",{get:function(){return this._callSid},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"endTime",{get:function(){return this._endTime},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"latestSample",{get:function(){return this._latestSample},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"report",{get:function(){return this._report},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"startTime",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),E}(i.EventEmitter);t.PreflightTest=l,function(m){(function(E){E.Excellent="excellent",E.Great="great",E.Good="good",E.Fair="fair",E.Degraded="degraded"})(m.CallQuality||(m.CallQuality={})),function(E){E.Completed="completed",E.Connected="connected",E.Failed="failed",E.Sample="sample",E.Warning="warning"}(m.Events||(m.Events={})),function(E){E.Connecting="connecting",E.Connected="connected",E.Completed="completed",E.Failed="failed"}(m.Status||(m.Status={}))}(l=t.PreflightTest||(t.PreflightTest={})),t.PreflightTest=l}(ot)),ot}var Pt={},Wn={};(function(t){var n=N&&N.__extends||function(){var b=function(g,T){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,y){_.__proto__=y}||function(_,y){for(var S in y)Object.prototype.hasOwnProperty.call(y,S)&&(_[S]=y[S])},b(g,T)};return function(g,T){b(g,T);function _(){this.constructor=g}g.prototype=T===null?Object.create(T):(_.prototype=T.prototype,new _)}}(),e=N&&N.__assign||function(){return e=Object.assign||function(b){for(var g,T=1,_=arguments.length;T<_;T++){g=arguments[T];for(var y in g)Object.prototype.hasOwnProperty.call(g,y)&&(b[y]=g[y])}return b},e.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.WSTransportState=void 0;var r=ve,o=Xe,i=oe,c=se,a=globalThis.WebSocket,p=1e4,d=5e3,f=15e3,u=15e3,l=1/0,m=1e3,E=2e4,w;(function(b){b.Connecting="connecting",b.Closed="closed",b.Open="open"})(w=t.WSTransportState||(t.WSTransportState={}));var v=function(b){n(g,b);function g(T,_){_===void 0&&(_={});var y=b.call(this)||this;return y.state=w.Closed,y._backoffStartTime={preferred:null,primary:null},y._connectedUri=null,y._log=new c.default("WSTransport"),y._shouldFallback=!1,y._uriIndex=0,y._moveUriIndex=function(){y._uriIndex++,y._uriIndex>=y._uris.length&&(y._uriIndex=0)},y._onSocketClose=function(S){if(y._log.error("Received websocket close event code: "+S.code+". Reason: "+S.reason),S.code===1006||S.code===1015){y.emit("error",{code:31005,message:S.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region or an edge is being specified in Device setup, ensure it is valid.",twilioError:new i.SignalingErrors.ConnectionError});var D=y.state===w.Open||y._previousState===w.Open;(y._shouldFallback||!D)&&y._moveUriIndex(),y._shouldFallback=!0}y._closeSocket()},y._onSocketError=function(S){y._log.error("WebSocket received error: "+S.message),y.emit("error",{code:31e3,message:S.message||"WSTransport socket error",twilioError:new i.SignalingErrors.ConnectionDisconnected})},y._onSocketMessage=function(S){if(y._setHeartbeatTimeout(),y._socket&&S.data===`
`){y._socket.send(`
`);return}y.emit("message",S)},y._onSocketOpen=function(){y._log.info("WebSocket opened successfully."),y._timeOpened=Date.now(),y._shouldFallback=!1,y._setState(w.Open),clearTimeout(y._connectTimeout),y._resetBackoffs(),y._setHeartbeatTimeout(),y.emit("open")},y._options=e(e({},g.defaultConstructorOptions),_),y._uris=T,y._backoff=y._setupBackoffs(),y}return g.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},g.prototype.open=function(){if(this._log.info("WSTransport.open() called..."),this._socket&&(this._socket.readyState===a.CONNECTING||this._socket.readyState===a.OPEN)){this._log.info("WebSocket already open.");return}this._preferredUri?this._connect(this._preferredUri):this._connect(this._uris[this._uriIndex])},g.prototype.send=function(T){if(!this._socket||this._socket.readyState!==a.OPEN)return!1;try{this._socket.send(T)}catch(_){return this._log.error("Error while sending message:",_.message),this._closeSocket(),!1}return!0},g.prototype.updatePreferredURI=function(T){this._preferredUri=T},g.prototype.updateURIs=function(T){typeof T=="string"&&(T=[T]),this._uris=T,this._uriIndex=0},g.prototype._close=function(){this._setState(w.Closed),this._closeSocket()},g.prototype._closeSocket=function(){if(clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),!this._socket){this._log.info("No WebSocket to clean up.");return}this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),(this._socket.readyState===a.CONNECTING||this._socket.readyState===a.OPEN)&&this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>p&&this._resetBackoffs(),this.state!==w.Closed&&this._performBackoff(),delete this._socket,this.emit("close")},g.prototype._connect=function(T,_){var y=this;this._log.info(typeof _=="number"?"Attempting to reconnect (retry #"+_+")...":"Attempting to connect..."),this._closeSocket(),this._setState(w.Connecting),this._connectedUri=T;try{this._socket=new this._options.WebSocket(this._connectedUri)}catch(S){this._log.error("Could not connect to endpoint:",S.message),this._close(),this.emit("error",{code:31e3,message:S.message||"Could not connect to "+this._connectedUri,twilioError:new i.SignalingErrors.ConnectionDisconnected});return}this._socket.addEventListener("close",this._onSocketClose),this._socket.addEventListener("error",this._onSocketError),this._socket.addEventListener("message",this._onSocketMessage),this._socket.addEventListener("open",this._onSocketOpen),delete this._timeOpened,this._connectTimeout=setTimeout(function(){y._log.info("WebSocket connection attempt timed out."),y._moveUriIndex(),y._closeSocket()},this._options.connectTimeoutMs)},g.prototype._performBackoff=function(){this._preferredUri?(this._log.info("Preferred URI set; backing off."),this._backoff.preferred.backoff()):(this._log.info("Preferred URI not set; backing off."),this._backoff.primary.backoff())},g.prototype._resetBackoffs=function(){this._backoff.preferred.reset(),this._backoff.primary.reset(),this._backoffStartTime.preferred=null,this._backoffStartTime.primary=null},g.prototype._setHeartbeatTimeout=function(){var T=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout(function(){T._log.info("No messages received in "+f/1e3+" seconds. Reconnecting..."),T._shouldFallback=!0,T._closeSocket()},f)},g.prototype._setState=function(T){this._previousState=this.state,this.state=T},g.prototype._setupBackoffs=function(){var T=this,_={factor:2,jitter:.4,max:this._options.maxPreferredDelayMs,min:100};this._log.info("Initializing preferred transport backoff using config: ",_);var y=new o.default(_);y.on("backoff",function(h,L){if(T.state===w.Closed){T._log.info("Preferred backoff initiated but transport state is closed; not attempting a connection.");return}T._log.info("Will attempt to reconnect Websocket to preferred URI in "+L+"ms"),h===0&&(T._backoffStartTime.preferred=Date.now(),T._log.info("Preferred backoff start; "+T._backoffStartTime.preferred))}),y.on("ready",function(h,L){if(T.state===w.Closed){T._log.info("Preferred backoff ready but transport state is closed; not attempting a connection.");return}if(T._backoffStartTime.preferred===null){T._log.info("Preferred backoff start time invalid; not attempting a connection.");return}if(Date.now()-T._backoffStartTime.preferred>T._options.maxPreferredDurationMs){T._log.info("Max preferred backoff attempt time exceeded; falling back to primary backoff."),T._preferredUri=null,T._backoff.primary.backoff();return}if(typeof T._preferredUri!="string"){T._log.info("Preferred URI cleared; falling back to primary backoff."),T._preferredUri=null,T._backoff.primary.backoff();return}T._connect(T._preferredUri,h+1)});var S={factor:2,jitter:.4,max:this._options.maxPrimaryDelayMs,min:this._uris&&this._uris.length>1?Math.floor(Math.random()*(5e3-1e3+1))+1e3:100};this._log.info("Initializing primary transport backoff using config: ",S);var D=new o.default(S);return D.on("backoff",function(h,L){if(T.state===w.Closed){T._log.info("Primary backoff initiated but transport state is closed; not attempting a connection.");return}T._log.info("Will attempt to reconnect WebSocket in "+L+"ms"),h===0&&(T._backoffStartTime.primary=Date.now(),T._log.info("Primary backoff start; "+T._backoffStartTime.primary))}),D.on("ready",function(h,L){if(T.state===w.Closed){T._log.info("Primary backoff ready but transport state is closed; not attempting a connection.");return}if(T._backoffStartTime.primary===null){T._log.info("Primary backoff start time invalid; not attempting a connection.");return}if(Date.now()-T._backoffStartTime.primary>T._options.maxPrimaryDurationMs){T._log.info("Max primary backoff attempt time exceeded; not attempting a connection.");return}T._connect(T._uris[T._uriIndex],h+1)}),{preferred:y,primary:D}},Object.defineProperty(g.prototype,"uri",{get:function(){return this._connectedUri},enumerable:!1,configurable:!0}),g.defaultConstructorOptions={WebSocket:a,connectTimeoutMs:d,maxPreferredDelayMs:m,maxPreferredDurationMs:u,maxPrimaryDelayMs:E,maxPrimaryDurationMs:l},g}(r.EventEmitter);t.default=v})(Wn);var Ao=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();Object.defineProperty(Pt,"__esModule",{value:!0});var xo=ve,Do=ie,It=oe,Oo=se,Mo=Wn,Lo="1.6",jo=30,te=function(t){Ao(n,t);function n(e,r,o){var i=t.call(this)||this;if(!(i instanceof n))return new n(e,r,o);var c={TransportFactory:Mo.default};o=o||{};for(var a in c)a in o||(o[a]=c[a]);i.options=o,i.token=e||"",i.status="disconnected",i.gateway=null,i.region=null,i._messageQueue=[],i._preferredUri=null,i._uris=r,i._handleTransportClose=i._handleTransportClose.bind(i),i._handleTransportError=i._handleTransportError.bind(i),i._handleTransportMessage=i._handleTransportMessage.bind(i),i._handleTransportOpen=i._handleTransportOpen.bind(i),i._log=new Oo.default("PStream"),i.on("error",function(){i._log.warn("Unexpected error handled in pstream")});var p=i;return i.addListener("ready",function(){p.status="ready"}),i.addListener("offline",function(){p.status="offline"}),i.addListener("close",function(){p._log.info('Received "close" from server. Destroying PStream...'),p._destroy()}),i.transport=new i.options.TransportFactory(i._uris,{backoffMaxMs:i.options.backoffMaxMs,maxPreferredDurationMs:i.options.maxPreferredDurationMs}),Object.defineProperties(i,{uri:{enumerable:!0,get:function(){return this.transport.uri}}}),i.transport.on("close",i._handleTransportClose),i.transport.on("error",i._handleTransportError),i.transport.on("message",i._handleTransportMessage),i.transport.on("open",i._handleTransportOpen),i.transport.open(),i}return n}(xo.EventEmitter);te.prototype._handleTransportClose=function(){this.emit("transportClose"),this.status!=="disconnected"&&(this.status!=="offline"&&this.emit("offline",this),this.status="disconnected")};te.prototype._handleTransportError=function(t){if(!t){this.emit("error",{error:{code:31e3,message:"Websocket closed without a provided reason",twilioError:new It.SignalingErrors.ConnectionDisconnected}});return}this.emit("error",typeof t.code<"u"?{error:t}:t)};te.prototype._handleTransportMessage=function(t){if(!(!t||!t.data||typeof t.data!="string")){var n=JSON.parse(t.data),e=n.type,r=n.payload,o=r===void 0?{}:r;this.gateway=o.gateway||this.gateway,this.region=o.region||this.region,e==="error"&&o.error&&(o.error.twilioError=new It.SignalingErrors.ConnectionError),this.emit(e,o)}};te.prototype._handleTransportOpen=function(){var t=this;this.status="connected",this.setToken(this.token),this.emit("transportOpen");var n=this._messageQueue.splice(0,this._messageQueue.length);n.forEach(function(e){return t._publish.apply(t,e)})};te.toString=function(){return"[Twilio.PStream class]"};te.prototype.toString=function(){return"[Twilio.PStream instance]"};te.prototype.setToken=function(t){this._log.info("Setting token and publishing listen"),this.token=t;var n=0,e=this.options.maxPreferredDurationMs;this._log.info("maxPreferredDurationMs:"+e),typeof e=="number"&&e>=0&&(n=Math.min(Math.ceil(e/1e3),jo)),this._log.info("reconnectTimeout:"+n);var r={browserinfo:Uo(),reconnectTimeout:n,token:t};this._publish("listen",r)};te.prototype.sendMessage=function(t,n,e,r,o){e===void 0&&(e="application/json");var i={callsid:t,content:n,contenttype:e,messagetype:r,voiceeventsid:o};this._publish("message",i,!0)};te.prototype.register=function(t){var n={media:t};this._publish("register",n,!0)};te.prototype.invite=function(t,n,e,r){var o={callsid:n,preflight:!!e,sdp:t,twilio:r?{params:r}:{}};this._publish("invite",o,!0)};te.prototype.reconnect=function(t,n,e,r){var o={callsid:n,preflight:!1,reconnect:e,sdp:t,twilio:r?{params:r}:{}};this._publish("invite",o,!0)};te.prototype.answer=function(t,n){this._publish("answer",{sdp:t,callsid:n},!0)};te.prototype.dtmf=function(t,n){this._publish("dtmf",{callsid:t,dtmf:n},!0)};te.prototype.hangup=function(t,n){var e=n?{callsid:t,message:n}:{callsid:t};this._publish("hangup",e,!0)};te.prototype.reject=function(t){this._publish("reject",{callsid:t},!0)};te.prototype.reinvite=function(t,n){this._publish("reinvite",{sdp:t,callsid:n},!1)};te.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)};te.prototype.destroy=function(){return this._log.info("PStream.destroy() called..."),this._destroy(),this};te.prototype.updatePreferredURI=function(t){this._preferredUri=t,this.transport.updatePreferredURI(t)};te.prototype.updateURIs=function(t){this._uris=t,this.transport.updateURIs(this._uris)};te.prototype.publish=function(t,n){return this._publish(t,n,!0)};te.prototype._publish=function(t,n,e){var r=JSON.stringify({payload:n,type:t,version:Lo}),o=!!this.transport.send(r);o||(this.emit("error",{error:{code:31009,message:"No transport available to send or receive messages",twilioError:new It.GeneralErrors.TransportError}}),e&&this._messageQueue.push([t,n,!0]))};function Uo(){var t=typeof navigator<"u"?navigator:{},n={browser:{platform:t.platform||"unknown",userAgent:t.userAgent||"unknown"},p:"browser",plugin:"rtc",v:Do.RELEASE_VERSION};return n}Pt.default=te;var Gn={};(function(t){var n;Object.defineProperty(t,"__esModule",{value:!0}),t.getRegionShortcode=t.getChunderURIs=t.createSignalingEndpointURL=t.createEventGatewayURI=t.defaultEdge=t.regionToEdge=t.regionShortcodes=t.Region=t.Edge=void 0;var e=oe,r;(function(u){u.Sydney="sydney",u.SaoPaulo="sao-paulo",u.Dublin="dublin",u.Frankfurt="frankfurt",u.Tokyo="tokyo",u.Singapore="singapore",u.Ashburn="ashburn",u.Umatilla="umatilla",u.Roaming="roaming",u.AshburnIx="ashburn-ix",u.SanJoseIx="san-jose-ix",u.LondonIx="london-ix",u.FrankfurtIx="frankfurt-ix",u.SingaporeIx="singapore-ix",u.SydneyIx="sydney-ix",u.TokyoIx="tokyo-ix"})(r=t.Edge||(t.Edge={}));var o;(function(u){u.Au1="au1",u.Au1Ix="au1-ix",u.Br1="br1",u.De1="de1",u.De1Ix="de1-ix",u.Gll="gll",u.Ie1="ie1",u.Ie1Ix="ie1-ix",u.Ie1Tnx="ie1-tnx",u.Jp1="jp1",u.Jp1Ix="jp1-ix",u.Sg1="sg1",u.Sg1Ix="sg1-ix",u.Sg1Tnx="sg1-tnx",u.Us1="us1",u.Us1Ix="us1-ix",u.Us1Tnx="us1-tnx",u.Us2="us2",u.Us2Ix="us2-ix",u.Us2Tnx="us2-tnx"})(o=t.Region||(t.Region={})),t.regionShortcodes={ASIAPAC_SINGAPORE:o.Sg1,ASIAPAC_SYDNEY:o.Au1,ASIAPAC_TOKYO:o.Jp1,EU_FRANKFURT:o.De1,EU_IRELAND:o.Ie1,SOUTH_AMERICA_SAO_PAULO:o.Br1,US_EAST_VIRGINIA:o.Us1,US_WEST_OREGON:o.Us2},t.regionToEdge=(n={},n[o.Au1]=r.Sydney,n[o.Br1]=r.SaoPaulo,n[o.Ie1]=r.Dublin,n[o.De1]=r.Frankfurt,n[o.Jp1]=r.Tokyo,n[o.Sg1]=r.Singapore,n[o.Us1]=r.Ashburn,n[o.Us2]=r.Umatilla,n[o.Gll]=r.Roaming,n[o.Us1Ix]=r.AshburnIx,n[o.Us2Ix]=r.SanJoseIx,n[o.Ie1Ix]=r.LondonIx,n[o.De1Ix]=r.FrankfurtIx,n[o.Sg1Ix]=r.SingaporeIx,n[o.Au1Ix]=r.SydneyIx,n[o.Jp1Ix]=r.TokyoIx,n[o.Us1Tnx]=r.AshburnIx,n[o.Us2Tnx]=r.AshburnIx,n[o.Ie1Tnx]=r.LondonIx,n[o.Sg1Tnx]=r.SingaporeIx,n),t.defaultEdge=r.Roaming;var i="eventgw.twilio.com";function c(u){return"voice-js."+u+".twilio.com"}function a(u){return u?"eventgw."+u+".twilio.com":i}t.createEventGatewayURI=a;function p(u){return"wss://"+u+"/signal"}t.createSignalingEndpointURL=p;function d(u){if(u&&typeof u!="string"&&!Array.isArray(u))throw new e.InvalidArgumentError("If `edge` is provided, it must be of type `string` or an array of strings.");var l;if(u){var m=Array.isArray(u)?u:[u];l=m.map(function(E){return c(E)})}else l=[c(t.defaultEdge)];return l}t.getChunderURIs=d;function f(u){return t.regionShortcodes[u]||null}t.getRegionShortcode=f})(Gn);var be={},kt={},Ze={},de={};Object.defineProperty(de,"__esModule",{value:!0});de.setMaxAverageBitrate=de.setIceAggressiveNomination=de.setCodecPreferences=de.getPreferredCodecInfo=void 0;var He=K,Zt={0:"PCMU",8:"PCMA"},No=111,Fo=51e4,Bo=6e3;function Vo(t){var n=/a=rtpmap:(\d+) (\S+)/m.exec(t)||[null,"",""],e=n[1],r=n[2],o=new RegExp("a=fmtp:"+e+" (\\S+)","m"),i=o.exec(t)||[null,""],c=i[1];return{codecName:r,codecParams:c}}de.getPreferredCodecInfo=Vo;function Wo(t){return He.isChrome(window,window.navigator)?t.split(`
`).filter(function(n){return n.indexOf("a=ice-lite")===-1}).join(`
`):t}de.setIceAggressiveNomination=Wo;function Go(t,n){if(typeof n!="number"||n<Bo||n>Fo)return t;var e=/a=rtpmap:(\d+) opus/m.exec(t),r=e&&e.length?e[1]:No,o=new RegExp("a=fmtp:"+r),i=t.split(`
`).map(function(c){return o.test(c)?c+(";maxaveragebitrate="+n):c});return i.join(`
`)}de.setMaxAverageBitrate=Go;function Ho(t,n){var e=$o(t),r=t.split(`\r
m=`)[0];return[r].concat(e.map(function(o){if(!/^m=(audio|video)/.test(o))return o;var i=o.match(/^m=(audio|video)/)[1],c=qo(o),a=zo(c,n),p=Jo(a,o),d=c.get("pcma")||[],f=c.get("pcmu")||[],u=i==="audio"?new Set(d.concat(f)):new Set;return u.has(a[0])?p.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):p})).join(`\r
`)}de.setCodecPreferences=Ho;function $o(t,n,e){return t.replace(/\r\n\r\n$/,`\r
`).split(`\r
m=`).slice(1).map(function(r){return"m="+r}).filter(function(r){var o=new RegExp("m="+(n||".*"),"gm"),i=new RegExp("a="+(e||".*"),"gm");return o.test(r)&&i.test(r)})}function qo(t){return Array.from(Ko(t)).reduce(function(n,e){var r=e[0],o=e[1],i=n.get(o)||[];return n.set(o,i.concat(r))},new Map)}function zo(t,n){n=n.map(function(i){return i.toLowerCase()});var e=He.flatMap(n,function(i){return t.get(i)||[]}),r=He.difference(Array.from(t.keys()),n),o=He.flatMap(r,function(i){return t.get(i)});return e.concat(o)}function Jo(t,n){var e=n.split(`\r
`),r=e[0],o=e.slice(1);return r=r.replace(/([0-9]+\s?)+$/,t.join(" ")),[r].concat(o).join(`\r
`)}function Ko(t){return Qo(t).reduce(function(n,e){var r=new RegExp("a=rtpmap:"+e+" ([^/]+)"),o=t.match(r),i=o?o[1].toLowerCase():Zt[e]?Zt[e].toLowerCase():"";return n.set(e,i)},new Map)}function Qo(t){var n=t.split(`\r
`)[0],e=n.match(/([0-9]+)/g);return e?e.slice(1).map(function(r){return parseInt(r,10)}):[]}var Hn={exports:{}};(function(t){var n={};n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split(`
`).map(function(r){return r.trim()})},n.splitSections=function(e){var r=e.split(`
m=`);return r.map(function(o,i){return(i>0?"m="+o:o).trim()+`\r
`})},n.getDescription=function(e){var r=n.splitSections(e);return r&&r[0]},n.getMediaSections=function(e){var r=n.splitSections(e);return r.shift(),r},n.matchPrefix=function(e,r){return n.splitLines(e).filter(function(o){return o.indexOf(r)===0})},n.parseCandidate=function(e){var r;e.indexOf("a=candidate:")===0?r=e.substring(12).split(" "):r=e.substring(10).split(" ");for(var o={foundation:r[0],component:parseInt(r[1],10),protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]},i=8;i<r.length;i+=2)switch(r[i]){case"raddr":o.relatedAddress=r[i+1];break;case"rport":o.relatedPort=parseInt(r[i+1],10);break;case"tcptype":o.tcpType=r[i+1];break;case"ufrag":o.ufrag=r[i+1],o.usernameFragment=r[i+1];break;default:o[r[i]]=r[i+1];break}return o},n.writeCandidate=function(e){var r=[];r.push(e.foundation),r.push(e.component),r.push(e.protocol.toUpperCase()),r.push(e.priority),r.push(e.address||e.ip),r.push(e.port);var o=e.type;return r.push("typ"),r.push(o),o!=="host"&&e.relatedAddress&&e.relatedPort&&(r.push("raddr"),r.push(e.relatedAddress),r.push("rport"),r.push(e.relatedPort)),e.tcpType&&e.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(r.push("ufrag"),r.push(e.usernameFragment||e.ufrag)),"candidate:"+r.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var r=e.substr(9).split(" "),o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},n.writeRtpMap=function(e){var r=e.payloadType;e.preferredPayloadType!==void 0&&(r=e.preferredPayloadType);var o=e.channels||e.numChannels||1;return"a=rtpmap:"+r+" "+e.name+"/"+e.clockRate+(o!==1?"/"+o:"")+`\r
`},n.parseExtmap=function(e){var r=e.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&e.direction!=="sendrecv"?"/"+e.direction:"")+" "+e.uri+`\r
`},n.parseFmtp=function(e){for(var r={},o,i=e.substr(e.indexOf(" ")+1).split(";"),c=0;c<i.length;c++)o=i[c].trim().split("="),r[o[0].trim()]=o[1];return r},n.writeFmtp=function(e){var r="",o=e.payloadType;if(e.preferredPayloadType!==void 0&&(o=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(c){e.parameters[c]?i.push(c+"="+e.parameters[c]):i.push(c)}),r+="a=fmtp:"+o+" "+i.join(";")+`\r
`}return r},n.parseRtcpFb=function(e){var r=e.substr(e.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},n.writeRtcpFb=function(e){var r="",o=e.payloadType;return e.preferredPayloadType!==void 0&&(o=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(i){r+="a=rtcp-fb:"+o+" "+i.type+(i.parameter&&i.parameter.length?" "+i.parameter:"")+`\r
`}),r},n.parseSsrcMedia=function(e){var r=e.indexOf(" "),o={ssrc:parseInt(e.substr(7,r-7),10)},i=e.indexOf(":",r);return i>-1?(o.attribute=e.substr(r+1,i-r-1),o.value=e.substr(i+1)):o.attribute=e.substr(r+1),o},n.parseSsrcGroup=function(e){var r=e.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(function(o){return parseInt(o,10)})}},n.getMid=function(e){var r=n.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},n.parseFingerprint=function(e){var r=e.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1]}},n.getDtlsParameters=function(e,r){var o=n.matchPrefix(e+r,"a=fingerprint:");return{role:"auto",fingerprints:o.map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,r){var o="a=setup:"+r+`\r
`;return e.fingerprints.forEach(function(i){o+="a=fingerprint:"+i.algorithm+" "+i.value+`\r
`}),o},n.parseCryptoLine=function(e){var r=e.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+(typeof e.keyParams=="object"?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+`\r
`},n.parseCryptoKeyParams=function(e){if(e.indexOf("inline:")!==0)return null;var r=e.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,r){var o=n.matchPrefix(e+r,"a=crypto:");return o.map(n.parseCryptoLine)},n.getIceParameters=function(e,r){var o=n.matchPrefix(e+r,"a=ice-ufrag:")[0],i=n.matchPrefix(e+r,"a=ice-pwd:")[0];return o&&i?{usernameFragment:o.substr(12),password:i.substr(10)}:null},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+`\r
a=ice-pwd:`+e.password+`\r
`},n.parseRtpParameters=function(e){for(var r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=n.splitLines(e),i=o[0].split(" "),c=3;c<i.length;c++){var a=i[c],p=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(p){var d=n.parseRtpMap(p),f=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(d.parameters=f.length?n.parseFmtp(f[0]):{},d.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase());break}}}return n.matchPrefix(e,"a=extmap:").forEach(function(u){r.headerExtensions.push(n.parseExtmap(u))}),r},n.writeRtpDescription=function(e,r){var o="";o+="m="+e+" ",o+=r.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=r.codecs.map(function(c){return c.preferredPayloadType!==void 0?c.preferredPayloadType:c.payloadType}).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(function(c){o+=n.writeRtpMap(c),o+=n.writeFmtp(c),o+=n.writeRtcpFb(c)});var i=0;return r.codecs.forEach(function(c){c.maxptime>i&&(i=c.maxptime)}),i>0&&(o+="a=maxptime:"+i+`\r
`),o+=`a=rtcp-mux\r
`,r.headerExtensions&&r.headerExtensions.forEach(function(c){o+=n.writeExtmap(c)}),o},n.parseRtpEncodingParameters=function(e){var r=[],o=n.parseRtpParameters(e),i=o.fecMechanisms.indexOf("RED")!==-1,c=o.fecMechanisms.indexOf("ULPFEC")!==-1,a=n.matchPrefix(e,"a=ssrc:").map(function(l){return n.parseSsrcMedia(l)}).filter(function(l){return l.attribute==="cname"}),p=a.length>0&&a[0].ssrc,d,f=n.matchPrefix(e,"a=ssrc-group:FID").map(function(l){var m=l.substr(17).split(" ");return m.map(function(E){return parseInt(E,10)})});f.length>0&&f[0].length>1&&f[0][0]===p&&(d=f[0][1]),o.codecs.forEach(function(l){if(l.name.toUpperCase()==="RTX"&&l.parameters.apt){var m={ssrc:p,codecPayloadType:parseInt(l.parameters.apt,10)};p&&d&&(m.rtx={ssrc:d}),r.push(m),i&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:p,mechanism:c?"red+ulpfec":"red"},r.push(m))}}),r.length===0&&p&&r.push({ssrc:p});var u=n.matchPrefix(e,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,r.forEach(function(l){l.maxBitrate=u})),r},n.parseRtcpParameters=function(e){var r={},o=n.matchPrefix(e,"a=ssrc:").map(function(a){return n.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=i.length>0,r.compound=i.length===0;var c=n.matchPrefix(e,"a=rtcp-mux");return r.mux=c.length>0,r},n.parseMsid=function(e){var r,o=n.matchPrefix(e,"a=msid:");if(o.length===1)return r=o[0].substr(7).split(" "),{stream:r[0],track:r[1]};var i=n.matchPrefix(e,"a=ssrc:").map(function(c){return n.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="msid"});if(i.length>0)return r=i[0].value.split(" "),{stream:r[0],track:r[1]}},n.parseSctpDescription=function(e){var r=n.parseMLine(e),o=n.matchPrefix(e,"a=max-message-size:"),i;o.length>0&&(i=parseInt(o[0].substr(19),10)),isNaN(i)&&(i=65536);var c=n.matchPrefix(e,"a=sctp-port:");if(c.length>0)return{port:parseInt(c[0].substr(12),10),protocol:r.fmt,maxMessageSize:i};var a=n.matchPrefix(e,"a=sctpmap:");if(a.length>0){var p=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(p[0],10),protocol:p[1],maxMessageSize:i}}},n.writeSctpDescription=function(e,r){var o=[];return e.protocol!=="DTLS/SCTP"?o=["m="+e.kind+" 9 "+e.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:o=["m="+e.kind+" 9 "+e.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,r,o){var i,c=r!==void 0?r:2;e?i=e:i=n.generateSessionId();var a=o||"thisisadapterortc";return`v=0\r
o=`+a+" "+i+" "+c+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},n.writeMediaSection=function(e,r,o,i){var c=n.writeRtpDescription(e.kind,r);if(c+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),c+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),o==="offer"?"actpass":"active"),c+="a=mid:"+e.mid+`\r
`,e.direction?c+="a="+e.direction+`\r
`:e.rtpSender&&e.rtpReceiver?c+=`a=sendrecv\r
`:e.rtpSender?c+=`a=sendonly\r
`:e.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+`\r
`;c+="a="+a,c+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,c+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return c+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+`\r
`,e.rtpSender&&e.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+`\r
`),c},n.getDirection=function(e,r){for(var o=n.splitLines(e),i=0;i<o.length;i++)switch(o[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[i].substr(2)}return r?n.getDirection(r):"sendrecv"},n.getKind=function(e){var r=n.splitLines(e),o=r[0].split(" ");return o[0].substr(2)},n.isRejected=function(e){return e.split(" ",2)[1]==="0"},n.parseMLine=function(e){var r=n.splitLines(e),o=r[0].substr(2).split(" ");return{kind:o[0],port:parseInt(o[1],10),protocol:o[2],fmt:o.slice(3).join(" ")}},n.parseOLine=function(e){var r=n.matchPrefix(e,"o=")[0],o=r.substr(2).split(" ");return{username:o[0],sessionId:o[1],sessionVersion:parseInt(o[2],10),netType:o[3],addressType:o[4],address:o[5]}},n.isValidSDP=function(e){if(typeof e!="string"||e.length===0)return!1;for(var r=n.splitLines(e),o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},t.exports=n})(Hn);var Xo=Hn.exports,W=Xo;function en(t,n,e,r,o){var i=W.writeRtpDescription(t.kind,n);if(i+=W.writeIceParameters(t.iceGatherer.getLocalParameters()),i+=W.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),e==="offer"?"actpass":o||"active"),i+="a=mid:"+t.mid+`\r
`,t.rtpSender&&t.rtpReceiver?i+=`a=sendrecv\r
`:t.rtpSender?i+=`a=sendonly\r
`:t.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,t.rtpSender){var c=t.rtpSender._initialTrackId||t.rtpSender.track.id;t.rtpSender._initialTrackId=c;var a="msid:"+(r?r.id:"-")+" "+c+`\r
`;i+="a="+a,i+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+a,t.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+a,i+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+W.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+W.localCName+`\r
`),i}function Yo(t,n){var e=!1;return t=JSON.parse(JSON.stringify(t)),t.filter(function(r){if(r&&(r.urls||r.url)){var o=r.urls||r.url;r.url&&!r.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i=typeof o=="string";return i&&(o=[o]),o=o.filter(function(c){var a=c.indexOf("turn:")===0&&c.indexOf("transport=udp")!==-1&&c.indexOf("turn:[")===-1&&!e;return a?(e=!0,!0):c.indexOf("stun:")===0&&n>=14393&&c.indexOf("?transport=udp")===-1}),delete r.url,r.urls=i?o[0]:o,!!o.length}})}function at(t,n){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(i,c){i=parseInt(i,10);for(var a=0;a<c.length;a++)if(c[a].payloadType===i||c[a].preferredPayloadType===i)return c[a]},o=function(i,c,a,p){var d=r(i.parameters.apt,a),f=r(c.parameters.apt,p);return d&&f&&d.name.toLowerCase()===f.name.toLowerCase()};return t.codecs.forEach(function(i){for(var c=0;c<n.codecs.length;c++){var a=n.codecs[c];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate){if(i.name.toLowerCase()==="rtx"&&i.parameters&&a.parameters.apt&&!o(i,a,t.codecs,n.codecs))continue;a=JSON.parse(JSON.stringify(a)),a.numChannels=Math.min(i.numChannels,a.numChannels),e.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(p){for(var d=0;d<i.rtcpFeedback.length;d++)if(i.rtcpFeedback[d].type===p.type&&i.rtcpFeedback[d].parameter===p.parameter)return!0;return!1});break}}}),t.headerExtensions.forEach(function(i){for(var c=0;c<n.headerExtensions.length;c++){var a=n.headerExtensions[c];if(i.uri===a.uri){e.headerExtensions.push(a);break}}}),e}function tn(t,n,e){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][t].indexOf(e)!==-1}function st(t,n){var e=t.getRemoteCandidates().find(function(r){return n.foundation===r.foundation&&n.ip===r.ip&&n.port===r.port&&n.priority===r.priority&&n.protocol===r.protocol&&n.type===r.type});return e||t.addRemoteCandidate(n),!e}function ce(t,n){var e=new Error(n);return e.name=t,e}var Zo=function(t,n){function e(a,p){p.addTrack(a),p.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:a}))}function r(a,p){p.removeTrack(a),p.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:a}))}function o(a,p,d,f){var u=new Event("track");u.track=p,u.receiver=d,u.transceiver={receiver:d},u.streams=f,t.setTimeout(function(){a._dispatchEvent("track",u)})}var i=function(a){var p=this,d=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(u){p[u]=d[u].bind(d)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",a=JSON.parse(JSON.stringify(a||{})),this.usingBundle=a.bundlePolicy==="max-bundle",a.rtcpMuxPolicy==="negotiate")throw ce("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require"),a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all";break}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced";break}if(a.iceServers=Yo(a.iceServers||[],n),this._iceGatherers=[],a.iceCandidatePoolSize)for(var f=a.iceCandidatePoolSize;f>0;f--)this._iceGatherers.push(new t.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy}));else a.iceCandidatePoolSize=0;this._config=a,this.transceivers=[],this._sdpSessionId=W.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};i.prototype.onicecandidate=null,i.prototype.onaddstream=null,i.prototype.ontrack=null,i.prototype.onremovestream=null,i.prototype.onsignalingstatechange=null,i.prototype.oniceconnectionstatechange=null,i.prototype.onicegatheringstatechange=null,i.prototype.onnegotiationneeded=null,i.prototype.ondatachannel=null,i.prototype._dispatchEvent=function(a,p){this._isClosed||(this.dispatchEvent(p),typeof this["on"+a]=="function"&&this["on"+a](p))},i.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},i.prototype.getConfiguration=function(){return this._config},i.prototype.getLocalStreams=function(){return this.localStreams},i.prototype.getRemoteStreams=function(){return this.remoteStreams},i.prototype._createTransceiver=function(a){var p=this.transceivers.length>0,d={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&p)d.iceTransport=this.transceivers[0].iceTransport,d.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();d.iceTransport=f.iceTransport,d.dtlsTransport=f.dtlsTransport}return this.transceivers.push(d),d},i.prototype.addTrack=function(a,p){if(this._isClosed)throw ce("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var d=this.transceivers.find(function(l){return l.track===a});if(d)throw ce("InvalidAccessError","Track already exists.");for(var f,u=0;u<this.transceivers.length;u++)!this.transceivers[u].track&&this.transceivers[u].kind===a.kind&&(f=this.transceivers[u]);return f||(f=this._createTransceiver(a.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(p)===-1&&this.localStreams.push(p),f.track=a,f.stream=p,f.rtpSender=new t.RTCRtpSender(a,f.dtlsTransport),f.rtpSender},i.prototype.addStream=function(a){var p=this;if(n>=15025)a.getTracks().forEach(function(f){p.addTrack(f,a)});else{var d=a.clone();a.getTracks().forEach(function(f,u){var l=d.getTracks()[u];f.addEventListener("enabled",function(m){l.enabled=m.enabled})}),d.getTracks().forEach(function(f){p.addTrack(f,d)})}},i.prototype.removeTrack=function(a){if(this._isClosed)throw ce("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var p=this.transceivers.find(function(u){return u.rtpSender===a});if(!p)throw ce("InvalidAccessError","Sender was not created by this connection.");var d=p.stream;p.rtpSender.stop(),p.rtpSender=null,p.track=null,p.stream=null;var f=this.transceivers.map(function(u){return u.stream});f.indexOf(d)===-1&&this.localStreams.indexOf(d)>-1&&this.localStreams.splice(this.localStreams.indexOf(d),1),this._maybeFireNegotiationNeeded()},i.prototype.removeStream=function(a){var p=this;a.getTracks().forEach(function(d){var f=p.getSenders().find(function(u){return u.track===d});f&&p.removeTrack(f)})},i.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},i.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},i.prototype._createIceGatherer=function(a,p){var d=this;if(p&&a>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var f=new t.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(f,"state",{value:"new",writable:!0}),this.transceivers[a].bufferedCandidateEvents=[],this.transceivers[a].bufferCandidates=function(u){var l=!u.candidate||Object.keys(u.candidate).length===0;f.state=l?"completed":"gathering",d.transceivers[a].bufferedCandidateEvents!==null&&d.transceivers[a].bufferedCandidateEvents.push(u)},f.addEventListener("localcandidate",this.transceivers[a].bufferCandidates),f},i.prototype._gather=function(a,p){var d=this,f=this.transceivers[p].iceGatherer;if(!f.onlocalcandidate){var u=this.transceivers[p].bufferedCandidateEvents;this.transceivers[p].bufferedCandidateEvents=null,f.removeEventListener("localcandidate",this.transceivers[p].bufferCandidates),f.onlocalcandidate=function(l){if(!(d.usingBundle&&p>0)){var m=new Event("icecandidate");m.candidate={sdpMid:a,sdpMLineIndex:p};var E=l.candidate,w=!E||Object.keys(E).length===0;if(w)(f.state==="new"||f.state==="gathering")&&(f.state="completed");else{f.state==="new"&&(f.state="gathering"),E.component=1;var v=W.writeCandidate(E);m.candidate=Object.assign(m.candidate,W.parseCandidate(v)),m.candidate.candidate=v}var b=W.getMediaSections(d.localDescription.sdp);w?b[m.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:b[m.candidate.sdpMLineIndex]+="a="+m.candidate.candidate+`\r
`,d.localDescription.sdp=W.getDescription(d.localDescription.sdp)+b.join("");var g=d.transceivers.every(function(T){return T.iceGatherer&&T.iceGatherer.state==="completed"});d.iceGatheringState!=="gathering"&&(d.iceGatheringState="gathering",d._emitGatheringStateChange()),w||d._dispatchEvent("icecandidate",m),g&&(d._dispatchEvent("icecandidate",new Event("icecandidate")),d.iceGatheringState="complete",d._emitGatheringStateChange())}},t.setTimeout(function(){u.forEach(function(l){f.onlocalcandidate(l)})},0)}},i.prototype._createIceAndDtlsTransports=function(){var a=this,p=new t.RTCIceTransport(null);p.onicestatechange=function(){a._updateConnectionState()};var d=new t.RTCDtlsTransport(p);return d.ondtlsstatechange=function(){a._updateConnectionState()},d.onerror=function(){Object.defineProperty(d,"state",{value:"failed",writable:!0}),a._updateConnectionState()},{iceTransport:p,dtlsTransport:d}},i.prototype._disposeIceAndDtlsTransports=function(a){var p=this.transceivers[a].iceGatherer;p&&(delete p.onlocalcandidate,delete this.transceivers[a].iceGatherer);var d=this.transceivers[a].iceTransport;d&&(delete d.onicestatechange,delete this.transceivers[a].iceTransport);var f=this.transceivers[a].dtlsTransport;f&&(delete f.ondtlsstatechange,delete f.onerror,delete this.transceivers[a].dtlsTransport)},i.prototype._transceive=function(a,p,d){var f=at(a.localCapabilities,a.remoteCapabilities);p&&a.rtpSender&&(f.encodings=a.sendEncodingParameters,f.rtcp={cname:W.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(f.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(f)),d&&a.rtpReceiver&&f.codecs.length>0&&(a.kind==="video"&&a.recvEncodingParameters&&n<15019&&a.recvEncodingParameters.forEach(function(u){delete u.rtx}),a.recvEncodingParameters.length?f.encodings=a.recvEncodingParameters:f.encodings=[{}],f.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(f.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(f.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(f))},i.prototype.setLocalDescription=function(a){var p=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(ce("TypeError",'Unsupported type "'+a.type+'"'));if(!tn("setLocalDescription",a.type,p.signalingState)||p._isClosed)return Promise.reject(ce("InvalidStateError","Can not set local "+a.type+" in state "+p.signalingState));var d,f;if(a.type==="offer")d=W.splitSections(a.sdp),f=d.shift(),d.forEach(function(l,m){var E=W.parseRtpParameters(l);p.transceivers[m].localCapabilities=E}),p.transceivers.forEach(function(l,m){p._gather(l.mid,m)});else if(a.type==="answer"){d=W.splitSections(p.remoteDescription.sdp),f=d.shift();var u=W.matchPrefix(f,"a=ice-lite").length>0;d.forEach(function(l,m){var E=p.transceivers[m],w=E.iceGatherer,v=E.iceTransport,b=E.dtlsTransport,g=E.localCapabilities,T=E.remoteCapabilities,_=W.isRejected(l)&&W.matchPrefix(l,"a=bundle-only").length===0;if(!_&&!E.isDatachannel){var y=W.getIceParameters(l,f),S=W.getDtlsParameters(l,f);u&&(S.role="server"),(!p.usingBundle||m===0)&&(p._gather(E.mid,m),v.state==="new"&&v.start(w,y,u?"controlling":"controlled"),b.state==="new"&&b.start(S));var D=at(g,T);p._transceive(E,D.codecs.length>0,!1)}})}return p.localDescription={type:a.type,sdp:a.sdp},a.type==="offer"?p._updateSignalingState("have-local-offer"):p._updateSignalingState("stable"),Promise.resolve()},i.prototype.setRemoteDescription=function(a){var p=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(ce("TypeError",'Unsupported type "'+a.type+'"'));if(!tn("setRemoteDescription",a.type,p.signalingState)||p._isClosed)return Promise.reject(ce("InvalidStateError","Can not set remote "+a.type+" in state "+p.signalingState));var d={};p.remoteStreams.forEach(function(v){d[v.id]=v});var f=[],u=W.splitSections(a.sdp),l=u.shift(),m=W.matchPrefix(l,"a=ice-lite").length>0,E=W.matchPrefix(l,"a=group:BUNDLE ").length>0;p.usingBundle=E;var w=W.matchPrefix(l,"a=ice-options:")[0];return w?p.canTrickleIceCandidates=w.substr(14).split(" ").indexOf("trickle")>=0:p.canTrickleIceCandidates=!1,u.forEach(function(v,b){var g=W.splitLines(v),T=W.getKind(v),_=W.isRejected(v)&&W.matchPrefix(v,"a=bundle-only").length===0,y=g[0].substr(2).split(" ")[2],S=W.getDirection(v,l),D=W.parseMsid(v),h=W.getMid(v)||W.generateIdentifier();if(T==="application"&&y==="DTLS/SCTP"){p.transceivers[b]={mid:h,isDatachannel:!0};return}var L,U,k,C,P,s,M,I,j,A=W.parseRtpParameters(v),x,R;_||(x=W.getIceParameters(v,l),R=W.getDtlsParameters(v,l),R.role="client"),M=W.parseRtpEncodingParameters(v);var O=W.parseRtcpParameters(v),F=W.matchPrefix(v,"a=end-of-candidates",l).length>0,G=W.matchPrefix(v,"a=candidate:").map(function(J){return W.parseCandidate(J)}).filter(function(J){return J.component===1});if((a.type==="offer"||a.type==="answer")&&!_&&E&&b>0&&p.transceivers[b]&&(p._disposeIceAndDtlsTransports(b),p.transceivers[b].iceGatherer=p.transceivers[0].iceGatherer,p.transceivers[b].iceTransport=p.transceivers[0].iceTransport,p.transceivers[b].dtlsTransport=p.transceivers[0].dtlsTransport,p.transceivers[b].rtpSender&&p.transceivers[b].rtpSender.setTransport(p.transceivers[0].dtlsTransport),p.transceivers[b].rtpReceiver&&p.transceivers[b].rtpReceiver.setTransport(p.transceivers[0].dtlsTransport)),a.type==="offer"&&!_){L=p.transceivers[b]||p._createTransceiver(T),L.mid=h,L.iceGatherer||(L.iceGatherer=p._createIceGatherer(b,E)),G.length&&L.iceTransport.state==="new"&&(F&&(!E||b===0)?L.iceTransport.setRemoteCandidates(G):G.forEach(function(J){st(L.iceTransport,J)})),I=t.RTCRtpReceiver.getCapabilities(T),n<15019&&(I.codecs=I.codecs.filter(function(J){return J.name!=="rtx"})),s=L.sendEncodingParameters||[{ssrc:(2*b+2)*1001}];var H=!1;if(S==="sendrecv"||S==="sendonly"){if(H=!L.rtpReceiver,P=L.rtpReceiver||new t.RTCRtpReceiver(L.dtlsTransport,T),H){var Y;j=P.track,D&&D.stream==="-"||(D?(d[D.stream]||(d[D.stream]=new t.MediaStream,Object.defineProperty(d[D.stream],"id",{get:function(){return D.stream}})),Object.defineProperty(j,"id",{get:function(){return D.track}}),Y=d[D.stream]):(d.default||(d.default=new t.MediaStream),Y=d.default)),Y&&(e(j,Y),L.associatedRemoteMediaStreams.push(Y)),f.push([j,P,Y])}}else L.rtpReceiver&&L.rtpReceiver.track&&(L.associatedRemoteMediaStreams.forEach(function(J){var ne=J.getTracks().find(function(le){return le.id===L.rtpReceiver.track.id});ne&&r(ne,J)}),L.associatedRemoteMediaStreams=[]);L.localCapabilities=I,L.remoteCapabilities=A,L.rtpReceiver=P,L.rtcpParameters=O,L.sendEncodingParameters=s,L.recvEncodingParameters=M,p._transceive(p.transceivers[b],!1,H)}else a.type==="answer"&&!_&&(L=p.transceivers[b],U=L.iceGatherer,k=L.iceTransport,C=L.dtlsTransport,P=L.rtpReceiver,s=L.sendEncodingParameters,I=L.localCapabilities,p.transceivers[b].recvEncodingParameters=M,p.transceivers[b].remoteCapabilities=A,p.transceivers[b].rtcpParameters=O,G.length&&k.state==="new"&&((m||F)&&(!E||b===0)?k.setRemoteCandidates(G):G.forEach(function(J){st(L.iceTransport,J)})),(!E||b===0)&&(k.state==="new"&&k.start(U,x,"controlling"),C.state==="new"&&C.start(R)),p._transceive(L,S==="sendrecv"||S==="recvonly",S==="sendrecv"||S==="sendonly"),P&&(S==="sendrecv"||S==="sendonly")?(j=P.track,D?(d[D.stream]||(d[D.stream]=new t.MediaStream),e(j,d[D.stream]),f.push([j,P,d[D.stream]])):(d.default||(d.default=new t.MediaStream),e(j,d.default),f.push([j,P,d.default]))):delete L.rtpReceiver)}),p._dtlsRole===void 0&&(p._dtlsRole=a.type==="offer"?"active":"passive"),p.remoteDescription={type:a.type,sdp:a.sdp},a.type==="offer"?p._updateSignalingState("have-remote-offer"):p._updateSignalingState("stable"),Object.keys(d).forEach(function(v){var b=d[v];if(b.getTracks().length){if(p.remoteStreams.indexOf(b)===-1){p.remoteStreams.push(b);var g=new Event("addstream");g.stream=b,t.setTimeout(function(){p._dispatchEvent("addstream",g)})}f.forEach(function(T){var _=T[0],y=T[1];b.id===T[2].id&&o(p,_,y,[b])})}}),f.forEach(function(v){v[2]||o(p,v[0],v[1],[])}),t.setTimeout(function(){p&&p.transceivers&&p.transceivers.forEach(function(v){v.iceTransport&&v.iceTransport.state==="new"&&v.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),v.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},i.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},i.prototype._updateSignalingState=function(a){this.signalingState=a;var p=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",p)},i.prototype._maybeFireNegotiationNeeded=function(){var a=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,t.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=!1;var p=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",p)}},0))},i.prototype._updateConnectionState=function(){var a,p={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(f){p[f.iceTransport.state]++,p[f.dtlsTransport.state]++}),p.connected+=p.completed,a="new",p.failed>0?a="failed":p.connecting>0||p.checking>0?a="connecting":p.disconnected>0?a="disconnected":p.new>0?a="new":(p.connected>0||p.completed>0)&&(a="connected"),a!==this.iceConnectionState){this.iceConnectionState=a;var d=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",d)}},i.prototype.createOffer=function(){var a=this;if(a._isClosed)return Promise.reject(ce("InvalidStateError","Can not call createOffer after close"));var p=a.transceivers.filter(function(m){return m.kind==="audio"}).length,d=a.transceivers.filter(function(m){return m.kind==="video"}).length,f=arguments[0];if(f){if(f.mandatory||f.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");f.offerToReceiveAudio!==void 0&&(f.offerToReceiveAudio===!0?p=1:f.offerToReceiveAudio===!1?p=0:p=f.offerToReceiveAudio),f.offerToReceiveVideo!==void 0&&(f.offerToReceiveVideo===!0?d=1:f.offerToReceiveVideo===!1?d=0:d=f.offerToReceiveVideo)}for(a.transceivers.forEach(function(m){m.kind==="audio"?(p--,p<0&&(m.wantReceive=!1)):m.kind==="video"&&(d--,d<0&&(m.wantReceive=!1))});p>0||d>0;)p>0&&(a._createTransceiver("audio"),p--),d>0&&(a._createTransceiver("video"),d--);var u=W.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(m,E){var w=m.track,v=m.kind,b=m.mid||W.generateIdentifier();m.mid=b,m.iceGatherer||(m.iceGatherer=a._createIceGatherer(E,a.usingBundle));var g=t.RTCRtpSender.getCapabilities(v);n<15019&&(g.codecs=g.codecs.filter(function(_){return _.name!=="rtx"})),g.codecs.forEach(function(_){_.name==="H264"&&_.parameters["level-asymmetry-allowed"]===void 0&&(_.parameters["level-asymmetry-allowed"]="1"),m.remoteCapabilities&&m.remoteCapabilities.codecs&&m.remoteCapabilities.codecs.forEach(function(y){_.name.toLowerCase()===y.name.toLowerCase()&&_.clockRate===y.clockRate&&(_.preferredPayloadType=y.payloadType)})}),g.headerExtensions.forEach(function(_){var y=m.remoteCapabilities&&m.remoteCapabilities.headerExtensions||[];y.forEach(function(S){_.uri===S.uri&&(_.id=S.id)})});var T=m.sendEncodingParameters||[{ssrc:(2*E+1)*1001}];w&&n>=15019&&v==="video"&&!T[0].rtx&&(T[0].rtx={ssrc:T[0].ssrc+1}),m.wantReceive&&(m.rtpReceiver=new t.RTCRtpReceiver(m.dtlsTransport,v)),m.localCapabilities=g,m.sendEncodingParameters=T}),a._config.bundlePolicy!=="max-compat"&&(u+="a=group:BUNDLE "+a.transceivers.map(function(m){return m.mid}).join(" ")+`\r
`),u+=`a=ice-options:trickle\r
`,a.transceivers.forEach(function(m,E){u+=en(m,m.localCapabilities,"offer",m.stream,a._dtlsRole),u+=`a=rtcp-rsize\r
`,m.iceGatherer&&a.iceGatheringState!=="new"&&(E===0||!a.usingBundle)&&(m.iceGatherer.getLocalCandidates().forEach(function(w){w.component=1,u+="a="+W.writeCandidate(w)+`\r
`}),m.iceGatherer.state==="completed"&&(u+=`a=end-of-candidates\r
`))});var l=new t.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(l)},i.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(ce("InvalidStateError","Can not call createAnswer after close"));var p=W.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&(p+="a=group:BUNDLE "+a.transceivers.map(function(u){return u.mid}).join(" ")+`\r
`);var d=W.getMediaSections(a.remoteDescription.sdp).length;a.transceivers.forEach(function(u,l){if(!(l+1>d)){if(u.isDatachannel){p+=`m=application 0 DTLS/SCTP 5000\r
c=IN IP4 0.0.0.0\r
a=mid:`+u.mid+`\r
`;return}if(u.stream){var m;u.kind==="audio"?m=u.stream.getAudioTracks()[0]:u.kind==="video"&&(m=u.stream.getVideoTracks()[0]),m&&n>=15019&&u.kind==="video"&&!u.sendEncodingParameters[0].rtx&&(u.sendEncodingParameters[0].rtx={ssrc:u.sendEncodingParameters[0].ssrc+1})}var E=at(u.localCapabilities,u.remoteCapabilities),w=E.codecs.filter(function(v){return v.name.toLowerCase()==="rtx"}).length;!w&&u.sendEncodingParameters[0].rtx&&delete u.sendEncodingParameters[0].rtx,p+=en(u,E,"answer",u.stream,a._dtlsRole),u.rtcpParameters&&u.rtcpParameters.reducedSize&&(p+=`a=rtcp-rsize\r
`)}});var f=new t.RTCSessionDescription({type:"answer",sdp:p});return Promise.resolve(f)},i.prototype.addIceCandidate=function(a){var p=this,d;return a&&!(a.sdpMLineIndex!==void 0||a.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(f,u){if(p.remoteDescription)if(!a||a.candidate==="")for(var l=0;l<p.transceivers.length&&!(!p.transceivers[l].isDatachannel&&(p.transceivers[l].iceTransport.addRemoteCandidate({}),d=W.getMediaSections(p.remoteDescription.sdp),d[l]+=`a=end-of-candidates\r
`,p.remoteDescription.sdp=W.getDescription(p.remoteDescription.sdp)+d.join(""),p.usingBundle));l++);else{var m=a.sdpMLineIndex;if(a.sdpMid){for(var E=0;E<p.transceivers.length;E++)if(p.transceivers[E].mid===a.sdpMid){m=E;break}}var w=p.transceivers[m];if(w){if(w.isDatachannel)return f();var v=Object.keys(a.candidate).length>0?W.parseCandidate(a.candidate):{};if(v.protocol==="tcp"&&(v.port===0||v.port===9)||v.component&&v.component!==1)return f();if((m===0||m>0&&w.iceTransport!==p.transceivers[0].iceTransport)&&!st(w.iceTransport,v))return u(ce("OperationError","Can not add ICE candidate"));var b=a.candidate.trim();b.indexOf("a=")===0&&(b=b.substr(2)),d=W.getMediaSections(p.remoteDescription.sdp),d[m]+="a="+(v.type?b:"end-of-candidates")+`\r
`,p.remoteDescription.sdp=d.join("")}else return u(ce("OperationError","Can not add ICE candidate"))}else return u(ce("InvalidStateError","Can not add ICE candidate without a remote description"));f()})},i.prototype.getStats=function(){var a=[];this.transceivers.forEach(function(d){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){d[f]&&a.push(d[f].getStats())})});var p=function(d){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};return new Promise(function(d){var f=new Map;Promise.all(a).then(function(u){u.forEach(function(l){Object.keys(l).forEach(function(m){l[m].type=p(l[m]),f.set(m,l[m])})}),d(f)})})};var c=["createOffer","createAnswer"];return c.forEach(function(a){var p=i.prototype[a];i.prototype[a]=function(){var d=arguments;return typeof d[0]=="function"||typeof d[1]=="function"?p.apply(this,[arguments[2]]).then(function(f){typeof d[0]=="function"&&d[0].apply(null,[f])},function(f){typeof d[1]=="function"&&d[1].apply(null,[f])}):p.apply(this,arguments)}}),c=["setLocalDescription","setRemoteDescription","addIceCandidate"],c.forEach(function(a){var p=i.prototype[a];i.prototype[a]=function(){var d=arguments;return typeof d[1]=="function"||typeof d[2]=="function"?p.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)},function(f){typeof d[2]=="function"&&d[2].apply(null,[f])}):p.apply(this,arguments)}}),["getStats"].forEach(function(a){var p=i.prototype[a];i.prototype[a]=function(){var d=arguments;return typeof d[1]=="function"?p.apply(this,arguments).then(function(){typeof d[1]=="function"&&d[1].apply(null)}):p.apply(this,arguments)}}),i};Object.defineProperty(Ze,"__esModule",{value:!0});var ea=se,Rt=K,xe=de,ta=Zo;function we(t){if(typeof window>"u"){this.log.info("No RTCPeerConnection implementation available. The window object was not found.");return}t&&t.RTCPeerConnection?this.RTCPeerConnection=t.RTCPeerConnection:Rt.isLegacyEdge()?this.RTCPeerConnection=new ta(typeof window<"u"?window:N):typeof window.RTCPeerConnection=="function"?this.RTCPeerConnection=window.RTCPeerConnection:typeof window.webkitRTCPeerConnection=="function"?this.RTCPeerConnection=webkitRTCPeerConnection:typeof window.mozRTCPeerConnection=="function"?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log.info("No RTCPeerConnection implementation available")}we.prototype.create=function(t){this.log=new ea.default("RTCPC"),this.pc=new this.RTCPeerConnection(t)};we.prototype.createModernConstraints=function(t){if(typeof t>"u")return null;var n=Object.assign({},t);return typeof webkitRTCPeerConnection<"u"&&!Rt.isLegacyEdge()?(n.mandatory={},typeof t.audio<"u"&&(n.mandatory.OfferToReceiveAudio=t.audio),typeof t.video<"u"&&(n.mandatory.OfferToReceiveVideo=t.video)):(typeof t.audio<"u"&&(n.offerToReceiveAudio=t.audio),typeof t.video<"u"&&(n.offerToReceiveVideo=t.video)),delete n.audio,delete n.video,n};we.prototype.createOffer=function(t,n,e,r,o){var i=this;return e=this.createModernConstraints(e),qn(this.pc.createOffer,this.pc)(e).then(function(c){if(!i.pc)return Promise.resolve();var a=xe.setMaxAverageBitrate(c.sdp,t);return et(i.pc.setLocalDescription,i.pc)(new RTCSessionDescription({sdp:xe.setCodecPreferences(a,n),type:"offer"}))}).then(r,o)};we.prototype.createAnswer=function(t,n,e,r,o){var i=this;return e=this.createModernConstraints(e),qn(this.pc.createAnswer,this.pc)(e).then(function(c){if(!i.pc)return Promise.resolve();var a=xe.setMaxAverageBitrate(c.sdp,t);return et(i.pc.setLocalDescription,i.pc)(new RTCSessionDescription({sdp:xe.setCodecPreferences(a,n),type:"answer"}))}).then(r,o)};we.prototype.processSDP=function(t,n,e,r,o,i){var c=this;e=xe.setCodecPreferences(e,n);var a=new RTCSessionDescription({sdp:e,type:"offer"});return et(this.pc.setRemoteDescription,this.pc)(a).then(function(){c.createAnswer(t,n,r,o,i)})};we.prototype.getSDP=function(){return this.pc.localDescription.sdp};we.prototype.processAnswer=function(t,n,e,r){return this.pc?(n=xe.setCodecPreferences(n,t),et(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:n,type:"answer"})).then(e,r)):Promise.resolve()};we.test=function(){if(typeof navigator=="object"){var t=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(Rt.isLegacyEdge(navigator))return!1;if(t&&typeof window.RTCPeerConnection=="function")return!0;if(t&&typeof window.webkitRTCPeerConnection=="function")return!0;if(t&&typeof window.mozRTCPeerConnection=="function"){try{var n=new window.mozRTCPeerConnection;if(typeof n.getLocalStreams!="function")return!1}catch{return!1}return!0}else if(typeof RTCIceGatherer<"u")return!0}return!1};function $n(t,n,e,r){return function(){var o=Array.prototype.slice.call(arguments);return new Promise(function(i){var c=t.apply(n,o);if(!r){i(c);return}if(typeof c=="object"&&typeof c.then=="function")i(c);else throw new Error}).catch(function(){return new Promise(function(i,c){t.apply(n,e?[i,c].concat(o):o.concat([i,c]))})})}}function qn(t,n){return $n(t,n,!0,!0)}function et(t,n){return $n(t,n,!1,!1)}Ze.default=we;Object.defineProperty(kt,"__esModule",{value:!0});var _e=oe,na=se,ra=K,Ke=Ze,ia=de,oa=15e3,aa="none",sa="timeout",ca="new",nn=50;function B(t,n,e){if(!t||!n)throw new _e.InvalidArgumentError("Audiohelper, and pstream are required arguments");if(!(this instanceof B))return new B(t,n,e);this._log=new na.default("PeerConnection");function r(){this._log.warn("Unexpected noop call in peerconnection")}this.onaudio=r,this.onopen=r,this.onerror=r,this.onclose=r,this.ondisconnected=r,this.onfailed=r,this.onconnected=r,this.onreconnected=r,this.onsignalingstatechange=r,this.ondtlstransportstatechange=r,this.onicegatheringfailure=r,this.onicegatheringstatechange=r,this.oniceconnectionstatechange=r,this.onpcconnectionstatechange=r,this.onicecandidate=r,this.onselectedcandidatepairchange=r,this.onvolume=r,this.version=null,this.pstream=n,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1;var o=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!o&&typeof HTMLAudioElement<"u"&&HTMLAudioElement.prototype.setSinkId,this._audioContext=o&&t._audioContext,this._audioHelper=t,this._hasIceCandidates=!1,this._hasIceGatheringFailures=!1,this._iceGatheringTimeoutId=null,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=r,this._onHangup=r,this._remoteStream=null,this._shouldManageStream=!0,this._iceState=ca,this._isUnifiedPlan=e.isUnifiedPlan,this.options=e=e||{},this.navigator=e.navigator||(typeof navigator<"u"?navigator:null),this.util=e.util||ra,this.codecPreferences=e.codecPreferences,this}B.prototype.uri=function(){return this._uri};B.prototype.openDefaultDeviceWithConstraints=function(t){return this._audioHelper._openDefaultDeviceWithConstraints(t).then(this._setInputTracksFromStream.bind(this,!1))};B.prototype.setInputTracksFromStream=function(t){var n=this;return this._setInputTracksFromStream(!0,t).then(function(){n._shouldManageStream=!1})};B.prototype._createAnalyser=function(t,n){n=Object.assign({fftSize:32,smoothingTimeConstant:.3},n);var e=t.createAnalyser();for(var r in n)e[r]=n[r];return e};B.prototype._setVolumeHandler=function(t){this.onvolume=t};B.prototype._startPollingVolume=function(){if(!(!this._audioContext||!this.stream||!this._remoteStream)){var t=this._audioContext,n=this._inputAnalyser=this._createAnalyser(t),e=n.frequencyBinCount,r=new Uint8Array(e);this._inputAnalyser2=this._createAnalyser(t,{maxDecibels:0,minDecibels:-127,smoothingTimeConstant:0});var o=this._outputAnalyser=this._createAnalyser(t),i=o.frequencyBinCount,c=new Uint8Array(i);this._outputAnalyser2=this._createAnalyser(t,{maxDecibels:0,minDecibels:-127,smoothingTimeConstant:0}),this._updateInputStreamSource(this.stream),this._updateOutputStreamSource(this._remoteStream);var a=this;setTimeout(function p(){if(a._audioContext){if(a.status==="closed"){a._inputAnalyser.disconnect(),a._outputAnalyser.disconnect(),a._inputAnalyser2.disconnect(),a._outputAnalyser2.disconnect();return}}else return;a._inputAnalyser.getByteFrequencyData(r);var d=a.util.average(r);a._inputAnalyser2.getByteFrequencyData(r);var f=a.util.average(r);a._outputAnalyser.getByteFrequencyData(c);var u=a.util.average(c);a._outputAnalyser2.getByteFrequencyData(c);var l=a.util.average(c);a.onvolume(d/255,u/255,f,l),setTimeout(p,nn)},nn)}};B.prototype._stopStream=function(){this._shouldManageStream&&this._audioHelper._stopDefaultInputDeviceStream()};B.prototype._updateInputStreamSource=function(t){this._inputStreamSource&&this._inputStreamSource.disconnect();try{this._inputStreamSource=this._audioContext.createMediaStreamSource(t),this._inputStreamSource.connect(this._inputAnalyser),this._inputStreamSource.connect(this._inputAnalyser2)}catch(n){this._log.warn("Unable to update input MediaStreamSource",n),this._inputStreamSource=null}};B.prototype._updateOutputStreamSource=function(t){this._outputStreamSource&&this._outputStreamSource.disconnect();try{this._outputStreamSource=this._audioContext.createMediaStreamSource(t),this._outputStreamSource.connect(this._outputAnalyser),this._outputStreamSource.connect(this._outputAnalyser2)}catch(n){this._log.warn("Unable to update output MediaStreamSource",n),this._outputStreamSource=null}};B.prototype._setInputTracksFromStream=function(t,n){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(t,n):this._setInputTracksForPlanB(t,n)};B.prototype._setInputTracksForPlanB=function(t,n){var e=this;if(!n)return Promise.reject(new _e.InvalidArgumentError("Can not set input stream to null while in a call"));if(!n.getAudioTracks().length)return Promise.reject(new _e.InvalidArgumentError("Supplied input stream has no audio tracks"));var r=this.stream;return r?(this._stopStream(),ua(this.version.pc,r),r.getAudioTracks().forEach(r.removeTrack,r),n.getAudioTracks().forEach(r.addTrack,r),zn(this.version.pc,n),this._updateInputStreamSource(this.stream)):this.stream=t?ht(n):n,this.mute(this.isMuted),this.version?new Promise(function(o,i){e.version.createOffer(e.options.maxAverageBitrate,e.codecPreferences,{audio:!0},function(){e.version.processAnswer(e.codecPreferences,e._answerSdp,function(){o(e.stream)},i)},i)}):Promise.resolve(this.stream)};B.prototype._setInputTracksForUnifiedPlan=function(t,n){var e=this;if(!n)return Promise.reject(new _e.InvalidArgumentError("Can not set input stream to null while in a call"));if(!n.getAudioTracks().length)return Promise.reject(new _e.InvalidArgumentError("Supplied input stream has no audio tracks"));var r=this.stream,o=function(){return e.mute(e.isMuted),Promise.resolve(e.stream)};if(!r)this.stream=t?ht(n):n;else return this._shouldManageStream&&this._stopStream(),this._sender||(this._sender=this.version.pc.getSenders()[0]),this._sender.replaceTrack(n.getAudioTracks()[0]).then(function(){return e._updateInputStreamSource(n),e.stream=t?ht(n):n,o()});return o()};B.prototype._onInputDevicesChanged=function(){if(this.stream){var t=this.stream.getAudioTracks().every(function(n){return n.readyState==="ended"});t&&this._shouldManageStream&&this.openDefaultDeviceWithConstraints({audio:!0})}};B.prototype._onIceGatheringFailure=function(t){this._hasIceGatheringFailures=!0,this.onicegatheringfailure(t)};B.prototype._onMediaConnectionStateChange=function(t){var n=this._iceState;if(!(n===t||t!=="connected"&&t!=="disconnected"&&t!=="failed")){this._iceState=t;var e;switch(t){case"connected":n==="disconnected"||n==="failed"?(e="ICE liveliness check succeeded. Connection with Twilio restored",this._log.info(e),this.onreconnected(e)):(e="Media connection established.",this._log.info(e),this.onconnected(e)),this._stopIceGatheringTimeout(),this._hasIceGatheringFailures=!1;break;case"disconnected":e="ICE liveliness check failed. May be having trouble connecting to Twilio",this._log.warn(e),this.ondisconnected(e);break;case"failed":e="Connection with Twilio was interrupted.",this._log.warn(e),this.onfailed(e);break}}};B.prototype._setSinkIds=function(t){return this._isSinkSupported?(this.sinkIds=new Set(t.forEach?t:[t]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new _e.NotSupportedError("Audio output selection is not supported by this browser"))};B.prototype._startIceGatheringTimeout=function(){var n=this;this._stopIceGatheringTimeout(),this._iceGatheringTimeoutId=setTimeout(function(){n._onIceGatheringFailure(sa)},oa)};B.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)};B.prototype._updateAudioOutputs=function(){var n=Array.from(this.sinkIds).filter(function(i){return!this.outputs.has(i)},this),e=Array.from(this.outputs.keys()).filter(function(i){return!this.sinkIds.has(i)},this),r=this,o=n.map(this._createAudioOutput,this);return Promise.all(o).then(function(){return Promise.all(e.map(r._removeAudioOutput,r))})};B.prototype._createAudio=function(n){var e=new Audio(n);return this.onaudio(e),e};B.prototype._createAudioOutput=function(n){var e=null;this._mediaStreamSource&&(e=this._audioContext.createMediaStreamDestination(),this._mediaStreamSource.connect(e));var r=this._createAudio();At(r,e&&e.stream?e.stream:this.pcStream);var o=this;return r.setSinkId(n).then(function(){return r.play()}).then(function(){o.outputs.set(n,{audio:r,dest:e})})};B.prototype._removeAudioOutputs=function(){return this._masterAudio&&typeof this._masterAudioDeviceId<"u"&&(this._disableOutput(this,this._masterAudioDeviceId),this.outputs.delete(this._masterAudioDeviceId),this._masterAudioDeviceId=null,this._masterAudio.paused||this._masterAudio.pause(),typeof this._masterAudio.srcObject<"u"?this._masterAudio.srcObject=null:this._masterAudio.src="",this._masterAudio=null),Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)};B.prototype._disableOutput=function(n,e){var r=n.outputs.get(e);r&&(r.audio&&(r.audio.pause(),r.audio.src=""),r.dest&&r.dest.disconnect())};B.prototype._reassignMasterOutput=function(n,e){var r=n.outputs.get(e);n.outputs.delete(e);var o=this,i=Array.from(n.outputs.keys())[0]||"default";return r.audio.setSinkId(i).then(function(){o._disableOutput(n,i),n.outputs.set(i,r),n._masterAudioDeviceId=i}).catch(function(){n.outputs.set(e,r),o._log.info("Could not reassign master output. Attempted to roll back.")})};B.prototype._removeAudioOutput=function(n){return this._masterAudioDeviceId===n?this._reassignMasterOutput(this,n):(this._disableOutput(this,n),this.outputs.delete(n),Promise.resolve())};B.prototype._onAddTrack=function(n,e){var r=n._masterAudio=this._createAudio();At(r,e),r.play();var o=Array.from(n.outputs.keys())[0]||"default";n._masterAudioDeviceId=o,n.outputs.set(o,{audio:r});try{n._mediaStreamSource=n._audioContext.createMediaStreamSource(e)}catch(i){this._log.warn("Unable to create a MediaStreamSource from onAddTrack",i),this._mediaStreamSource=null}n.pcStream=e,n._updateAudioOutputs()};B.prototype._fallbackOnAddTrack=function(n,e){var r=document&&document.createElement("audio");r.autoplay=!0,At(r,e)||n._log.info("Error attaching stream to element."),n.outputs.set("default",{audio:r})};B.prototype._setEncodingParameters=function(t){if(!(!t||!this._sender||typeof this._sender.getParameters!="function"||typeof this._sender.setParameters!="function")){var n=this._sender.getParameters();!n.priority&&!(n.encodings&&n.encodings.length)||(n.priority="high",n.encodings&&n.encodings.length&&n.encodings.forEach(function(e){e.priority="high",e.networkPriority="high"}),this._sender.setParameters(n))}};B.prototype._setupPeerConnection=function(t){var n=this,e=this,r=new(this.options.rtcpcFactory||Ke.default)({RTCPeerConnection:this.options.RTCPeerConnection});r.create(t),zn(r.pc,this.stream);var o="ontrack"in r.pc?"ontrack":"onaddstream";return r.pc[o]=function(i){var c=e._remoteStream=i.stream||i.streams[0];typeof r.pc.getSenders=="function"&&(n._sender=r.pc.getSenders()[0]),e._isSinkSupported?e._onAddTrack(e,c):e._fallbackOnAddTrack(e,c),e._startPollingVolume()},r};B.prototype._maybeSetIceAggressiveNomination=function(t){return this.options.forceAggressiveIceNomination?ia.setIceAggressiveNomination(t):t};B.prototype._setupChannel=function(){var t=this,n=this.version.pc;this.version.pc.onopen=function(){t.status="open",t.onopen()},this.version.pc.onstatechange=function(){t.version.pc&&t.version.pc.readyState==="stable"&&(t.status="open",t.onopen())},this.version.pc.onsignalingstatechange=function(){var e=n.signalingState;t._log.info('signalingState is "'+e+'"'),t.version.pc&&t.version.pc.signalingState==="stable"&&(t.status="open",t.onopen()),t.onsignalingstatechange(n.signalingState)},n.onconnectionstatechange=function(e){var r=n.connectionState;if(!r&&e&&e.target){var o=e.target;r=o.connectionState||o.connectionState_,t._log.info("pc.connectionState not detected. Using target PC. State="+r)}r?t._log.info('pc.connectionState is "'+r+'"'):t._log.warn('onconnectionstatechange detected but state is "'+r+'"'),t.onpcconnectionstatechange(r),t._onMediaConnectionStateChange(r)},n.onicecandidate=function(e){var r=e.candidate;r&&(t._hasIceCandidates=!0,t.onicecandidate(r),t._setupRTCIceTransportListener()),t._log.info("ICE Candidate: "+JSON.stringify(r))},n.onicegatheringstatechange=function(){var e=n.iceGatheringState;e==="gathering"?t._startIceGatheringTimeout():e==="complete"&&(t._stopIceGatheringTimeout(),t._hasIceCandidates||t._onIceGatheringFailure(aa),t._hasIceCandidates&&t._hasIceGatheringFailures&&t._startIceGatheringTimeout()),t._log.info('pc.iceGatheringState is "'+n.iceGatheringState+'"'),t.onicegatheringstatechange(e)},n.oniceconnectionstatechange=function(){t._log.info('pc.iceConnectionState is "'+n.iceConnectionState+'"'),t.oniceconnectionstatechange(n.iceConnectionState),t._onMediaConnectionStateChange(n.iceConnectionState)}};B.prototype._initializeMediaStream=function(t){return this.status==="open"?!1:this.pstream.status==="disconnected"?(this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected",twilioError:new _e.SignalingErrors.ConnectionDisconnected}}),this.close(),!1):(this.version=this._setupPeerConnection(t),this._setupChannel(),!0)};B.prototype._removeReconnectionListeners=function(){this.pstream&&(this.pstream.removeListener("answer",this._onAnswerOrRinging),this.pstream.removeListener("hangup",this._onHangup))};B.prototype._setupRTCDtlsTransportListener=function(){var t=this,n=this.getRTCDtlsTransport();if(!(!n||n.onstatechange)){var e=function(){t._log.info('dtlsTransportState is "'+n.state+'"'),t.ondtlstransportstatechange(n.state)};e(),n.onstatechange=e}};B.prototype._setupRTCIceTransportListener=function(){var t=this,n=this._getRTCIceTransport();!n||n.onselectedcandidatepairchange||(n.onselectedcandidatepairchange=function(){return t.onselectedcandidatepairchange(n.getSelectedCandidatePair())})};B.prototype.iceRestart=function(){var t=this;this._log.info("Attempting to restart ICE..."),this._hasIceCandidates=!1,this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{iceRestart:!0}).then(function(){t._removeReconnectionListeners(),t._onAnswerOrRinging=function(n){if(t._removeReconnectionListeners(),!n.sdp||t.version.pc.signalingState!=="have-local-offer"){var e="Invalid state or param during ICE Restart:"+("hasSdp:"+!!n.sdp+", signalingState:"+t.version.pc.signalingState);t._log.warn(e);return}var r=t._maybeSetIceAggressiveNomination(n.sdp);t._answerSdp=r,t.status!=="closed"&&t.version.processAnswer(t.codecPreferences,r,null,function(o){var i=o&&o.message?o.message:o;t._log.error("Failed to process answer during ICE Restart. Error: "+i)})},t._onHangup=function(){t._log.info("Received hangup during ICE Restart"),t._removeReconnectionListeners()},t.pstream.on("answer",t._onAnswerOrRinging),t.pstream.on("hangup",t._onHangup),t.pstream.reinvite(t.version.getSDP(),t.callSid)}).catch(function(n){var e=n&&n.message?n.message:n;t._log.error("Failed to createOffer during ICE Restart. Error: "+e),t.onfailed(e)})};B.prototype.makeOutgoingCall=function(t,n,e,r,o){var i=this;if(!this._initializeMediaStream(r))return;var c=this;this.callSid=e;function a(){c.options&&c._setEncodingParameters(c.options.dscp),o(c.version.pc)}function p(u){var l=u.message||u;c.onerror({info:{code:31e3,message:"Error processing answer: "+l,twilioError:new _e.MediaErrors.ClientRemoteDescFailed}})}this._onAnswerOrRinging=function(u){if(u.sdp){var l=i._maybeSetIceAggressiveNomination(u.sdp);c._answerSdp=l,c.status!=="closed"&&c.version.processAnswer(i.codecPreferences,l,a,p),c.pstream.removeListener("answer",c._onAnswerOrRinging),c.pstream.removeListener("ringing",c._onAnswerOrRinging)}},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging);function d(){c.status!=="closed"&&(c.pstream.invite(c.version.getSDP(),c.callSid,c.options.preflight,n),c._setupRTCDtlsTransportListener())}function f(u){var l=u.message||u;c.onerror({info:{code:31e3,message:"Error creating the offer: "+l,twilioError:new _e.MediaErrors.ClientLocalDescFailed}})}this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{audio:!0},d,f)};B.prototype.answerIncomingCall=function(t,n,e,r){if(!this._initializeMediaStream(e))return;n=this._maybeSetIceAggressiveNomination(n),this._answerSdp=n.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=t;var o=this;function i(){o.status!=="closed"&&(o.pstream.answer(o.version.getSDP(),t),o.options&&o._setEncodingParameters(o.options.dscp),r(o.version.pc),o._setupRTCDtlsTransportListener())}function c(a){var p=a.message||a;o.onerror({info:{code:31e3,message:"Error creating the answer: "+p,twilioError:new _e.MediaErrors.ClientRemoteDescFailed}})}this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,n,{audio:!0},i,c)};B.prototype.close=function(){this.version&&this.version.pc&&(this.version.pc.signalingState!=="closed"&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream()),this.stream=null,this._removeReconnectionListeners(),this._stopIceGatheringTimeout(),Promise.all(this._removeAudioOutputs()).catch(function(){}),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this._inputAnalyser2&&this._inputAnalyser2.disconnect(),this._outputAnalyser2&&this._outputAnalyser2.disconnect(),this.status="closed",this.onclose()};B.prototype.reject=function(t){this.callSid=t};B.prototype.ignore=function(t){this.callSid=t};B.prototype.mute=function(t){if(this.isMuted=t,!!this.stream)if(this._sender&&this._sender.track)this._sender.track.enabled=!t;else{var n=typeof this.stream.getAudioTracks=="function"?this.stream.getAudioTracks():this.stream.audioTracks;n.forEach(function(e){e.enabled=!t})}};B.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var n=this,e=this.version.pc;if(!e)return this._log.warn("No RTCPeerConnection available to call createDTMFSender on"),null;if(typeof e.getSenders=="function"&&(typeof RTCDTMFSender=="function"||typeof RTCDtmfSender=="function")){var r=e.getSenders().find(function(i){return i.dtmf});if(r)return this._log.info("Using RTCRtpSender#dtmf"),this._dtmfSender=r.dtmf,this._dtmfSender}if(typeof e.createDTMFSender=="function"&&typeof e.getLocalStreams=="function"){var o=e.getLocalStreams().map(function(i){var c=n._getAudioTracks(i);return c&&c[0]})[0];return o?(this._log.info("Creating RTCDTMFSender"),this._dtmfSender=e.createDTMFSender(o),this._dtmfSender):(this._log.warn("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this._log.info("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null};B.prototype.getRTCDtlsTransport=function(){var n=this.version&&this.version.pc&&typeof this.version.pc.getSenders=="function"&&this.version.pc.getSenders()[0];return n&&n.transport||null};B.prototype._canStopMediaStreamTrack=function(){return typeof MediaStreamTrack.prototype.stop=="function"};B.prototype._getAudioTracks=function(t){return typeof t.getAudioTracks=="function"?t.getAudioTracks():t.audioTracks};B.prototype._getRTCIceTransport=function(){var n=this.getRTCDtlsTransport();return n&&n.iceTransport||null};B.protocol=function(){return Ke.default.test()?new Ke.default:null}();function zn(t,n){typeof t.addTrack=="function"?n.getAudioTracks().forEach(function(e){t.addTrack(e,n)}):t.addStream(n)}function ht(t){var n=typeof MediaStream<"u"?new MediaStream:new webkitMediaStream;return t.getAudioTracks().forEach(n.addTrack,n),n}function ua(t,n){typeof t.removeTrack=="function"?t.getSenders().forEach(function(e){t.removeTrack(e)}):t.removeStream(n)}function At(t,n){if(typeof t.srcObject<"u")t.srcObject=n;else if(typeof t.mozSrcObject<"u")t.mozSrcObject=n;else if(typeof t.src<"u"){var e=t.options.window||window;t.src=(e.URL||e.webkitURL).createObjectURL(n)}else return!1;return!0}B.enabled=Ke.default.test();kt.default=B;Object.defineProperty(be,"__esModule",{value:!0});be.PeerConnection=be.getMediaEngine=be.enabled=void 0;var la=kt;be.PeerConnection=la.default;var da=Ze;function fa(){return da.default.test()}be.enabled=fa;function pa(){return typeof RTCIceGatherer<"u"?"ORTC":"WebRTC"}be.getMediaEngine=pa;var xt={};Object.defineProperty(xt,"__esModule",{value:!0});var ct=oe,ha=K;function va(t,n){return n=n||{},n.util=n.util||ha,n.navigator=n.navigator||(typeof navigator<"u"?navigator:null),new Promise(function(e,r){if(!n.navigator)throw new ct.NotSupportedError("getUserMedia is not supported");switch("function"){case typeof(n.navigator.mediaDevices&&n.navigator.mediaDevices.getUserMedia):return e(n.navigator.mediaDevices.getUserMedia(t));case typeof n.navigator.webkitGetUserMedia:return n.navigator.webkitGetUserMedia(t,e,r);case typeof n.navigator.mozGetUserMedia:return n.navigator.mozGetUserMedia(t,e,r);case typeof n.navigator.getUserMedia:return n.navigator.getUserMedia(t,e,r);default:throw new ct.NotSupportedError("getUserMedia is not supported")}}).catch(function(e){throw n.util.isFirefox()&&e.name==="NotReadableError"?new ct.NotSupportedError(`Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.
Related Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324`):e})}xt.default=va;var Dt={},tt={},Ot={};Object.defineProperty(Ot,"__esModule",{value:!0});var ma=function(){function t(){var n=this;this._promise=new Promise(function(e,r){n._resolve=e,n._reject=r})}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),t.prototype.reject=function(n){this._reject(n)},t.prototype.resolve=function(n){this._resolve(n)},t}();Ot.default=ma;var _a=N&&N.__awaiter||function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(c){c(i)})}return new(e||(e=Promise))(function(i,c){function a(f){try{d(r.next(f))}catch(u){c(u)}}function p(f){try{d(r.throw(f))}catch(u){c(u)}}function d(f){f.done?i(f.value):o(f.value).then(a,p)}d((r=r.apply(t,n||[])).next())})},ga=N&&N.__generator||function(t,n){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(d){return function(f){return p([d,f])}}function p(d){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=d[0]&2?o.return:d[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,d[1])).done)return i;switch(o=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return e.label++,{value:d[1],done:!1};case 5:e.label++,o=d[1],d=[0];continue;case 7:d=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){e=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){e.label=d[1];break}if(d[0]===6&&e.label<i[1]){e.label=i[1],i=d;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(d);break}i[2]&&e.ops.pop(),e.trys.pop();continue}d=n.call(t,e)}catch(f){d=[6,f],o=0}finally{r=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};Object.defineProperty(tt,"__esModule",{value:!0});tt.AsyncQueue=void 0;var ya=Ot,ba=function(){function t(){this._operations=[]}return t.prototype.enqueue=function(n){var e=!!this._operations.length,r=new ya.default;return this._operations.push({deferred:r,callback:n}),e||this._processQueue(),r.promise},t.prototype._processQueue=function(){return _a(this,void 0,void 0,function(){var n,e,r,o,i,c,a;return ga(this,function(p){switch(p.label){case 0:if(!this._operations.length)return[3,5];n=this._operations[0],e=n.deferred,r=n.callback,o=void 0,i=void 0,c=void 0,p.label=1;case 1:return p.trys.push([1,3,,4]),[4,r()];case 2:return o=p.sent(),c=!0,[3,4];case 3:return a=p.sent(),i=a,[3,4];case 4:return this._operations.shift(),c?e.resolve(o):e.reject(i),[3,0];case 5:return[2]}})})},t}();tt.AsyncQueue=ba;var Mt={},Lt={};Object.defineProperty(Lt,"__esModule",{value:!0});var Sa=function(){function t(){var n=this;this.promise=new Promise(function(e,r){n._resolve=e,n._reject=r})}return Object.defineProperty(t.prototype,"reject",{get:function(){return this._reject},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolve",{get:function(){return this._resolve},enumerable:!1,configurable:!0}),t}();Lt.default=Sa;var jt={},wa=N&&N.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],c=0,a=i.length;c<a;c++,o++)r[o]=i[c];return r};Object.defineProperty(jt,"__esModule",{value:!0});var Ca=ve,Ta=function(){function t(){this._eventEmitter=new Ca.EventEmitter}return t.prototype.addEventListener=function(n,e){return this._eventEmitter.addListener(n,e)},t.prototype.dispatchEvent=function(n){for(var e,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return(e=this._eventEmitter).emit.apply(e,wa([n],r))},t.prototype.removeEventListener=function(n,e){return this._eventEmitter.removeListener(n,e)},t}();jt.default=Ta;var Ea=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),$e=N&&N.__awaiter||function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(c){c(i)})}return new(e||(e=Promise))(function(i,c){function a(f){try{d(r.next(f))}catch(u){c(u)}}function p(f){try{d(r.throw(f))}catch(u){c(u)}}function d(f){f.done?i(f.value):o(f.value).then(a,p)}d((r=r.apply(t,n||[])).next())})},qe=N&&N.__generator||function(t,n){var e={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,o,i,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(d){return function(f){return p([d,f])}}function p(d){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,o&&(i=d[0]&2?o.return:d[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,d[1])).done)return i;switch(o=0,i&&(d=[d[0]&2,i.value]),d[0]){case 0:case 1:i=d;break;case 4:return e.label++,{value:d[1],done:!1};case 5:e.label++,o=d[1],d=[0];continue;case 7:d=e.ops.pop(),e.trys.pop();continue;default:if(i=e.trys,!(i=i.length>0&&i[i.length-1])&&(d[0]===6||d[0]===2)){e=0;continue}if(d[0]===3&&(!i||d[1]>i[0]&&d[1]<i[3])){e.label=d[1];break}if(d[0]===6&&e.label<i[1]){e.label=i[1],i=d;break}if(i&&e.label<i[2]){e.label=i[2],e.ops.push(d);break}i[2]&&e.ops.pop(),e.trys.pop();continue}d=n.call(t,e)}catch(f){d=[6,f],o=0}finally{r=i=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};Object.defineProperty(Mt,"__esModule",{value:!0});var Pa=Lt,Ia=jt,ka=function(t){Ea(n,t);function n(e,r,o){r===void 0&&(r={}),o===void 0&&(o={});var i=t.call(this)||this;return i._audioNode=null,i._loop=!1,i._pendingPlayDeferreds=[],i._sinkId="default",i._src="",typeof r!="string"&&(o=r),i._audioContext=e,i._audioElement=new(o.AudioFactory||Audio),i._bufferPromise=i._createPlayDeferred().promise,i._destination=i._audioContext.destination,i._gainNode=i._audioContext.createGain(),i._gainNode.connect(i._destination),i._XMLHttpRequest=o.XMLHttpRequestFactory||XMLHttpRequest,i.addEventListener("canplaythrough",function(){i._resolvePlayDeferreds()}),typeof r=="string"&&(i.src=r),i}return Object.defineProperty(n.prototype,"destination",{get:function(){return this._destination},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loop",{get:function(){return this._loop},set:function(e){var r=this;function o(){r._audioNode.removeEventListener("ended",o),r.pause()}!e&&this.loop&&!this.paused&&this._audioNode.addEventListener("ended",o),this._loop=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"muted",{get:function(){return this._gainNode.gain.value===0},set:function(e){this._gainNode.gain.value=e?0:1},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"paused",{get:function(){return this._audioNode===null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"src",{get:function(){return this._src},set:function(e){this._load(e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"srcObject",{get:function(){return this._audioElement.srcObject},set:function(e){this._audioElement.srcObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"sinkId",{get:function(){return this._sinkId},enumerable:!1,configurable:!0}),n.prototype.load=function(){this._load(this._src)},n.prototype.pause=function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))},n.prototype.play=function(){return $e(this,void 0,void 0,function(){var e,r=this;return qe(this,function(o){switch(o.label){case 0:return this.paused?[3,2]:[4,this._bufferPromise];case 1:if(o.sent(),!this.paused)return[2];throw new Error("The play() request was interrupted by a call to pause().");case 2:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",function(){r._audioNode&&r._audioNode.loop||r.dispatchEvent("ended")}),[4,this._bufferPromise];case 3:if(e=o.sent(),this.paused)throw new Error("The play() request was interrupted by a call to pause().");return this._audioNode.buffer=e,this._audioNode.connect(this._gainNode),this._audioNode.start(),this._audioElement.srcObject?[2,this._audioElement.play()]:[2]}})})},n.prototype.setSinkId=function(e){return $e(this,void 0,void 0,function(){return qe(this,function(r){switch(r.label){case 0:if(typeof this._audioElement.setSinkId!="function")throw new Error("This browser does not support setSinkId.");return e===this.sinkId?[2]:e==="default"?(this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=e,[2]):[4,this._audioElement.setSinkId(e)];case 1:return r.sent(),this._audioElement.srcObject?[2]:(this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=e,this._gainNode.connect(this._destination),[2])}})})},n.prototype._createPlayDeferred=function(){var e=new Pa.default;return this._pendingPlayDeferreds.push(e),e},n.prototype._load=function(e){var r=this;this._src&&this._src!==e&&this.pause(),this._src=e,this._bufferPromise=new Promise(function(o,i){return $e(r,void 0,void 0,function(){var c;return qe(this,function(a){switch(a.label){case 0:return e?[4,Ra(this._audioContext,this._XMLHttpRequest,e)]:[2,this._createPlayDeferred().promise];case 1:return c=a.sent(),this.dispatchEvent("canplaythrough"),o(c),[2]}})})})},n.prototype._rejectPlayDeferreds=function(e){var r=this._pendingPlayDeferreds;r.splice(0,r.length).forEach(function(o){var i=o.reject;return i(e)})},n.prototype._resolvePlayDeferreds=function(e){var r=this._pendingPlayDeferreds;r.splice(0,r.length).forEach(function(o){var i=o.resolve;return i(e)})},n}(Ia.default);function Ra(t,n,e){return $e(this,void 0,void 0,function(){var r,o;return qe(this,function(i){switch(i.label){case 0:return r=new n,r.open("GET",e,!0),r.responseType="arraybuffer",[4,new Promise(function(c){r.addEventListener("load",c),r.send()})];case 1:o=i.sent();try{return[2,t.decodeAudioData(o.target.response)]}catch{return[2,new Promise(function(a){t.decodeAudioData(o.target.response,a)})]}return[2]}})})}Mt.default=ka;Object.defineProperty(Dt,"__esModule",{value:!0});var Aa=tt,rn=Mt,Jn=oe;function Se(t,n,e){if(!(this instanceof Se))return new Se(t,n,e);if(!t||!n)throw new Jn.InvalidArgumentError("name and url are required arguments");e=Object.assign({AudioFactory:typeof Audio<"u"?Audio:null,maxDuration:0,shouldLoop:!1},e),e.AudioPlayer=e.audioContext?rn.default.bind(rn.default,e.audioContext):e.AudioFactory,Object.defineProperties(this,{_Audio:{value:e.AudioPlayer},_activeEls:{value:new Map},_isSinkSupported:{value:e.AudioFactory!==null&&typeof e.AudioFactory.prototype.setSinkId=="function"},_maxDuration:{value:e.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_operations:{value:new Aa.AsyncQueue},_playPromise:{value:null,writable:!0},_shouldLoop:{value:e.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:t},url:{enumerable:!0,value:n}}),this._Audio&&this._play(!0,!1)}function Kn(t){t&&(t.pause(),t.src="",t.srcObject=null,t.load())}Se.prototype._playAudioElement=function(n,e,r){var o=this,i=this._activeEls.get(n);if(!i)throw new Jn.InvalidArgumentError('sinkId: "'+n+`" doesn't have an audio element`);return i.muted=!!e,i.loop=!!r,i.play().then(function(){return i}).catch(function(c){throw Kn(i),o._activeEls.delete(n),c})};Se.prototype._play=function(n,e){this.isPlaying&&this._stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this._stop.bind(this),this._maxDuration)),e=typeof e=="boolean"?e:this._shouldLoop;var r=this,o=this._playPromise=Promise.all(this._sinkIds.map(function(c){if(!r._Audio)return Promise.resolve();var a=r._activeEls.get(c);return a?r._playAudioElement(c,n,e):(a=new r._Audio(r.url),typeof a.setAttribute=="function"&&a.setAttribute("crossorigin","anonymous"),new Promise(function(p){a.addEventListener("canplaythrough",p)}).then(function(){return(r._isSinkSupported?a.setSinkId(c):Promise.resolve()).then(function(){return r._activeEls.set(c,a),r._playPromise?r._playAudioElement(c,n,e):Promise.resolve()})}))}));return o};Se.prototype._stop=function(){var n=this;this._activeEls.forEach(function(e,r){n._sinkIds.includes(r)?(e.pause(),e.currentTime=0):(Kn(e),n._activeEls.delete(r))}),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null};Se.prototype.setSinkIds=function(n){this._isSinkSupported&&(n=n.forEach?n:[n],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(n)))};Se.prototype.stop=function(){var n=this;this._operations.enqueue(function(){return n._stop(),Promise.resolve()})};Se.prototype.play=function(){var n=this;return this._operations.enqueue(function(){return n._play()})};Dt.default=Se;var Le={},Qn={exports:{}},Xn={exports:{}};(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,r){return e<<r|e>>>32-r},rotr:function(e,r){return e<<32-r|e>>>r},endian:function(e){if(e.constructor==Number)return n.rotl(e,8)&16711935|n.rotl(e,24)&4278255360;for(var r=0;r<e.length;r++)e[r]=n.endian(e[r]);return e},randomBytes:function(e){for(var r=[];e>0;e--)r.push(Math.floor(Math.random()*256));return r},bytesToWords:function(e){for(var r=[],o=0,i=0;o<e.length;o++,i+=8)r[i>>>5]|=e[o]<<24-i%32;return r},wordsToBytes:function(e){for(var r=[],o=0;o<e.length*32;o+=8)r.push(e[o>>>5]>>>24-o%32&255);return r},bytesToHex:function(e){for(var r=[],o=0;o<e.length;o++)r.push((e[o]>>>4).toString(16)),r.push((e[o]&15).toString(16));return r.join("")},hexToBytes:function(e){for(var r=[],o=0;o<e.length;o+=2)r.push(parseInt(e.substr(o,2),16));return r},bytesToBase64:function(e){for(var r=[],o=0;o<e.length;o+=3)for(var i=e[o]<<16|e[o+1]<<8|e[o+2],c=0;c<4;c++)o*8+c*6<=e.length*8?r.push(t.charAt(i>>>6*(3-c)&63)):r.push("=");return r.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/ig,"");for(var r=[],o=0,i=0;o<e.length;i=++o%4)i!=0&&r.push((t.indexOf(e.charAt(o-1))&Math.pow(2,-2*i+8)-1)<<i*2|t.indexOf(e.charAt(o))>>>6-i*2);return r}};Xn.exports=n})();var xa=Xn.exports,vt={utf8:{stringToBytes:function(t){return vt.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(vt.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var n=[],e=0;e<t.length;e++)n.push(t.charCodeAt(e)&255);return n},bytesToString:function(t){for(var n=[],e=0;e<t.length;e++)n.push(String.fromCharCode(t[e]));return n.join("")}}},on=vt;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var Da=function(t){return t!=null&&(Yn(t)||Oa(t)||!!t._isBuffer)};function Yn(t){return!!t.constructor&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}function Oa(t){return typeof t.readFloatLE=="function"&&typeof t.slice=="function"&&Yn(t.slice(0,0))}(function(){var t=xa,n=on.utf8,e=Da,r=on.bin,o=function(i,c){i.constructor==String?c&&c.encoding==="binary"?i=r.stringToBytes(i):i=n.stringToBytes(i):e(i)?i=Array.prototype.slice.call(i,0):!Array.isArray(i)&&i.constructor!==Uint8Array&&(i=i.toString());for(var a=t.bytesToWords(i),p=i.length*8,d=1732584193,f=-271733879,u=-1732584194,l=271733878,m=0;m<a.length;m++)a[m]=(a[m]<<8|a[m]>>>24)&16711935|(a[m]<<24|a[m]>>>8)&4278255360;a[p>>>5]|=128<<p%32,a[(p+64>>>9<<4)+14]=p;for(var E=o._ff,w=o._gg,v=o._hh,b=o._ii,m=0;m<a.length;m+=16){var g=d,T=f,_=u,y=l;d=E(d,f,u,l,a[m+0],7,-680876936),l=E(l,d,f,u,a[m+1],12,-389564586),u=E(u,l,d,f,a[m+2],17,606105819),f=E(f,u,l,d,a[m+3],22,-1044525330),d=E(d,f,u,l,a[m+4],7,-176418897),l=E(l,d,f,u,a[m+5],12,1200080426),u=E(u,l,d,f,a[m+6],17,-1473231341),f=E(f,u,l,d,a[m+7],22,-45705983),d=E(d,f,u,l,a[m+8],7,1770035416),l=E(l,d,f,u,a[m+9],12,-1958414417),u=E(u,l,d,f,a[m+10],17,-42063),f=E(f,u,l,d,a[m+11],22,-1990404162),d=E(d,f,u,l,a[m+12],7,1804603682),l=E(l,d,f,u,a[m+13],12,-40341101),u=E(u,l,d,f,a[m+14],17,-1502002290),f=E(f,u,l,d,a[m+15],22,1236535329),d=w(d,f,u,l,a[m+1],5,-165796510),l=w(l,d,f,u,a[m+6],9,-1069501632),u=w(u,l,d,f,a[m+11],14,643717713),f=w(f,u,l,d,a[m+0],20,-373897302),d=w(d,f,u,l,a[m+5],5,-701558691),l=w(l,d,f,u,a[m+10],9,38016083),u=w(u,l,d,f,a[m+15],14,-660478335),f=w(f,u,l,d,a[m+4],20,-405537848),d=w(d,f,u,l,a[m+9],5,568446438),l=w(l,d,f,u,a[m+14],9,-1019803690),u=w(u,l,d,f,a[m+3],14,-187363961),f=w(f,u,l,d,a[m+8],20,1163531501),d=w(d,f,u,l,a[m+13],5,-1444681467),l=w(l,d,f,u,a[m+2],9,-51403784),u=w(u,l,d,f,a[m+7],14,1735328473),f=w(f,u,l,d,a[m+12],20,-1926607734),d=v(d,f,u,l,a[m+5],4,-378558),l=v(l,d,f,u,a[m+8],11,-2022574463),u=v(u,l,d,f,a[m+11],16,1839030562),f=v(f,u,l,d,a[m+14],23,-35309556),d=v(d,f,u,l,a[m+1],4,-1530992060),l=v(l,d,f,u,a[m+4],11,1272893353),u=v(u,l,d,f,a[m+7],16,-155497632),f=v(f,u,l,d,a[m+10],23,-1094730640),d=v(d,f,u,l,a[m+13],4,681279174),l=v(l,d,f,u,a[m+0],11,-358537222),u=v(u,l,d,f,a[m+3],16,-722521979),f=v(f,u,l,d,a[m+6],23,76029189),d=v(d,f,u,l,a[m+9],4,-640364487),l=v(l,d,f,u,a[m+12],11,-421815835),u=v(u,l,d,f,a[m+15],16,530742520),f=v(f,u,l,d,a[m+2],23,-995338651),d=b(d,f,u,l,a[m+0],6,-198630844),l=b(l,d,f,u,a[m+7],10,1126891415),u=b(u,l,d,f,a[m+14],15,-1416354905),f=b(f,u,l,d,a[m+5],21,-57434055),d=b(d,f,u,l,a[m+12],6,1700485571),l=b(l,d,f,u,a[m+3],10,-1894986606),u=b(u,l,d,f,a[m+10],15,-1051523),f=b(f,u,l,d,a[m+1],21,-2054922799),d=b(d,f,u,l,a[m+8],6,1873313359),l=b(l,d,f,u,a[m+15],10,-30611744),u=b(u,l,d,f,a[m+6],15,-1560198380),f=b(f,u,l,d,a[m+13],21,1309151649),d=b(d,f,u,l,a[m+4],6,-145523070),l=b(l,d,f,u,a[m+11],10,-1120210379),u=b(u,l,d,f,a[m+2],15,718787259),f=b(f,u,l,d,a[m+9],21,-343485551),d=d+g>>>0,f=f+T>>>0,u=u+_>>>0,l=l+y>>>0}return t.endian([d,f,u,l])};o._ff=function(i,c,a,p,d,f,u){var l=i+(c&a|~c&p)+(d>>>0)+u;return(l<<f|l>>>32-f)+c},o._gg=function(i,c,a,p,d,f,u){var l=i+(c&p|a&~p)+(d>>>0)+u;return(l<<f|l>>>32-f)+c},o._hh=function(i,c,a,p,d,f,u){var l=i+(c^a^p)+(d>>>0)+u;return(l<<f|l>>>32-f)+c},o._ii=function(i,c,a,p,d,f,u){var l=i+(a^(c|~p))+(d>>>0)+u;return(l<<f|l>>>32-f)+c},o._blocksize=16,o._digestsize=16,Qn.exports=function(i,c){if(i==null)throw new Error("Illegal argument "+i);var a=t.wordsToBytes(o(i,c));return c&&c.asBytes?a:c&&c.asString?r.bytesToString(a):t.bytesToHex(a)}})();var Ma=Qn.exports;Object.defineProperty(Le,"__esModule",{value:!0});Le.generateVoiceEventSid=void 0;var ut=Ma,We=oe,La=typeof ut=="function"?ut:ut.default;function ja(){if(typeof window!="object")throw new We.NotSupportedError("This platform is not supported.");var t=window.crypto;if(typeof t!="object")throw new We.NotSupportedError("The `crypto` module is not available on this platform.");if(typeof(t.randomUUID||t.getRandomValues)>"u")throw new We.NotSupportedError("Neither `crypto.randomUUID` or `crypto.getRandomValues` are available on this platform.");var n=window.Uint32Array;if(typeof n>"u")throw new We.NotSupportedError("The `Uint32Array` module is not available on this platform.");var e=typeof t.randomUUID=="function"?function(){return t.randomUUID()}:function(){return t.getRandomValues(new Uint32Array(32)).toString()};return La(e())}function Ua(){return"KX"+ja()}Le.generateVoiceEventSid=Ua;var an;function nt(){if(an)return Fe;an=1;var t=N&&N.__extends||function(){var k=function(C,P){return k=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,M){s.__proto__=M}||function(s,M){for(var I in M)Object.prototype.hasOwnProperty.call(M,I)&&(s[I]=M[I])},k(C,P)};return function(C,P){k(C,P);function s(){this.constructor=C}C.prototype=P===null?Object.create(P):(s.prototype=P.prototype,new s)}}(),n=N&&N.__assign||function(){return n=Object.assign||function(k){for(var C,P=1,s=arguments.length;P<s;P++){C=arguments[P];for(var M in C)Object.prototype.hasOwnProperty.call(C,M)&&(k[M]=C[M])}return k},n.apply(this,arguments)},e=N&&N.__awaiter||function(k,C,P,s){function M(I){return I instanceof P?I:new P(function(j){j(I)})}return new(P||(P=Promise))(function(I,j){function A(O){try{R(s.next(O))}catch(F){j(F)}}function x(O){try{R(s.throw(O))}catch(F){j(F)}}function R(O){O.done?I(O.value):M(O.value).then(A,x)}R((s=s.apply(k,C||[])).next())})},r=N&&N.__generator||function(k,C){var P={label:0,sent:function(){if(I[0]&1)throw I[1];return I[1]},trys:[],ops:[]},s,M,I,j;return j={next:A(0),throw:A(1),return:A(2)},typeof Symbol=="function"&&(j[Symbol.iterator]=function(){return this}),j;function A(R){return function(O){return x([R,O])}}function x(R){if(s)throw new TypeError("Generator is already executing.");for(;P;)try{if(s=1,M&&(I=R[0]&2?M.return:R[0]?M.throw||((I=M.return)&&I.call(M),0):M.next)&&!(I=I.call(M,R[1])).done)return I;switch(M=0,I&&(R=[R[0]&2,I.value]),R[0]){case 0:case 1:I=R;break;case 4:return P.label++,{value:R[1],done:!1};case 5:P.label++,M=R[1],R=[0];continue;case 7:R=P.ops.pop(),P.trys.pop();continue;default:if(I=P.trys,!(I=I.length>0&&I[I.length-1])&&(R[0]===6||R[0]===2)){P=0;continue}if(R[0]===3&&(!I||R[1]>I[0]&&R[1]<I[3])){P.label=R[1];break}if(R[0]===6&&P.label<I[1]){P.label=I[1],I=R;break}if(I&&P.label<I[2]){P.label=I[2],P.ops.push(R);break}I[2]&&P.ops.pop(),P.trys.pop();continue}R=C.call(k,P)}catch(O){R=[6,O],M=0}finally{s=I=0}if(R[0]&5)throw R[1];return{value:R[0]?R[1]:void 0,done:!0}}};Object.defineProperty(Fe,"__esModule",{value:!0});var o=ve,i=Rn,c=Zi(),a=Ye,p=Nt(),d=ie,f=St,u=oe,l=wt,m=se,E=Vn(),w=Pt,v=Gn,b=be,g=xt,T=Dt,_=K,y=Le,S=3e4,D=2e3,h="twilio-js-sdk",L='Parameter "token" must be of type "string".',U=function(k){t(C,k);function C(P,s){var M;s===void 0&&(s={});var I=k.call(this)||this;if(I._activeCall=null,I._audio=null,I._audioProcessorEventObserver=null,I._callInputStream=null,I._calls=[],I._callSinkIds=["default"],I._chunderURIs=[],I._defaultOptions={allowIncomingWhileBusy:!1,closeProtection:!1,codecPreferences:[p.default.Codec.PCMU,p.default.Codec.Opus],dscp:!0,enableImprovedSignalingErrorPrecision:!1,forceAggressiveIceNomination:!1,logLevel:i.levels.ERROR,maxCallSignalingTimeoutMs:0,preflight:!1,sounds:{},tokenRefreshMs:1e4,voiceEventSidGenerator:y.generateVoiceEventSid},I._edge=null,I._home=null,I._identity=null,I._log=new m.default("Device"),I._options={},I._preferredURI=null,I._publisher=null,I._region=null,I._regTimer=null,I._shouldReRegister=!1,I._soundcache=new Map,I._state=C.State.Unregistered,I._stateEventMapping=(M={},M[C.State.Destroyed]=C.EventName.Destroyed,M[C.State.Unregistered]=C.EventName.Unregistered,M[C.State.Registering]=C.EventName.Registering,M[C.State.Registered]=C.EventName.Registered,M),I._stream=null,I._streamConnectedPromise=null,I._tokenWillExpireTimeout=null,I._createDefaultPayload=function(R){var O={aggressive_nomination:I._options.forceAggressiveIceNomination,browser_extension:I._isBrowserExtension,dscp:!!I._options.dscp,ice_restart_enabled:!0,platform:b.getMediaEngine(),sdk_version:d.RELEASE_VERSION};function F(H,Y){Y&&(O[H]=Y)}if(R){var G=R.parameters.CallSid;F("call_sid",/^TJ/.test(G)?void 0:G),F("temp_call_sid",R.outboundConnectionId),F("audio_codec",R.codec),O.direction=R.direction}return F("gateway",I._stream&&I._stream.gateway),F("region",I._stream&&I._stream.region),O},I._onSignalingClose=function(){I._stream=null,I._streamConnectedPromise=null},I._onSignalingConnected=function(R){var O,F=v.getRegionShortcode(R.region);if(I._edge=R.edge||v.regionToEdge[F]||R.region,I._region=F||R.region,I._home=R.home,(O=I._publisher)===null||O===void 0||O.setHost(v.createEventGatewayURI(R.home)),R.token&&(I._identity=R.token.identity,typeof R.token.ttl=="number"&&typeof I._options.tokenRefreshMs=="number")){var G=R.token.ttl*1e3,H=Math.max(0,G-I._options.tokenRefreshMs);I._tokenWillExpireTimeout=setTimeout(function(){I._log.debug("#tokenWillExpire"),I.emit("tokenWillExpire",I),I._tokenWillExpireTimeout&&(clearTimeout(I._tokenWillExpireTimeout),I._tokenWillExpireTimeout=null)},H)}var Y=v.getChunderURIs(I._edge);if(Y.length>0){var J=Y[0];I._preferredURI=v.createSignalingEndpointURL(J)}else I._log.warn("Could not parse a preferred URI from the stream#connected event.");I._shouldReRegister&&I.register()},I._onSignalingError=function(R){if(typeof R=="object"){var O=R.error,F=R.callsid;if(typeof O=="object"){var G=typeof F=="string"&&I._findCall(F)||void 0,H=O.code,Y=O.message,J=O.twilioError;if(typeof H=="number")if(H===31201)J=new u.AuthorizationErrors.AuthenticationFailed(O);else if(H===31204)J=new u.AuthorizationErrors.AccessTokenInvalid(O);else if(H===31205)I._stopRegistrationTimer(),J=new u.AuthorizationErrors.AccessTokenExpired(O);else{var ne=u.getPreciseSignalingErrorByCode(!!I._options.enableImprovedSignalingErrorPrecision,H);typeof ne<"u"&&(J=new ne(O))}J||(I._log.error("Unknown signaling error: ",O),J=new u.GeneralErrors.UnknownError(Y,O)),I._log.error("Received error: ",J),I._log.debug("#error",O),I.emit(C.EventName.Error,J,G)}}},I._onSignalingInvite=function(R){return e(I,void 0,void 0,function(){var O,F,G,H,Y,J=this,ne;return r(this,function(le){switch(le.label){case 0:return O=!!this._activeCall,O&&!this._options.allowIncomingWhileBusy?(this._log.info("Device busy; ignoring incoming invite"),[2]):!R.callsid||!R.sdp?(this._log.debug("#error",R),this.emit(C.EventName.Error,new u.ClientErrors.BadRequest("Malformed invite from gateway")),[2]):(F=R.parameters||{},F.CallSid=F.CallSid||R.callsid,G=Object.assign({},_.queryToJson(F.Params)),[4,this._makeCall(G,{callParameters:F,enableImprovedSignalingErrorPrecision:!!this._options.enableImprovedSignalingErrorPrecision,offerSdp:R.sdp,reconnectToken:R.reconnect,voiceEventSidGenerator:this._options.voiceEventSidGenerator})]);case 1:return H=le.sent(),this._calls.push(H),H.once("accept",function(){J._soundcache.get(C.SoundName.Incoming).stop(),J._publishNetworkChange()}),Y=!((ne=this._audio)===null||ne===void 0)&&ne.incoming()&&!O?function(){return J._soundcache.get(C.SoundName.Incoming).play()}:function(){return Promise.resolve()},this._showIncomingCall(H,Y),[2]}})})},I._onSignalingOffline=function(){I._log.info("Stream is offline"),I._edge=null,I._region=null,I._shouldReRegister=I.state!==C.State.Unregistered,I._setState(C.State.Unregistered)},I._onSignalingReady=function(){I._log.info("Stream is ready"),I._setState(C.State.Registered)},I._publishNetworkChange=function(){I._activeCall&&I._networkInformation&&I._publisher.info("network-information","network-change",{connection_type:I._networkInformation.type,downlink:I._networkInformation.downlink,downlinkMax:I._networkInformation.downlinkMax,effective_type:I._networkInformation.effectiveType,rtt:I._networkInformation.rtt},I._activeCall)},I._updateInputStream=function(R){var O=I._activeCall;return O&&!R?Promise.reject(new u.InvalidStateError("Cannot unset input device while a call is in progress.")):(I._callInputStream=R,O?O._setInputTracksFromStream(R):Promise.resolve())},I._updateSinkIds=function(R,O){var F=R==="ringtone"?I._updateRingtoneSinkIds(O):I._updateSpeakerSinkIds(O);return F.then(function(){I._publisher.info("audio",R+"-devices-set",{audio_device_ids:O},I._activeCall)},function(G){throw I._publisher.error("audio",R+"-devices-set-failed",{audio_device_ids:O,message:G.message},I._activeCall),G})},I._setupLoglevel(s.logLevel),I._logOptions("constructor",s),I.updateToken(P),_.isLegacyEdge())throw new u.NotSupportedError("Microsoft Edge Legacy (https://support.microsoft.com/en-us/help/4533505/what-is-microsoft-edge-legacy) is deprecated and will not be able to connect to Twilio to make or receive calls after September 1st, 2020. Please see this documentation for a list of supported browsers https://www.twilio.com/docs/voice/client/javascript#supported-browsers");if(!C.isSupported&&s.ignoreBrowserSupport)throw window&&window.location&&window.location.protocol==="http:"?new u.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again."):new u.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.");if(window){var j=window,A=j.msBrowser||j.browser||j.chrome;I._isBrowserExtension=!!A&&!!A.runtime&&!!A.runtime.id||!!j.safari&&!!j.safari.extension}if(I._isBrowserExtension&&I._log.info("Running as browser extension."),navigator){var x=navigator;I._networkInformation=x.connection||x.mozConnection||x.webkitConnection}return I._networkInformation&&typeof I._networkInformation.addEventListener=="function"&&I._networkInformation.addEventListener("change",I._publishNetworkChange),C._getOrCreateAudioContext(),C._audioContext&&(C._dialtonePlayer||(C._dialtonePlayer=new f.default(C._audioContext))),typeof C._isUnifiedPlanDefault>"u"&&(C._isUnifiedPlanDefault=typeof window<"u"&&typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u"?_.isUnifiedPlanDefault(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver):!1),I._boundDestroy=I.destroy.bind(I),I._boundConfirmClose=I._confirmClose.bind(I),typeof window<"u"&&window.addEventListener&&(window.addEventListener("unload",I._boundDestroy),window.addEventListener("pagehide",I._boundDestroy)),I.updateOptions(s),I}return Object.defineProperty(C,"audioContext",{get:function(){return C._audioContext},enumerable:!1,configurable:!0}),Object.defineProperty(C,"extension",{get:function(){var P=typeof document<"u"?document.createElement("audio"):{canPlayType:!1},s;try{s=P.canPlayType&&!!P.canPlayType("audio/mpeg").replace(/no/,"")}catch{s=!1}var M;try{M=P.canPlayType&&!!P.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch{M=!1}return M&&!s?"ogg":"mp3"},enumerable:!1,configurable:!0}),Object.defineProperty(C,"isSupported",{get:function(){return b.enabled()},enumerable:!1,configurable:!0}),Object.defineProperty(C,"packageName",{get:function(){return d.PACKAGE_NAME},enumerable:!1,configurable:!0}),C.runPreflight=function(P,s){return new E.PreflightTest(P,n({audioContext:C._getOrCreateAudioContext()},s))},C.toString=function(){return"[Twilio.Device class]"},Object.defineProperty(C,"version",{get:function(){return d.RELEASE_VERSION},enumerable:!1,configurable:!0}),C._getOrCreateAudioContext=function(){return C._audioContext||(typeof AudioContext<"u"?C._audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(C._audioContext=new webkitAudioContext)),C._audioContext},Object.defineProperty(C.prototype,"audio",{get:function(){return this._audio},enumerable:!1,configurable:!0}),C.prototype.connect=function(P){return P===void 0&&(P={}),e(this,void 0,void 0,function(){var s,M;return r(this,function(I){switch(I.label){case 0:if(this._log.debug(".connect",JSON.stringify(P&&P.params||{}),P),this._throwIfDestroyed(),this._activeCall)throw new u.InvalidStateError("A Call is already active");return M=this,[4,this._makeCall(P.params||{},{enableImprovedSignalingErrorPrecision:!!this._options.enableImprovedSignalingErrorPrecision,rtcConfiguration:P.rtcConfiguration,voiceEventSidGenerator:this._options.voiceEventSidGenerator})];case 1:return s=M._activeCall=I.sent(),this._calls.splice(0).forEach(function(j){return j.ignore()}),this._soundcache.get(C.SoundName.Incoming).stop(),s.accept({rtcConstraints:P.rtcConstraints}),this._publishNetworkChange(),[2,s]}})})},Object.defineProperty(C.prototype,"calls",{get:function(){return this._calls},enumerable:!1,configurable:!0}),C.prototype.destroy=function(){var P;this._log.debug(".destroy"),this._log.debug("Rejecting any incoming calls");var s=this._calls.slice(0);s.forEach(function(M){return M.reject()}),this.disconnectAll(),this._stopRegistrationTimer(),this._destroyStream(),this._destroyPublisher(),this._destroyAudioHelper(),(P=this._audioProcessorEventObserver)===null||P===void 0||P.destroy(),this._networkInformation&&typeof this._networkInformation.removeEventListener=="function"&&this._networkInformation.removeEventListener("change",this._publishNetworkChange),typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("beforeunload",this._boundConfirmClose),window.removeEventListener("unload",this._boundDestroy),window.removeEventListener("pagehide",this._boundDestroy)),this._setState(C.State.Destroyed),o.EventEmitter.prototype.removeAllListeners.call(this)},C.prototype.disconnectAll=function(){this._log.debug(".disconnectAll");var P=this._calls.splice(0);P.forEach(function(s){return s.disconnect()}),this._activeCall&&this._activeCall.disconnect()},Object.defineProperty(C.prototype,"edge",{get:function(){return this._edge},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"home",{get:function(){return this._home},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"identity",{get:function(){return this._identity},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"isBusy",{get:function(){return!!this._activeCall},enumerable:!1,configurable:!0}),C.prototype.register=function(){return e(this,void 0,void 0,function(){return r(this,function(P){switch(P.label){case 0:if(this._log.debug(".register"),this.state!==C.State.Unregistered)throw new u.InvalidStateError('Attempt to register when device is in state "'+this.state+'". '+('Must be "'+C.State.Unregistered+'".'));return this._shouldReRegister=!1,this._setState(C.State.Registering),[4,this._streamConnectedPromise||this._setupStream()];case 1:return P.sent(),[4,this._sendPresence(!0)];case 2:return P.sent(),[4,_.promisifyEvents(this,C.State.Registered,C.State.Unregistered)];case 3:return P.sent(),[2]}})})},Object.defineProperty(C.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),C.prototype.toString=function(){return"[Twilio.Device instance]"},C.prototype.unregister=function(){return e(this,void 0,void 0,function(){var P,s;return r(this,function(M){switch(M.label){case 0:if(this._log.debug(".unregister"),this.state!==C.State.Registered)throw new u.InvalidStateError('Attempt to unregister when device is in state "'+this.state+'". '+('Must be "'+C.State.Registered+'".'));return this._shouldReRegister=!1,[4,this._streamConnectedPromise];case 1:return P=M.sent(),s=new Promise(function(I){P.on("offline",I)}),[4,this._sendPresence(!1)];case 2:return M.sent(),[4,s];case 3:return M.sent(),[2]}})})},C.prototype.updateOptions=function(P){if(P===void 0&&(P={}),this._logOptions("updateOptions",P),this.state===C.State.Destroyed)throw new u.InvalidStateError('Attempt to "updateOptions" when device is in state "'+this.state+'".');this._options=n(n(n({},this._defaultOptions),this._options),P);var s=new Set(this._chunderURIs),M=typeof this._options.chunderw=="string"?[this._options.chunderw]:Array.isArray(this._options.chunderw)&&this._options.chunderw,I=this._chunderURIs=(M||v.getChunderURIs(this._options.edge)).map(v.createSignalingEndpointURL),j=s.size!==I.length;if(!j)for(var A=0,x=I;A<x.length;A++){var R=x[A];if(!s.has(R)){j=!0;break}}if(this.isBusy&&j)throw new u.InvalidStateError("Cannot change Edge while on an active Call");this._setupLoglevel(this._options.logLevel);for(var O=0,F=Object.keys(C._defaultSounds);O<F.length;O++){var G=F[O],H=C._defaultSounds[G],Y=d.SOUNDS_BASE_URL+"/"+H.filename+"."+C.extension+("?cache="+d.RELEASE_VERSION),J=this._options.sounds&&this._options.sounds[G]||Y,ne=new(this._options.Sound||T.default)(G,J,{audioContext:this._options.disableAudioContextSounds?null:C.audioContext,maxDuration:H.maxDuration,shouldLoop:H.shouldLoop});this._soundcache.set(G,ne)}this._setupAudioHelper(),this._setupPublisher(),j&&this._streamConnectedPromise&&this._setupStream(),typeof window<"u"&&typeof window.addEventListener=="function"&&this._options.closeProtection&&(window.removeEventListener("beforeunload",this._boundConfirmClose),window.addEventListener("beforeunload",this._boundConfirmClose))},C.prototype.updateToken=function(P){if(this._log.debug(".updateToken"),this.state===C.State.Destroyed)throw new u.InvalidStateError('Attempt to "updateToken" when device is in state "'+this.state+'".');if(typeof P!="string")throw new u.InvalidArgumentError(L);this._token=P,this._stream&&this._stream.setToken(this._token),this._publisher&&this._publisher.setToken(this._token)},C.prototype._confirmClose=function(P){if(!this._activeCall)return"";var s=this._options.closeProtection||!1,M=typeof s!="string"?"A call is currently in-progress. Leaving or reloading this page will end the call.":s;return(P||window.event).returnValue=M,M},C.prototype._destroyAudioHelper=function(){this._audio&&(this._audio._destroy(),this._audio=null)},C.prototype._destroyPublisher=function(){this._publisher&&(this._publisher=null)},C.prototype._destroyStream=function(){this._stream&&(this._stream.removeListener("close",this._onSignalingClose),this._stream.removeListener("connected",this._onSignalingConnected),this._stream.removeListener("error",this._onSignalingError),this._stream.removeListener("invite",this._onSignalingInvite),this._stream.removeListener("offline",this._onSignalingOffline),this._stream.removeListener("ready",this._onSignalingReady),this._stream.destroy(),this._stream=null),this._onSignalingOffline(),this._streamConnectedPromise=null},C.prototype._findCall=function(P){return this._calls.find(function(s){return s.parameters.CallSid===P||s.outboundConnectionId===P})||null},C.prototype._logOptions=function(P,s){s===void 0&&(s={});var M=["allowIncomingWhileBusy","appName","appVersion","closeProtection","codecPreferences","disableAudioContextSounds","dscp","edge","enableImprovedSignalingErrorPrecision","forceAggressiveIceNomination","logLevel","maxAverageBitrate","maxCallSignalingTimeoutMs","sounds","tokenRefreshMs"],I=["RTCPeerConnection","enumerateDevices","getUserMedia"];if(typeof s=="object"){var j=n({},s);Object.keys(j).forEach(function(A){!M.includes(A)&&!I.includes(A)&&delete j[A],I.includes(A)&&(j[A]=!0)}),this._log.debug("."+P,JSON.stringify(j))}},C.prototype._makeCall=function(P,s){return e(this,void 0,void 0,function(){var M,I,j,A,x=this;return r(this,function(R){switch(R.label){case 0:if(typeof C._isUnifiedPlanDefault>"u")throw new u.InvalidStateError("Device has not been initialized.");return A={audioHelper:this._audio,isUnifiedPlanDefault:C._isUnifiedPlanDefault,onIgnore:function(){x._soundcache.get(C.SoundName.Incoming).stop()}},[4,this._streamConnectedPromise||this._setupStream()];case 1:return M=(A.pstream=R.sent(),A.publisher=this._publisher,A.soundcache=this._soundcache,A),s=Object.assign({MediaStream:this._options.MediaStream||b.PeerConnection,RTCPeerConnection:this._options.RTCPeerConnection,beforeAccept:function(O){!x._activeCall||x._activeCall===O||(x._activeCall.disconnect(),x._removeCall(x._activeCall))},codecPreferences:this._options.codecPreferences,customSounds:this._options.sounds,dialtonePlayer:C._dialtonePlayer,dscp:this._options.dscp,forceAggressiveIceNomination:this._options.forceAggressiveIceNomination,getInputStream:function(){return x._options.fileInputStream||x._callInputStream},getSinkIds:function(){return x._callSinkIds},maxAverageBitrate:this._options.maxAverageBitrate,preflight:this._options.preflight,rtcConstraints:this._options.rtcConstraints,shouldPlayDisconnect:function(){var O;return(O=x._audio)===null||O===void 0?void 0:O.disconnect()},twimlParams:P,voiceEventSidGenerator:this._options.voiceEventSidGenerator},s),I=function(){if(!x._stream){x._log.warn("UnsetPreferredUri called without a stream");return}x._activeCall===null&&x._calls.length===0&&x._stream.updatePreferredURI(null)},j=new(this._options.Call||p.default)(M,s),this._publisher.info("settings","init",{RTCPeerConnection:!!this._options.RTCPeerConnection,enumerateDevices:!!this._options.enumerateDevices,getUserMedia:!!this._options.getUserMedia},j),j.once("accept",function(){var O,F,G;x._stream.updatePreferredURI(x._preferredURI),x._removeCall(j),x._activeCall=j,x._audio&&x._audio._maybeStartPollingVolume(),j.direction===p.default.CallDirection.Outgoing&&(!((O=x._audio)===null||O===void 0)&&O.outgoing())&&x._soundcache.get(C.SoundName.Outgoing).play();var H={edge:x._edge||x._region};x._options.edge&&(H.selected_edge=Array.isArray(x._options.edge)?x._options.edge:[x._options.edge]),x._publisher.info("settings","edge",H,j),!((F=x._audio)===null||F===void 0)&&F.processedStream&&((G=x._audioProcessorEventObserver)===null||G===void 0||G.emit("enabled"))}),j.addListener("error",function(O){j.status()==="closed"&&(x._removeCall(j),I()),x._audio&&x._audio._maybeStopPollingVolume(),x._maybeStopIncomingSound()}),j.once("cancel",function(){x._log.info("Canceled: "+j.parameters.CallSid),x._removeCall(j),I(),x._audio&&x._audio._maybeStopPollingVolume(),x._maybeStopIncomingSound()}),j.once("disconnect",function(){x._audio&&x._audio._maybeStopPollingVolume(),x._removeCall(j),I(),x._maybeStopIncomingSound()}),j.once("reject",function(){x._log.info("Rejected: "+j.parameters.CallSid),x._audio&&x._audio._maybeStopPollingVolume(),x._removeCall(j),I(),x._maybeStopIncomingSound()}),j.on("transportClose",function(){j.status()===p.default.State.Pending&&(x._audio&&x._audio._maybeStopPollingVolume(),x._removeCall(j),x._maybeStopIncomingSound())}),[2,j]}})})},C.prototype._maybeStopIncomingSound=function(){this._calls.length||this._soundcache.get(C.SoundName.Incoming).stop()},C.prototype._removeCall=function(P){this._activeCall===P&&(this._activeCall=null);for(var s=this._calls.length-1;s>=0;s--)P===this._calls[s]&&this._calls.splice(s,1)},C.prototype._sendPresence=function(P){return e(this,void 0,void 0,function(){var s;return r(this,function(M){switch(M.label){case 0:return[4,this._streamConnectedPromise];case 1:return s=M.sent(),s?(s.register({audio:P}),P?this._startRegistrationTimer():this._stopRegistrationTimer(),[2]):[2]}})})},C.prototype._setState=function(P){if(P!==this.state){this._state=P;var s=this._stateEventMapping[P];this._log.debug("#"+s),this.emit(s)}},C.prototype._setupAudioHelper=function(){var P=this;this._audioProcessorEventObserver||(this._audioProcessorEventObserver=new a.AudioProcessorEventObserver,this._audioProcessorEventObserver.on("event",function(M){var I=M.name,j=M.group;P._publisher.info(j,I,{},P._activeCall)}));var s={audioContext:C.audioContext,audioProcessorEventObserver:this._audioProcessorEventObserver,enumerateDevices:this._options.enumerateDevices,getUserMedia:this._options.getUserMedia||g.default};if(this._audio){this._log.info("Found existing audio helper; updating options..."),this._audio._updateUserOptions(s);return}this._audio=new(this._options.AudioHelper||c.default)(this._updateSinkIds,this._updateInputStream,s),this._audio.on("deviceChange",function(M){var I=P._activeCall,j=M.map(function(A){return A.deviceId});P._publisher.info("audio","device-change",{lost_active_device_ids:j},I),I&&I._mediaHandler._onInputDevicesChanged()})},C.prototype._setupLoglevel=function(P){var s=typeof P=="number"||typeof P=="string"?P:i.levels.ERROR;this._log.setDefaultLevel(s),this._log.info("Set logger default level to",s)},C.prototype._setupPublisher=function(){var P=this;this._publisher&&(this._log.info("Found existing publisher; destroying..."),this._destroyPublisher());var s={defaultPayload:this._createDefaultPayload,metadata:{app_name:this._options.appName,app_version:this._options.appVersion}};return this._options.eventgw&&(s.host=this._options.eventgw),this._home&&(s.host=v.createEventGatewayURI(this._home)),this._publisher=new(this._options.Publisher||l.default)(h,this.token,s),this._options.publishEvents===!1?this._publisher.disable():this._publisher.on("error",function(M){P._log.warn("Cannot connect to insights.",M)}),this._publisher},C.prototype._setupStream=function(){var P=this;return this._stream&&(this._log.info("Found existing stream; destroying..."),this._destroyStream()),this._log.info("Setting up VSP"),this._stream=new(this._options.PStream||w.default)(this.token,this._chunderURIs,{backoffMaxMs:this._options.backoffMaxMs,maxPreferredDurationMs:this._options.maxCallSignalingTimeoutMs}),this._stream.addListener("close",this._onSignalingClose),this._stream.addListener("connected",this._onSignalingConnected),this._stream.addListener("error",this._onSignalingError),this._stream.addListener("invite",this._onSignalingInvite),this._stream.addListener("offline",this._onSignalingOffline),this._stream.addListener("ready",this._onSignalingReady),this._streamConnectedPromise=_.promisifyEvents(this._stream,"connected","close").then(function(){return P._stream})},C.prototype._showIncomingCall=function(P,s){var M=this,I;return Promise.race([s(),new Promise(function(j,A){I=setTimeout(function(){var x="Playing incoming ringtone took too long; it might not play. Continuing execution...";A(new Error(x))},D)})]).catch(function(j){M._log.warn(j.message)}).then(function(){clearTimeout(I),M._log.debug("#incoming",JSON.stringify({customParameters:P.customParameters,parameters:P.parameters})),M.emit(C.EventName.Incoming,P)})},C.prototype._startRegistrationTimer=function(){var P=this;this._stopRegistrationTimer(),this._regTimer=setTimeout(function(){P._sendPresence(!0)},S)},C.prototype._stopRegistrationTimer=function(){this._regTimer&&clearTimeout(this._regTimer)},C.prototype._throwIfDestroyed=function(){if(this.state===C.State.Destroyed)throw new u.InvalidStateError("Device has been destroyed.")},C.prototype._updateRingtoneSinkIds=function(P){return Promise.resolve(this._soundcache.get(C.SoundName.Incoming).setSinkIds(P))},C.prototype._updateSpeakerSinkIds=function(P){Array.from(this._soundcache.entries()).filter(function(M){return M[0]!==C.SoundName.Incoming}).forEach(function(M){return M[1].setSinkIds(P)}),this._callSinkIds=P;var s=this._activeCall;return s?s._setSinkIds(P):Promise.resolve()},C._defaultSounds={disconnect:{filename:"disconnect",maxDuration:3e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3}},C}(o.EventEmitter);return function(k){(function(C){C.Error="error",C.Incoming="incoming",C.Destroyed="destroyed",C.Unregistered="unregistered",C.Registering="registering",C.Registered="registered",C.TokenWillExpire="tokenWillExpire"})(k.EventName||(k.EventName={})),function(C){C.Destroyed="destroyed",C.Unregistered="unregistered",C.Registering="registering",C.Registered="registered"}(k.State||(k.State={})),function(C){C.Incoming="incoming",C.Outgoing="outgoing",C.Disconnect="disconnect",C.Dtmf0="dtmf0",C.Dtmf1="dtmf1",C.Dtmf2="dtmf2",C.Dtmf3="dtmf3",C.Dtmf4="dtmf4",C.Dtmf5="dtmf5",C.Dtmf6="dtmf6",C.Dtmf7="dtmf7",C.Dtmf8="dtmf8",C.Dtmf9="dtmf9",C.DtmfS="dtmfs",C.DtmfH="dtmfh"}(k.SoundName||(k.SoundName={}))}(U||(U={})),Fe.default=U,Fe}var rt={};Object.defineProperty(rt,"__esModule",{value:!0});rt.IceCandidate=void 0;var Na=function(){function t(n,e){e===void 0&&(e=!1),this.deleted=!1;var r,o=n.candidate.split("network-cost ");o[1]&&(r=parseInt(o[1],10)),this.candidateType=n.type,this.ip=n.ip||n.address,this.isRemote=e,this.networkCost=r,this.port=n.port,this.priority=n.priority,this.protocol=n.protocol,this.relatedAddress=n.relatedAddress,this.relatedPort=n.relatedPort,this.tcpType=n.tcpType,this.transportId=n.sdpMid}return t.prototype.toPayload=function(){return{candidate_type:this.candidateType,deleted:this.deleted,ip:this.ip,is_remote:this.isRemote,"network-cost":this.networkCost,port:this.port,priority:this.priority,protocol:this.protocol,related_address:this.relatedAddress,related_port:this.relatedPort,tcp_type:this.tcpType,transport_id:this.transportId}},t}();rt.IceCandidate=Na;var Ut={},Ie={};Object.defineProperty(Ie,"__esModule",{value:!0});Ie.isNonNegativeNumber=Ie.calculate=void 0;var sn=94.768;function Zn(t,n,e){if(typeof t!="number"||typeof n!="number"||typeof e!="number"||!Oe(t)||!Oe(n)||!Oe(e))return null;var r=t+n*2+10,o=0;switch(!0){case r<160:o=sn-r/40;break;case r<1e3:o=sn-(r-120)/10;break}switch(!0){case e<=o/2.5:o=Math.max(o-e*2.5,6.52);break;default:o=0;break}var i=1+.035*o+7e-6*o*(o-60)*(100-o);return i}Ie.calculate=Zn;function Oe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)&&t>=0}Ie.isNonNegativeNumber=Oe;Ie.default={calculate:Zn,isNonNegativeNumber:Oe};var Fa=N&&N.__extends||function(){var t=function(n,e){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,o){r.__proto__=o}||function(r,o){for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])},t(n,e)};return function(n,e){t(n,e);function r(){this.constructor=n}n.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}(),Ce=N&&N.__assign||function(){return Ce=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},Ce.apply(this,arguments)},er=N&&N.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;for(var r=Array(t),o=0,n=0;n<e;n++)for(var i=arguments[n],c=0,a=i.length;c<a;c++,o++)r[o]=i[c];return r};Object.defineProperty(Ut,"__esModule",{value:!0});var Ba=ve,cn=oe,Va=Ie,Wa=Pe,lt=K,Ga=5,Ha=0,$a=3,qa=1e3,za=5*1e3,Ja={audioInputLevel:{minStandardDeviation:327.67,sampleCount:10},audioOutputLevel:{minStandardDeviation:327.67,sampleCount:10},bytesReceived:{clearCount:2,min:1,raiseCount:3,sampleCount:3},bytesSent:{clearCount:2,min:1,raiseCount:3,sampleCount:3},jitter:{max:30},mos:{min:3},packetsLostFraction:[{max:1},{clearValue:1,maxAverage:3,sampleCount:7}],rtt:{max:400}};function Ka(t,n){return n.reduce(function(e,r){return e+=r>t?1:0},0)}function Qa(t,n){return n.reduce(function(e,r){return e+=r<t?1:0},0)}function Xa(t){if(t.length<=0)return null;var n=t.reduce(function(o,i){return o+i},0)/t.length,e=t.map(function(o){return Math.pow(o-n,2)}),r=Math.sqrt(e.reduce(function(o,i){return o+i},0)/e.length);return r}function Ya(t){return t.reduce(function(n,e){return er(n,e)},[])}var Za=function(t){Fa(n,t);function n(e){var r=t.call(this)||this;r._activeWarnings=new Map,r._currentStreaks=new Map,r._inputVolumes=[],r._outputVolumes=[],r._sampleBuffer=[],r._supplementalSampleBuffers={audioInputLevel:[],audioOutputLevel:[]},r._warningsEnabled=!0,e=e||{},r._getRTCStats=e.getRTCStats||Wa.getRTCStats,r._mos=e.Mos||Va.default,r._peerConnection=e.peerConnection,r._thresholds=Ce(Ce({},Ja),e.thresholds);var o=Object.values(r._thresholds).map(function(i){return i.sampleCount}).filter(function(i){return!!i});return r._maxSampleCount=Math.max.apply(Math,er([Ga],o)),r._peerConnection&&r.enable(r._peerConnection),r}return n.prototype.addVolumes=function(e,r){this._inputVolumes.push(e),this._outputVolumes.push(r)},n.prototype.disable=function(){return this._sampleInterval&&(clearInterval(this._sampleInterval),delete this._sampleInterval),this},n.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},n.prototype.enable=function(e){if(e){if(this._peerConnection&&e!==this._peerConnection)throw new cn.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=e}if(!this._peerConnection)throw new cn.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),qa),this},n.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},n.prototype.hasActiveWarning=function(e,r){var o=e+":"+r;return!!this._activeWarnings.get(o)},n.prototype._addSample=function(e){var r=this._sampleBuffer;r.push(e),r.length>this._maxSampleCount&&r.splice(0,r.length-this._maxSampleCount)},n.prototype._clearWarning=function(e,r,o){var i=e+":"+r,c=this._activeWarnings.get(i);!c||Date.now()-c.timeRaised<za||(this._activeWarnings.delete(i),this.emit("warning-cleared",Ce(Ce({},o),{name:e,threshold:{name:r,value:this._thresholds[e][r]}})))},n.prototype._createSample=function(e,r){var o=r&&r.totals.bytesSent||0,i=r&&r.totals.bytesReceived||0,c=r&&r.totals.packetsSent||0,a=r&&r.totals.packetsReceived||0,p=r&&r.totals.packetsLost||0,d=e.bytesSent-o,f=e.bytesReceived-i,u=e.packetsSent-c,l=e.packetsReceived-a,m=e.packetsLost-p,E=l+m,w=E>0?m/E*100:0,v=e.packetsReceived+e.packetsLost,b=v>0?e.packetsLost/v*100:100,g=typeof e.rtt=="number"||!r?e.rtt:r.rtt,T=this._inputVolumes.splice(0);this._supplementalSampleBuffers.audioInputLevel.push(T);var _=this._outputVolumes.splice(0);return this._supplementalSampleBuffers.audioOutputLevel.push(_),{audioInputLevel:Math.round(lt.average(T)),audioOutputLevel:Math.round(lt.average(_)),bytesReceived:f,bytesSent:d,codecName:e.codecName,jitter:e.jitter,mos:this._mos.calculate(g,e.jitter,r&&w),packetsLost:m,packetsLostFraction:w,packetsReceived:l,packetsSent:u,rtt:g,timestamp:e.timestamp,totals:{bytesReceived:e.bytesReceived,bytesSent:e.bytesSent,packetsLost:e.packetsLost,packetsLostFraction:b,packetsReceived:e.packetsReceived,packetsSent:e.packetsSent}}},n.prototype._fetchSample=function(){var e=this;this._getSample().then(function(r){e._addSample(r),e._raiseWarnings(),e.emit("sample",r)}).catch(function(r){e.disable(),e.emit("error",r)})},n.prototype._getSample=function(){var e=this;return this._getRTCStats(this._peerConnection).then(function(r){var o=null;return e._sampleBuffer.length&&(o=e._sampleBuffer[e._sampleBuffer.length-1]),e._createSample(r,o)})},n.prototype._raiseWarning=function(e,r,o){var i=e+":"+r;if(!this._activeWarnings.has(i)){this._activeWarnings.set(i,{timeRaised:Date.now()});var c=this._thresholds[e],a;if(Array.isArray(c)){var p=c.find(function(d){return r in d});p&&(a=p[r])}else a=this._thresholds[e][r];this.emit("warning",Ce(Ce({},o),{name:e,threshold:{name:r,value:a}}))}},n.prototype._raiseWarnings=function(){var e=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach(function(r){return e._raiseWarningsForStat(r)})},n.prototype._raiseWarningsForStat=function(e){var r=this,o=Array.isArray(this._thresholds[e])?this._thresholds[e]:[this._thresholds[e]];o.forEach(function(i){var c=r._sampleBuffer,a=i.clearCount||Ha,p=i.raiseCount||$a,d=i.sampleCount||r._maxSampleCount,f=c.slice(-d),u=f.map(function(y){return y[e]}),l=u.some(function(y){return typeof y>"u"||y===null});if(!l){var m;if(typeof i.max=="number"&&(m=Ka(i.max,u),m>=p?r._raiseWarning(e,"max",{values:u,samples:f}):m<=a&&r._clearWarning(e,"max",{values:u,samples:f})),typeof i.min=="number"&&(m=Qa(i.min,u),m>=p?r._raiseWarning(e,"min",{values:u,samples:f}):m<=a&&r._clearWarning(e,"min",{values:u,samples:f})),typeof i.maxDuration=="number"&&c.length>1){f=c.slice(-2);var E=f[0][e],w=f[1][e],v=r._currentStreaks.get(e)||0,b=E===w?v+1:0;r._currentStreaks.set(e,b),b>=i.maxDuration?r._raiseWarning(e,"maxDuration",{value:b}):b===0&&r._clearWarning(e,"maxDuration",{value:v})}if(typeof i.minStandardDeviation=="number"){var g=r._supplementalSampleBuffers[e];if(!g||g.length<i.sampleCount)return;g.length>i.sampleCount&&g.splice(0,g.length-i.sampleCount);var T=Ya(g.slice(-d)),_=Xa(T);if(typeof _!="number")return;_<i.minStandardDeviation?r._raiseWarning(e,"minStandardDeviation",{value:_}):r._clearWarning(e,"minStandardDeviation",{value:_})}[["maxAverage",function(y,S){return y>S}],["minAverage",function(y,S){return y<S}]].forEach(function(y){var S=y[0],D=y[1];if(typeof i[S]=="number"&&u.length>=d){var h=lt.average(u);D(h,i[S])?r._raiseWarning(e,S,{values:u,samples:f}):D(h,i.clearValue||i[S])||r._clearWarning(e,S,{values:u,samples:f})}})}})},n}(Ba.EventEmitter);Ut.default=Za;var un;function Nt(){if(un)return Ne;un=1;var t=N&&N.__extends||function(){var U=function(k,C){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,s){P.__proto__=s}||function(P,s){for(var M in s)Object.prototype.hasOwnProperty.call(s,M)&&(P[M]=s[M])},U(k,C)};return function(k,C){U(k,C);function P(){this.constructor=k}k.prototype=C===null?Object.create(C):(P.prototype=C.prototype,new P)}}(),n=N&&N.__assign||function(){return n=Object.assign||function(U){for(var k,C=1,P=arguments.length;C<P;C++){k=arguments[C];for(var s in k)Object.prototype.hasOwnProperty.call(k,s)&&(U[s]=k[s])}return U},n.apply(this,arguments)};Object.defineProperty(Ne,"__esModule",{value:!0});var e=ve,r=Xe,o=nt(),i=oe,c=se,a=be,p=rt,d=de,f=Ut,u=K,l=Le,m=ie,E={factor:1.1,jitter:.5,max:3e4,min:1},w=70,v=500,b=160,g=10,T=5e3,_={disconnect:!0,info:{code:31003,message:"Connection with Twilio was interrupted.",twilioError:new i.MediaErrors.ConnectionError}},y={packetsLostFraction:{max:"packet-loss",maxAverage:"packets-lost-fraction"}},S={audioInputLevel:"audio-input-level",audioOutputLevel:"audio-output-level",bytesReceived:"bytes-received",bytesSent:"bytes-sent",jitter:"jitter",mos:"mos",rtt:"rtt"},D={max:"high-",maxAverage:"high-",maxDuration:"constant-",min:"low-",minStandardDeviation:"constant-"},h=function(U){t(k,U);function k(C,P){var s=U.call(this)||this;s.parameters={},s._inputVolumeStreak=0,s._isAnswered=!1,s._isCancelled=!1,s._isRejected=!1,s._latestInputVolume=0,s._latestOutputVolume=0,s._log=new c.default("Call"),s._mediaStatus=k.State.Pending,s._messages=new Map,s._metricsSamples=[],s._options={MediaHandler:a.PeerConnection,enableImprovedSignalingErrorPrecision:!1,offerSdp:null,shouldPlayDisconnect:function(){return!0},voiceEventSidGenerator:l.generateVoiceEventSid},s._outputVolumeStreak=0,s._shouldSendHangup=!0,s._signalingStatus=k.State.Pending,s._soundcache=new Map,s._status=k.State.Pending,s._wasConnected=!1,s.toString=function(){return"[Twilio.Call instance]"},s._emitWarning=function(A,x,R,O,F,G){var H=F?"-cleared":"-raised",Y=A+"warning"+H;if(!(x==="constant-audio-input-level"&&s.isMuted())){var J=F?"info":"warning";x==="constant-audio-output-level"&&(J="info");var ne={threshold:R};if(O&&(O instanceof Array?ne.values=O.map(function(ke){return typeof ke=="number"?Math.round(ke*100)/100:O}):ne.value=O),s._publisher.post(J,Y,x,{data:ne},s),x!=="constant-audio-output-level"){var le=F?"warning-cleared":"warning";s._log.debug("#"+le,x),s.emit(le,x,G&&!F?G:null)}}},s._onAck=function(A){var x=A.acktype,R=A.callsid,O=A.voiceeventsid;if(s.parameters.CallSid!==R){s._log.warn("Received ack from a different callsid: "+R);return}x==="message"&&s._onMessageSent(O)},s._onAnswer=function(A){typeof A.reconnect=="string"&&(s._signalingReconnectToken=A.reconnect),!(s._isAnswered&&s._status!==k.State.Reconnecting)&&(s._setCallSid(A),s._isAnswered=!0,s._maybeTransitionToOpen())},s._onCancel=function(A){var x=A.callsid;s.parameters.CallSid===x&&(s._isCancelled=!0,s._publisher.info("connection","cancel",null,s),s._cleanupEventListeners(),s._mediaHandler.close(),s._status=k.State.Closed,s._log.debug("#cancel"),s.emit("cancel"),s._pstream.removeListener("cancel",s._onCancel))},s._onConnected=function(){s._log.info("Received connected from pstream"),s._signalingReconnectToken&&s._mediaHandler.version&&s._pstream.reconnect(s._mediaHandler.version.getSDP(),s.parameters.CallSid,s._signalingReconnectToken)},s._onHangup=function(A){if(s.status()!==k.State.Closed){if(A.callsid&&(s.parameters.CallSid||s.outboundConnectionId)){if(A.callsid!==s.parameters.CallSid&&A.callsid!==s.outboundConnectionId)return}else if(A.callsid)return;if(s._log.info("Received HANGUP from gateway"),A.error){var x=A.error.code,R=i.getPreciseSignalingErrorByCode(s._options.enableImprovedSignalingErrorPrecision,x),O=typeof R<"u"?new R(A.error.message):new i.GeneralErrors.ConnectionError("Error sent from gateway in HANGUP");s._log.error("Received an error from the gateway:",O),s._log.debug("#error",O),s.emit("error",O)}s._shouldSendHangup=!1,s._publisher.info("connection","disconnected-by-remote",null,s),s._disconnect(null,!0),s._cleanupEventListeners()}},s._onMediaFailure=function(A){var x=k.MediaFailure,R=x.ConnectionDisconnected,O=x.ConnectionFailed,F=x.IceGatheringFailed,G=x.LowBytes,H=A===O||A===F;if(!u.isChrome(window,window.navigator)&&A===O)return s._mediaHandler.onerror(_);if(s._mediaStatus===k.State.Reconnecting){if(H){if(Date.now()-s._mediaReconnectStartTime>E.max)return s._log.warn("Exceeded max ICE retries"),s._mediaHandler.onerror(_);try{s._mediaReconnectBackoff.backoff()}catch(ke){if(!(ke.message&&ke.message==="Backoff in progress."))throw ke}}return}var Y=s._mediaHandler.version.pc,J=Y&&Y.iceConnectionState==="disconnected",ne=s._monitor.hasActiveWarning("bytesSent","min")||s._monitor.hasActiveWarning("bytesReceived","min");if(A===G&&J||A===R&&ne||H){var le=new i.MediaErrors.ConnectionError("Media connection failed.");s._log.warn("ICE Connection disconnected."),s._publisher.warn("connection","error",le,s),s._publisher.info("connection","reconnecting",null,s),s._mediaReconnectStartTime=Date.now(),s._status=k.State.Reconnecting,s._mediaStatus=k.State.Reconnecting,s._mediaReconnectBackoff.reset(),s._mediaReconnectBackoff.backoff(),s._log.debug("#reconnecting"),s.emit("reconnecting",le)}},s._onMediaReconnected=function(){s._mediaStatus===k.State.Reconnecting&&(s._log.info("ICE Connection reestablished."),s._mediaStatus=k.State.Open,s._signalingStatus===k.State.Open&&(s._publisher.info("connection","reconnected",null,s),s._log.debug("#reconnected"),s.emit("reconnected"),s._status=k.State.Open))},s._onMessageReceived=function(A){var x=A.callsid,R=A.content,O=A.contenttype,F=A.messagetype,G=A.voiceeventsid;if(s.parameters.CallSid!==x){s._log.warn("Received a message from a different callsid: "+x);return}var H={content:R,contentType:O,messageType:F,voiceEventSid:G};s._log.debug("#messageReceived",JSON.stringify(H)),s.emit("messageReceived",H)},s._onMessageSent=function(A){if(!s._messages.has(A)){s._log.warn("Received a messageSent with a voiceEventSid that doesn't exists: "+A);return}var x=s._messages.get(A);s._messages.delete(A),s._log.debug("#messageSent",JSON.stringify(x)),s.emit("messageSent",x)},s._onRinging=function(A){if(s._setCallSid(A),!(s._status!==k.State.Connecting&&s._status!==k.State.Ringing)){var x=!!A.sdp;s._status=k.State.Ringing,s._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:x},s),s._log.debug("#ringing"),s.emit("ringing",x)}},s._onRTCSample=function(A){var x=n(n({},A),{inputVolume:s._latestInputVolume,outputVolume:s._latestOutputVolume});s._codec=x.codecName,s._metricsSamples.push(x),s._metricsSamples.length>=g&&s._publishMetrics(),s.emit("sample",A)},s._onSignalingError=function(A){var x=A.callsid,R=A.voiceeventsid;if(s.parameters.CallSid!==x){s._log.warn("Received an error from a different callsid: "+x);return}R&&s._messages.has(R)&&(s._messages.delete(R),s._log.warn("Received an error while sending a message.",A))},s._onSignalingReconnected=function(){s._signalingStatus===k.State.Reconnecting&&(s._log.info("Signaling Connection reestablished."),s._signalingStatus=k.State.Open,s._mediaStatus===k.State.Open&&(s._publisher.info("connection","reconnected",null,s),s._log.debug("#reconnected"),s.emit("reconnected"),s._status=k.State.Open))},s._onTransportClose=function(){s._log.error("Received transportClose from pstream"),s._log.debug("#transportClose"),s.emit("transportClose"),s._signalingReconnectToken?(s._status=k.State.Reconnecting,s._signalingStatus=k.State.Reconnecting,s._log.debug("#reconnecting"),s.emit("reconnecting",new i.SignalingErrors.ConnectionDisconnected)):(s._status=k.State.Closed,s._signalingStatus=k.State.Closed)},s._reemitWarning=function(A,x){var R=/^audio/.test(A.name)?"audio-level-":"network-quality-",O=D[A.threshold.name],F;A.name in y?F=y[A.name][A.threshold.name]:A.name in S&&(F=S[A.name]);var G=O+F;s._emitWarning(R,G,A.threshold.value,A.values||A.value,x,A)},s._reemitWarningCleared=function(A){s._reemitWarning(A,!0)},s._isUnifiedPlanDefault=C.isUnifiedPlanDefault,s._soundcache=C.soundcache,typeof C.onIgnore=="function"&&(s._onIgnore=C.onIgnore);var M=P&&P.twimlParams||{};s.customParameters=new Map(Object.entries(M).map(function(A){var x=A[0],R=A[1];return[x,String(R)]})),Object.assign(s._options,P),s._options.callParameters&&(s.parameters=s._options.callParameters),s._options.reconnectToken&&(s._signalingReconnectToken=s._options.reconnectToken),s._voiceEventSidGenerator=s._options.voiceEventSidGenerator||l.generateVoiceEventSid,s._direction=s.parameters.CallSid?k.CallDirection.Incoming:k.CallDirection.Outgoing,s._direction===k.CallDirection.Incoming&&s.parameters?s.callerInfo=s.parameters.StirStatus?{isVerified:s.parameters.StirStatus==="TN-Validation-Passed-A"}:null:s.callerInfo=null,s._mediaReconnectBackoff=new r.default(E),s._mediaReconnectBackoff.on("ready",function(){return s._mediaHandler.iceRestart()}),s.outboundConnectionId=L();var I=s._publisher=C.publisher;s._direction===k.CallDirection.Incoming?I.info("connection","incoming",null,s):I.info("connection","outgoing",{preflight:s._options.preflight},s);var j=s._monitor=new(s._options.StatsMonitor||f.default);return j.on("sample",s._onRTCSample),j.disableWarnings(),setTimeout(function(){return j.enableWarnings()},T),j.on("warning",function(A,x){(A.name==="bytesSent"||A.name==="bytesReceived")&&s._onMediaFailure(k.MediaFailure.LowBytes),s._reemitWarning(A,x)}),j.on("warning-cleared",function(A){s._reemitWarningCleared(A)}),s._mediaHandler=new s._options.MediaHandler(C.audioHelper,C.pstream,{RTCPeerConnection:s._options.RTCPeerConnection,codecPreferences:s._options.codecPreferences,dscp:s._options.dscp,forceAggressiveIceNomination:s._options.forceAggressiveIceNomination,isUnifiedPlan:s._isUnifiedPlanDefault,maxAverageBitrate:s._options.maxAverageBitrate,preflight:s._options.preflight}),s.on("volume",function(A,x){s._inputVolumeStreak=s._checkVolume(A,s._inputVolumeStreak,s._latestInputVolume,"input"),s._outputVolumeStreak=s._checkVolume(x,s._outputVolumeStreak,s._latestOutputVolume,"output"),s._latestInputVolume=A,s._latestOutputVolume=x}),s._mediaHandler.onaudio=function(A){s._log.debug("#audio"),s.emit("audio",A)},s._mediaHandler.onvolume=function(A,x,R,O){j.addVolumes(R/255*32767,O/255*32767),s.emit("volume",A,x)},s._mediaHandler.ondtlstransportstatechange=function(A){var x=A==="failed"?"error":"debug";s._publisher.post(x,"dtls-transport-state",A,null,s)},s._mediaHandler.onpcconnectionstatechange=function(A){var x="debug",R=s._mediaHandler.getRTCDtlsTransport();A==="failed"&&(x=R&&R.state==="failed"?"error":"warning"),s._publisher.post(x,"pc-connection-state",A,null,s)},s._mediaHandler.onicecandidate=function(A){var x=new p.IceCandidate(A).toPayload();s._publisher.debug("ice-candidate","ice-candidate",x,s)},s._mediaHandler.onselectedcandidatepairchange=function(A){var x=new p.IceCandidate(A.local).toPayload(),R=new p.IceCandidate(A.remote,!0).toPayload();s._publisher.debug("ice-candidate","selected-ice-candidate-pair",{local_candidate:x,remote_candidate:R},s)},s._mediaHandler.oniceconnectionstatechange=function(A){var x=A==="failed"?"error":"debug";s._publisher.post(x,"ice-connection-state",A,null,s)},s._mediaHandler.onicegatheringfailure=function(A){s._publisher.warn("ice-gathering-state",A,null,s),s._onMediaFailure(k.MediaFailure.IceGatheringFailed)},s._mediaHandler.onicegatheringstatechange=function(A){s._publisher.debug("ice-gathering-state",A,null,s)},s._mediaHandler.onsignalingstatechange=function(A){s._publisher.debug("signaling-state",A,null,s)},s._mediaHandler.ondisconnected=function(A){s._log.warn(A),s._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{message:A},s),s._log.debug("#warning","ice-connectivity-lost"),s.emit("warning","ice-connectivity-lost"),s._onMediaFailure(k.MediaFailure.ConnectionDisconnected)},s._mediaHandler.onfailed=function(A){s._onMediaFailure(k.MediaFailure.ConnectionFailed)},s._mediaHandler.onconnected=function(){s._status===k.State.Reconnecting&&s._onMediaReconnected()},s._mediaHandler.onreconnected=function(A){s._log.info(A),s._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{message:A},s),s._log.debug("#warning-cleared","ice-connectivity-lost"),s.emit("warning-cleared","ice-connectivity-lost"),s._onMediaReconnected()},s._mediaHandler.onerror=function(A){A.disconnect===!0&&s._disconnect(A.info&&A.info.message);var x=A.info.twilioError||new i.GeneralErrors.UnknownError(A.info.message);s._log.error("Received an error from MediaStream:",A),s._log.debug("#error",x),s.emit("error",x)},s._mediaHandler.onopen=function(){s._status===k.State.Open||s._status===k.State.Reconnecting||(s._status===k.State.Ringing||s._status===k.State.Connecting?(s.mute(s._mediaHandler.isMuted),s._mediaStatus=k.State.Open,s._maybeTransitionToOpen()):s._mediaHandler.close())},s._mediaHandler.onclose=function(){s._status=k.State.Closed,s._options.shouldPlayDisconnect&&s._options.shouldPlayDisconnect()&&!s._isCancelled&&!s._isRejected&&s._soundcache.get(o.default.SoundName.Disconnect).play(),j.disable(),s._publishMetrics(),!s._isCancelled&&!s._isRejected&&(s._log.debug("#disconnect"),s.emit("disconnect",s))},s._pstream=C.pstream,s._pstream.on("ack",s._onAck),s._pstream.on("cancel",s._onCancel),s._pstream.on("error",s._onSignalingError),s._pstream.on("ringing",s._onRinging),s._pstream.on("transportClose",s._onTransportClose),s._pstream.on("connected",s._onConnected),s._pstream.on("message",s._onMessageReceived),s.on("error",function(A){s._publisher.error("connection","error",{code:A.code,message:A.message},s),s._pstream&&s._pstream.status==="disconnected"&&s._cleanupEventListeners()}),s.on("disconnect",function(){s._cleanupEventListeners()}),s}return Object.defineProperty(k.prototype,"direction",{get:function(){return this._direction},enumerable:!1,configurable:!0}),Object.defineProperty(k.prototype,"codec",{get:function(){return this._codec},enumerable:!1,configurable:!0}),k.prototype._setInputTracksFromStream=function(C){return this._mediaHandler.setInputTracksFromStream(C)},k.prototype._setSinkIds=function(C){return this._mediaHandler._setSinkIds(C)},k.prototype.accept=function(C){var P=this;if(this._status===k.State.Pending){this._log.debug(".accept",C),C=C||{};var s=C.rtcConfiguration||this._options.rtcConfiguration,M=C.rtcConstraints||this._options.rtcConstraints||{},I={audio:typeof M.audio<"u"?M.audio:!0};this._status=k.State.Connecting;var j=function(){if(P._status!==k.State.Connecting){P._cleanupEventListeners(),P._mediaHandler.close();return}var R=function(G,H){var Y=P._direction===k.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote";P._publisher.info("connection",Y,null,P),typeof H=="string"&&(P._signalingReconnectToken=H);var J=d.getPreferredCodecInfo(P._mediaHandler.version.getSDP()),ne=J.codecName,le=J.codecParams;P._publisher.info("settings","codec",{codec_params:le,selected_codec:ne},P),P._monitor.enable(G)},O=typeof P._options.getSinkIds=="function"&&P._options.getSinkIds();if(Array.isArray(O)&&P._mediaHandler._setSinkIds(O).catch(function(){}),P._pstream.addListener("hangup",P._onHangup),P._direction===k.CallDirection.Incoming)P._isAnswered=!0,P._pstream.on("answer",P._onAnswer),P._mediaHandler.answerIncomingCall(P.parameters.CallSid,P._options.offerSdp,s,R);else{var F=Array.from(P.customParameters.entries()).map(function(G){return encodeURIComponent(G[0])+"="+encodeURIComponent(G[1])}).join("&");P._pstream.on("answer",P._onAnswer),P._mediaHandler.makeOutgoingCall(P._pstream.token,F,P.outboundConnectionId,s,R)}};this._options.beforeAccept&&this._options.beforeAccept(this);var A=typeof this._options.getInputStream=="function"&&this._options.getInputStream(),x=A?this._mediaHandler.setInputTracksFromStream(A):this._mediaHandler.openDefaultDeviceWithConstraints(I);x.then(function(){P._publisher.info("get-user-media","succeeded",{data:{audioConstraints:I}},P),j()},function(R){var O;R.code===31208||["PermissionDeniedError","NotAllowedError"].indexOf(R.name)!==-1?(O=new i.UserMediaErrors.PermissionDeniedError,P._publisher.error("get-user-media","denied",{data:{audioConstraints:I,error:R}},P)):(O=new i.UserMediaErrors.AcquisitionFailedError,P._publisher.error("get-user-media","failed",{data:{audioConstraints:I,error:R}},P)),P._disconnect(),P._log.debug("#error",R),P.emit("error",O)})}},k.prototype.disconnect=function(){this._log.debug(".disconnect"),this._disconnect()},k.prototype.getLocalStream=function(){return this._mediaHandler&&this._mediaHandler.stream},k.prototype.getRemoteStream=function(){return this._mediaHandler&&this._mediaHandler._remoteStream},k.prototype.ignore=function(){this._status===k.State.Pending&&(this._log.debug(".ignore"),this._status=k.State.Closed,this._mediaHandler.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this),this._onIgnore&&this._onIgnore())},k.prototype.isMuted=function(){return this._mediaHandler.isMuted},k.prototype.mute=function(C){C===void 0&&(C=!0),this._log.debug(".mute",C);var P=this._mediaHandler.isMuted;this._mediaHandler.mute(C);var s=this._mediaHandler.isMuted;P!==s&&(this._publisher.info("connection",s?"muted":"unmuted",null,this),this._log.debug("#mute",s),this.emit("mute",s,this))},k.prototype.postFeedback=function(C,P){if(typeof C>"u"||C===null)return this._postFeedbackDeclined();if(!Object.values(k.FeedbackScore).includes(C))throw new i.InvalidArgumentError("Feedback score must be one of: "+Object.values(k.FeedbackScore));if(typeof P<"u"&&P!==null&&!Object.values(k.FeedbackIssue).includes(P))throw new i.InvalidArgumentError("Feedback issue must be one of: "+Object.values(k.FeedbackIssue));return this._publisher.info("feedback","received",{issue_name:P,quality_score:C},this,!0)},k.prototype.reject=function(){this._status===k.State.Pending&&(this._log.debug(".reject"),this._isRejected=!0,this._pstream.reject(this.parameters.CallSid),this._mediaHandler.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this),this._cleanupEventListeners(),this._mediaHandler.close(),this._status=k.State.Closed,this._log.debug("#reject"),this.emit("reject"))},k.prototype.sendDigits=function(C){var P=this;if(this._log.debug(".sendDigits",C),C.match(/[^0-9*#w]/))throw new i.InvalidArgumentError("Illegal character passed into sendDigits");var s=this._options.customSounds||{},M=[];C.split("").forEach(function(R){var O=R!=="w"?"dtmf"+R:"";O==="dtmf*"&&(O="dtmfs"),O==="dtmf#"&&(O="dtmfh"),M.push(O)});var I=function(){var R=M.shift();R&&(P._options.dialtonePlayer&&!s[R]?P._options.dialtonePlayer.play(R):P._soundcache.get(R).play()),M.length&&setTimeout(function(){return I()},200)};I();var j=this._mediaHandler.getOrCreateDTMFSender();function A(R){if(R.length){var O=R.shift();O&&O.length&&j.insertDTMF(O,b,w),setTimeout(A.bind(null,R),v)}}if(j){if(!("canInsertDTMF"in j)||j.canInsertDTMF){this._log.info("Sending digits using RTCDTMFSender"),A(C.split("w"));return}this._log.info("RTCDTMFSender cannot insert DTMF")}if(this._log.info("Sending digits over PStream"),this._pstream!==null&&this._pstream.status!=="disconnected")this._pstream.dtmf(this.parameters.CallSid,C);else{var x=new i.GeneralErrors.ConnectionError("Could not send DTMF: Signaling channel is disconnected");this._log.debug("#error",x),this.emit("error",x)}},k.prototype.sendMessage=function(C){this._log.debug(".sendMessage",JSON.stringify(C));var P=C.content,s=C.contentType,M=C.messageType;if(typeof P>"u"||P===null)throw new i.InvalidArgumentError("`content` is empty");if(typeof M!="string")throw new i.InvalidArgumentError("`messageType` must be an enumeration value of `Call.MessageType` or a string.");if(M.length===0)throw new i.InvalidArgumentError("`messageType` must be a non-empty string.");if(this._pstream===null)throw new i.InvalidStateError("Could not send CallMessage; Signaling channel is disconnected");var I=this.parameters.CallSid;if(typeof this.parameters.CallSid>"u")throw new i.InvalidStateError("Could not send CallMessage; Call has no CallSid");var j=this._voiceEventSidGenerator();return this._messages.set(j,{content:P,contentType:s,messageType:M,voiceEventSid:j}),this._pstream.sendMessage(I,P,s,M,j),j},k.prototype.status=function(){return this._status},k.prototype._checkVolume=function(C,P,s,M){var I=P>=10,j=0;return s===C&&(j=P),j>=10?this._emitWarning("audio-level-","constant-audio-"+M+"-level",10,j,!1):I&&this._emitWarning("audio-level-","constant-audio-"+M+"-level",10,j,!0),j},k.prototype._cleanupEventListeners=function(){var C=this,P=function(){C._pstream&&(C._pstream.removeListener("ack",C._onAck),C._pstream.removeListener("answer",C._onAnswer),C._pstream.removeListener("cancel",C._onCancel),C._pstream.removeListener("error",C._onSignalingError),C._pstream.removeListener("hangup",C._onHangup),C._pstream.removeListener("ringing",C._onRinging),C._pstream.removeListener("transportClose",C._onTransportClose),C._pstream.removeListener("connected",C._onConnected),C._pstream.removeListener("message",C._onMessageReceived))};P(),setTimeout(P,0)},k.prototype._createMetricPayload=function(){var C={call_sid:this.parameters.CallSid,dscp:!!this._options.dscp,sdk_version:m.RELEASE_VERSION};return this._options.gateway&&(C.gateway=this._options.gateway),C.direction=this._direction,C},k.prototype._disconnect=function(C,P){if(C=typeof C=="string"?C:null,!(this._status!==k.State.Open&&this._status!==k.State.Connecting&&this._status!==k.State.Reconnecting&&this._status!==k.State.Ringing)){if(this._log.info("Disconnecting..."),this._pstream!==null&&this._pstream.status!=="disconnected"&&this._shouldSendHangup){var s=this.parameters.CallSid||this.outboundConnectionId;s&&this._pstream.hangup(s,C)}this._cleanupEventListeners(),this._mediaHandler.close(),P||this._publisher.info("connection","disconnected-by-local",null,this)}},k.prototype._maybeTransitionToOpen=function(){this._wasConnected,this._isAnswered&&(this._onSignalingReconnected(),this._signalingStatus=k.State.Open,this._mediaHandler&&this._mediaHandler.status==="open"&&(this._status=k.State.Open,this._wasConnected||(this._wasConnected=!0,this._log.debug("#accept"),this.emit("accept",this))))},k.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)},k.prototype._publishMetrics=function(){var C=this;this._metricsSamples.length!==0&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this).catch(function(P){C._log.warn("Unable to post metrics to Insights. Received error:",P)})},k.prototype._setCallSid=function(C){var P=C.callsid;P&&(this.parameters.CallSid=P,this._mediaHandler.callSid=P)},k.toString=function(){return"[Twilio.Call class]"},k}(e.EventEmitter);(function(U){(function(k){k.Closed="closed",k.Connecting="connecting",k.Open="open",k.Pending="pending",k.Reconnecting="reconnecting",k.Ringing="ringing"})(U.State||(U.State={})),function(k){k.AudioLatency="audio-latency",k.ChoppyAudio="choppy-audio",k.DroppedCall="dropped-call",k.Echo="echo",k.NoisyCall="noisy-call",k.OneWayAudio="one-way-audio"}(U.FeedbackIssue||(U.FeedbackIssue={})),function(k){k[k.One=1]="One",k[k.Two=2]="Two",k[k.Three=3]="Three",k[k.Four=4]="Four",k[k.Five=5]="Five"}(U.FeedbackScore||(U.FeedbackScore={})),function(k){k.Incoming="INCOMING",k.Outgoing="OUTGOING"}(U.CallDirection||(U.CallDirection={})),function(k){k.Opus="opus",k.PCMU="pcmu"}(U.Codec||(U.Codec={})),function(k){k.None="none",k.Timeout="timeout"}(U.IceGatheringFailureReason||(U.IceGatheringFailureReason={})),function(k){k.ConnectionDisconnected="ConnectionDisconnected",k.ConnectionFailed="ConnectionFailed",k.IceGatheringFailed="IceGatheringFailed",k.LowBytes="LowBytes"}(U.MediaFailure||(U.MediaFailure={})),function(k){k.UserDefinedMessage="user-defined-message"}(U.MessageType||(U.MessageType={}))})(h||(h={}));function L(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(U){var k=Math.random()*16|0,C=U==="x"?k:k&3|8;return C.toString(16)})}return Ne.default=h,Ne}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TwilioError=t.Logger=t.PreflightTest=t.Device=t.Call=void 0;var n=Nt();t.Call=n.default;var e=nt();t.Device=e.default;var r=oe;t.TwilioError=r;var o=se;Object.defineProperty(t,"Logger",{enumerable:!0,get:function(){return o.Logger}});var i=Vn();Object.defineProperty(t,"PreflightTest",{enumerable:!0,get:function(){return i.PreflightTest}})})(yn);const es={class:"flex flex-row-reverse items-center gap-1"},ts={class:"flex flex-col items-center justify-center gap-3"},ns={class:"flex flex-col items-center justify-center gap-1"},rs={class:"text-xl font-medium"},is={class:"text-sm text-gray-600"},os={key:0,class:"my-1 text-base"},as={key:0,class:"my-1 text-base"},ss={key:1,class:"flex gap-2"},cs={key:2},us={key:3,class:"flex gap-2"},ls={class:"flex items-center gap-2"},ds={class:"max-w-[120px] truncate"},fs={key:0,class:"flex items-center gap-2"},ps={class:"my-1 min-w-[40px] text-center"},hs={key:1,class:"flex items-center gap-3"},vs={class:"my-1"},ms={key:2,class:"flex items-center gap-2"},_s={__name:"CallUI",setup(t){const{getContact:n,getLeadContact:e}=Ir(),{setMakeCall:r,setTwilioEnabled:o}=mr();let i="",c=ee("Connecting..."),a=null;const p=ee({full_name:"",mobile_no:""});let d=ee(!1),f=ee(!1),u=ee(!1),l=ee(!1),m=ee(!1),E=ee(null),w=ee(null),v=ee("");const b=ee(!1),g=ee({title:"",content:""});async function T(R,O=!1){g.value=R,O&&R.name&&await Ue("crm.integrations.twilio.api.add_note_to_call_log",{call_sid:a.parameters.CallSid,note:R.name})}const{width:_,height:y}=Cr();let{style:S}=Tr(E,{initialValue:{x:_.value-280,y:y.value-310},preventDefault:!0});async function D(){return await Ue("crm.integrations.twilio.api.is_enabled")}async function h(){c.value="Requesting Access Token...";try{const R=await Ue("crm.integrations.twilio.api.generate_access_token");c.value="Got a token.",L(R.token)}catch(R){c.value="An error occurred. "+R.message}}function L(R){i=new yn.Device(R,{codecPreferences:["opus","pcmu"],fakeLocalDTMF:!0,enableRingingState:!0}),U(),i.register()}function U(){i.on("registered",()=>{c.value="Ready to make and receive calls!"}),i.on("unregistered",R=>{c.value="Logged out"}),i.on("error",R=>{c.value="Twilio.Device Error: "+R.message}),i.on("incoming",C),i.on("tokenWillExpire",async()=>{const R=await Ue("crm.integrations.twilio.api.generate_access_token");i.updateToken(R.token)})}function k(){a.isMuted()?(a.mute(!1),m.value=!1):(a.mute(),m.value=!0)}function C(R){c.value=`Incoming call from ${R.parameters.From}`,p.value=n(R.parameters.From),p.value||(p.value=e(R.parameters.From)),p.value||(p.value={full_name:__("Unknown"),mobile_no:R.parameters.From}),d.value=!0,a=R,a.on("accept",O=>{console.log("conn",O)}),R.on("cancel",I),R.on("disconnect",I),R.on("reject",I)}async function P(){c.value="Accepted incoming call.",u.value=!0,await a.accept(),w.value.start()}function s(){a.reject(),c.value="Rejected incoming call",d.value=!1,f.value==null?f=!1:f.value=!1,v.value="",m.value=!1}function M(){a.disconnect(),c.value="Hanging up incoming call",u.value=!1,v.value="",m.value=!1,g.value={title:"",content:""},w.value.stop()}function I(){c.value="Call ended from handle disconnected Incoming call.",d.value=!1,f.value==null?f=!1:f.value=!1,a=null,m.value=!1,u.value=!1,w.value.stop()}async function j(R){if(p.value=n(R),p.value||(p.value=e(R)),i){c.value=`Attempting to call ${R} ...`;try{a=await i.connect({params:{To:R}}),d.value=!0,v.value="initiating",a.on("messageReceived",O=>{let F=O.content;v.value=F.CallStatus,c.value=`Call status: ${F.CallStatus}`,F.CallStatus=="in-progress"&&(c.value="Call in progress.",l.value=!1,u.value=!0,w.value.start())}),a.on("accept",()=>{c.value="Initiated call!",d.value=!0,l.value=!0,u.value=!1}),a.on("disconnect",O=>{c.value="Call ended from makeOutgoing call disconnect.",l.value=!1,u.value=!1,d.value=!1,f=!1,a=null,v.value="",m.value=!1,w.value.stop(),g.value={title:"",content:""}}),a.on("cancel",()=>{c.value="Call ended from makeOutgoing call cancel.",l.value=!1,u.value=!1,d.value=!1,f=!1,a=null,v.value="",m.value=!1,g.value={title:"",content:""},w.value.stop()})}catch(O){c.value=`Could not connect call: ${O.message}`}}else c.value="Unable to make call."}function A(){a.disconnect(),d.value=!1,f.value==null?f=!1:f.value=!1,l.value=!1,u.value=!1,v.value="",m.value=!1,g.value={title:"",content:""}}function x(){d.value=!d.value,f.value==null?f=!f:f.value=!f.value}return fn(async()=>{let R=await D();o(R),R&&h(),r(j)}),dr(()=>c.value,R=>{console.log(R)},{immediate:!0}),(R,O)=>{var G;const F=Te("Button");return z(),Z(Me,null,[Bt(V("div",pr(hr(R.$attrs)),[V("div",{ref_key:"callPopup",ref:E,class:"fixed z-20 flex w-60 cursor-move select-none flex-col rounded-lg bg-gray-900 p-4 text-gray-300 shadow-2xl",style:fr(q(S))},[V("div",es,[$(Ci,{class:"h-4 w-4 cursor-pointer",onClick:x})]),V("div",ts,[$(q(ze),{image:p.value.image,label:p.value.full_name,class:ye(["relative flex !h-24 !w-24 items-center justify-center [&>div]:text-[30px]",q(u)||q(l)?"":"pulse"])},null,8,["image","label","class"]),V("div",ns,[V("div",rs,ae(p.value.full_name),1),V("div",is,ae(p.value.mobile_no),1)]),$(Ti,{ref_key:"counterUp",ref:w},{default:re(()=>{var H;return[q(u)?(z(),Z("div",os,ae((H=q(w))==null?void 0:H.updatedTime),1)):pe("",!0)]}),_:1},512),q(u)?pe("",!0):(z(),Z("div",as,ae(q(v)=="initiating"?R.__("Initiating call..."):q(v)=="ringing"?R.__("Ringing..."):q(l)?R.__("Calling..."):R.__("Incoming call...")),1)),q(u)?(z(),Z("div",ss,[$(F,{icon:q(m)?"mic-off":"mic",class:"rounded-full",onClick:k},null,8,["icon"]),$(F,{class:"rounded-full"},{icon:re(()=>[$(Er,{class:"h-4 w-4 cursor-pointer rounded-full text-gray-900",onClick:O[0]||(O[0]=H=>b.value=!0)})]),_:1}),$(F,{class:"rounded-full bg-red-600 hover:bg-red-700"},{icon:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white text-white",onClick:M})]),_:1})])):q(l)||q(v)=="initiating"?(z(),Z("div",cs,[$(F,{size:"md",variant:"solid",theme:"red",label:R.__("Cancel"),onClick:A,class:"rounded-lg",disabled:q(v)=="initiating"},{prefix:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white"})]),_:1},8,["label","disabled"])])):(z(),Z("div",us,[$(F,{size:"md",variant:"solid",theme:"green",label:R.__("Accept"),class:"rounded-lg",onClick:P},{prefix:re(()=>[$(ge,{class:"h-4 w-4 fill-white"})]),_:1},8,["label"]),$(F,{size:"md",variant:"solid",theme:"red",label:R.__("Reject"),class:"rounded-lg",onClick:s},{prefix:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white"})]),_:1},8,["label"])]))])],4)],16),[[Vt,q(d)]]),Bt(V("div",mn({class:"ml-2 flex cursor-pointer select-none items-center justify-between gap-3 rounded-lg bg-gray-900 px-2 py-[7px] text-base text-gray-300",onClick:x},R.$attrs),[V("div",ls,[$(q(ze),{image:p.value.image,label:p.value.full_name,class:"relative flex !h-5 !w-5 items-center justify-center"},null,8,["image","label"]),V("div",ds,ae(p.value.full_name),1)]),q(u)?(z(),Z("div",fs,[V("div",ps,ae((G=q(w))==null?void 0:G.updatedTime),1),$(F,{variant:"solid",theme:"red",class:"!h-6 !w-6 rounded-full"},{icon:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white",onClick:je(M,["stop"])})]),_:1})])):q(l)?(z(),Z("div",hs,[V("div",vs,ae(q(v)=="ringing"?R.__("Ringing..."):R.__("Calling...")),1),$(F,{variant:"solid",theme:"red",class:"!h-6 !w-6 rounded-full",onClick:je(A,["stop"])},{icon:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white"})]),_:1})])):(z(),Z("div",ms,[$(F,{variant:"solid",theme:"green",class:"pulse relative !h-6 !w-6 rounded-full",onClick:je(P,["stop"])},{icon:re(()=>[$(ge,{class:"h-4 w-4 animate-pulse fill-white"})]),_:1}),$(F,{variant:"solid",theme:"red",class:"!h-6 !w-6 rounded-full",onClick:je(s,["stop"])},{icon:re(()=>[$(ge,{class:"h-4 w-4 rotate-[135deg] fill-white"})]),_:1})]))],16),[[Vt,q(f)]]),$(Pr,{modelValue:b.value,"onUpdate:modelValue":O[1]||(O[1]=H=>b.value=H),note:g.value,doctype:"CRM Call Log",onAfter:T},null,8,["modelValue","note"])],64)}}},xs=mt(_s,[["__scopeId","data-v-fc76d02b"]]);export{xs as C,As as _,oi as a};
//# sourceMappingURL=CallUI-6bc1ab54.js.map
