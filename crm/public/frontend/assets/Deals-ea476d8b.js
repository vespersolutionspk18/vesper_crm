import{m as pe,q as ue,h as ee,v as me,k as y,y as re,x as te,i as F,a as fe,r as $,b as l,g as k,w as h,e as m,t as C,u as w,d as c,l as b,z as ve,A as ge,c as v,F as be,n as ae,p as ye,B as j}from"./index-9a3d44ca.js";import{s as ie,_ as ke}from"./statuses-c18f787a.js";import{_ as xe}from"./CustomActions-dd6491ed.js";import{E as he,C as Ce}from"./CommentIcon-8a1c544e.js";import{P as we}from"./PhoneIcon-2b0b9034.js";import{_ as Ve,N as se}from"./NoteModal-67a2219e.js";import{T as oe}from"./TaskIcon-ba34b83b.js";import{I as H}from"./IndicatorIcon-8bdc1dd8.js";import{D as De}from"./DealsIcon-3bb51480.js";import{_ as Ee,a as Me}from"./LayoutHeader-f400e0a9.js";import{_ as ze}from"./DealsListView-c0ffb5e0.js";import{_ as $e}from"./KanbanView-ad95323d.js";import{E as Ue}from"./EditIcon-5c615a04.js";import{F as Se}from"./Fields-bccd83f4.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-edf4e043.js";import{T as Ie}from"./TaskModal-74495bbe.js";import{_ as Re}from"./QuickEntryModal-95813af5.js";import{_ as Ae}from"./ViewControls-4002c267.js";import{g as Te,b as P,_ as ne}from"./global-005ed632.js";import{o as Oe}from"./organizations-345b05ec.js";import{c as qe}from"./settings-5e848745.js";import{b as Le,t as X,d as Y,f as Be,a as Z}from"./index-23e032df.js";import{D as je}from"./Dropdown-d1bc143c.js";import"./ArrowUpRightIcon-4de3e6ce.js";import"./Link-b1fdcf99.js";import"./ListBulkActions-9fa5be79.js";import"./NestedPopover-767b5999.js";import"./AssignmentModal-b9aa1b53.js";import"./ListRows-bf71bc40.js";import"./ListFooter-3ed6863c.js";import"./label-c0466358.js";import"./DragVerticalIcon-21aa16a4.js";import"./DetailsIcon-e1b98c12.js";import"./views-43c0d23f.js";import"./FadedScrollableDiv-3ad27946.js";const Pe={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Qe={class:"mb-5 flex items-center justify-between"},Ke={class:"text-2xl font-semibold leading-6 text-gray-900"},We={class:"flex items-center gap-1"},Ge={class:"mb-4 grid grid-cols-1 gap-4 sm:grid-cols-3"},Je={class:"flex items-center gap-3 text-sm text-gray-600"},He={class:"flex items-center gap-3 text-sm text-gray-600"},Xe={class:"px-4 pb-7 pt-4 sm:px-6"},Ye={class:"flex flex-row-reverse gap-2"},Ze={__name:"DealModal",props:pe({defaults:Object},{modelValue:{},modelModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:quickEntry"],setup(q){const Q=q,{getUser:K,isManager:U}=ue(),{getDealStatus:W,statusOptions:L}=ie(),E=ee(q,"modelValue"),A=me(),g=y(null),r=re({organization:"",organization_name:"",website:"",no_of_employees:"",territory:"",annual_revenue:"",industry:"",contact:"",salutation:"",first_name:"",last_name:"",email:"",mobile_no:"",gender:"",status:"",deal_owner:""}),M=y(!1),i=y(!1),z=y(!1),T=te({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","CRM Deal"],params:{doctype:"CRM Deal",type:"Quick Entry"},auto:!0,transform:d=>d.forEach(f=>{f.fields.forEach(p=>{p.name=="status"?(p.type="Select",p.options=V.value,p.prefix=W(r.status).iconColorClass):p.name=="deal_owner"&&(p.type="User")})})}),S=F(()=>{let d=T.data||[];if(!d.length)return[];let f=[];return z.value?f.push(d.find(p=>p.label==="Select Organization")):f.push(d.find(p=>p.label==="Organization Details")),i.value?f.push(d.find(p=>p.label==="Select Contact")):f.push(d.find(p=>p.label==="Contact Details")),d.forEach(p=>{["Select Organization","Organization Details","Select Contact","Contact Details"].includes(p.label)||f.push(p)}),f}),V=F(()=>{let d=L("deal");return r.status||(r.status=d[0].value),d});function o(){r.website&&!r.website.startsWith("http")&&(r.website="https://"+r.website),te({url:"crm.fcrm.doctype.crm_deal.crm_deal.create_deal",params:{args:r},auto:!0,validate(){if(g.value=null,r.annual_revenue&&(r.annual_revenue=r.annual_revenue.replace(/,/g,""),isNaN(r.annual_revenue)))return g.value=__("Annual Revenue should be a number"),g.value;if(r.mobile_no&&isNaN(r.mobile_no.replace(/[-+() ]/g,"")))return g.value=__("Mobile No should be a number"),g.value;if(r.email&&!r.email.includes("@"))return g.value=__("Invalid Email"),g.value;if(!r.status)return g.value=__("Status is required"),g.value;M.value=!0},onSuccess(d){M.value=!1,E.value=!1,A.push({name:"Deal",params:{dealId:d}})},onError(d){if(M.value=!1,!d.messages){g.value=d.message;return}g.value=d.messages.join(`
`)}})}const O=ee(q,"quickEntry");function G(){O.value=!0,ve(()=>{E.value=!1})}return fe(()=>{Object.assign(r,Q.defaults),r.deal_owner||(r.deal_owner=K().name)}),(d,f)=>{const p=$("Button"),J=$("FeatherIcon"),I=$("ErrorMessage"),R=$("Dialog");return l(),k(R,{modelValue:E.value,"onUpdate:modelValue":f[3]||(f[3]=D=>E.value=D),options:{size:"3xl"}},{body:h(()=>[m("div",Pe,[m("div",Qe,[m("div",null,[m("h3",Ke,C(d.__("Create Deal")),1)]),m("div",We,[w(U)()?(l(),k(p,{key:0,variant:"ghost",class:"w-7",onClick:G},{default:h(()=>[c(Ue,{class:"h-4 w-4"})]),_:1})):b("",!0),c(p,{variant:"ghost",class:"w-7",onClick:f[0]||(f[0]=D=>E.value=!1)},{default:h(()=>[c(J,{name:"x",class:"h-4 w-4"})]),_:1})])]),m("div",null,[m("div",Ge,[m("div",Je,[m("div",null,C(d.__("Choose Existing Organization")),1),c(w(le),{modelValue:z.value,"onUpdate:modelValue":f[1]||(f[1]=D=>z.value=D)},null,8,["modelValue"])]),m("div",He,[m("div",null,C(d.__("Choose Existing Contact")),1),c(w(le),{modelValue:i.value,"onUpdate:modelValue":f[2]||(f[2]=D=>i.value=D)},null,8,["modelValue"])])]),S.value?(l(),k(Se,{key:0,class:"border-t pt-4",sections:S.value,data:r},null,8,["sections","data"])):b("",!0),g.value?(l(),k(I,{key:1,class:"mt-4",message:d.__(g.value)},null,8,["message"])):b("",!0)])]),m("div",Xe,[m("div",Ye,[c(p,{variant:"solid",label:d.__("Create"),loading:M.value,onClick:o},null,8,["label","loading"])])])]),_:1},8,["modelValue"])}}},Fe={class:"flex gap-2 items-center"},Ne={key:0},et={key:1},tt={key:2},at={key:3,class:"truncate text-base"},st={key:4,class:"truncate text-base"},ot={key:5,class:"truncate text-base"},lt={key:6,class:"text-gray-500"},nt={key:0,class:"truncate flex items-center gap-2"},ut={key:0},rt={key:1},it={key:2},ct={key:3,class:"truncate text-base"},_t={key:4,class:"truncate text-base"},dt={key:5,class:"flex items-center"},pt={key:6,class:"truncate text-base"},mt={class:"flex gap-2 items-center justify-between"},ft={class:"text-gray-600 flex items-center gap-1.5"},vt={key:0},gt=m("span",{class:"text-3xl leading-[0]"}," · ",-1),bt={key:1},yt=m("span",{class:"text-3xl leading-[0]"}," · ",-1),kt={key:2},xt=m("span",{class:"text-3xl leading-[0]"}," · ",-1),ht={key:3},Ct={key:2,class:"flex h-full items-center justify-center"},wt={class:"flex flex-col items-center gap-3 text-xl font-medium text-gray-500"},na={__name:"Deals",setup(q){const Q=[{label:__("Deals"),route:{name:"Deals"}}],{makeCall:K}=Te(),{getUser:U}=ue(),{getOrganization:W}=Oe(),{getDealStatus:L}=ie(),E=ge(),A=y(null),g=y(!1),r=y(!1),M=re({}),i=y({}),z=y(1),T=y(1),S=y(20),V=y(null);function o(n,t){var s;function u(_){return _&&typeof _=="object"&&!Array.isArray(_)?_:{label:_}}return u((s=O.value)==null?void 0:s.find(_=>_.name==n)[t])}const O=F(()=>{var n,t,u,s,_,e,a;return(t=(n=i.value)==null?void 0:n.data)!=null&&t.data?i.value.data.view_type==="group_by"?(s=(u=i.value)==null?void 0:u.data.group_by_field)!=null&&s.name?G((_=i.value)==null?void 0:_.data.data,(e=i.value)==null?void 0:e.data.group_by_field):[]:i.value.data.view_type==="kanban"?d(i.value.data.data):f((a=i.value)==null?void 0:a.data.data):[]});function G(n,t){var s;let u=[];return(s=t.options)==null||s.forEach(_=>{let e=[];_?e=n.filter(x=>x[t.name]==_):e=n.filter(x=>!x[t.name]);let a={label:t.label,group:_||__(" "),collapsed:!1,rows:f(e)};t.name=="status"&&(a.icon=()=>{var x;return j(H,{class:(x=L(_))==null?void 0:x.iconColorClass})}),u.push(a)}),u||n}function d(n){let t=[];return n.forEach(u=>{var s;(s=u.data)==null||s.forEach(_=>{t.push(_)})}),f(t)}function f(n){return n.map(t=>{let u={};return i.value.data.rows.forEach(s=>{var _,e;if(u[s]=t[s],s=="organization")u[s]={label:t.organization,logo:(_=W(t.organization))==null?void 0:_.organization_logo};else if(s=="annual_revenue")u[s]=Le(t.annual_revenue,t.currency);else if(s=="status")u[s]={label:t.status,color:(e=L(t.status))==null?void 0:e.iconColorClass};else if(s=="sla_status"){let a=t.sla_status,x=a,N=t.sla_status=="Failed"?"red":t.sla_status=="Fulfilled"?"green":"orange";a=="First Response Due"&&(a=__(X(t.response_by)),x=Y(t.response_by,Z),new Date(t.response_by)<new Date&&(N="red")),u[s]={label:x,value:a,color:N}}else if(s=="deal_owner")u[s]={label:t.deal_owner&&U(t.deal_owner).full_name,...t.deal_owner&&U(t.deal_owner)};else if(s=="_assign"){let a=JSON.parse(t._assign)||[];!a.length&&t.deal_owner&&(a=[t.deal_owner]),u[s]=a.map(x=>({name:x,image:U(x).user_image,label:U(x).full_name}))}else if(["modified","creation"].includes(s))u[s]={label:Y(t[s],Z),timeAgo:__(X(t[s]))};else if(["first_response_time","first_responded_on","response_by"].includes(s)){let a=s=="response_by"?"response_by":"first_responded_on";u[s]={label:t[a]?Y(t[a],Z):"",timeAgo:t[s]?s=="first_response_time"?Be(t[s]):__(X(t[s])):""}}}),u._email_count=t._email_count,u._note_count=t._note_count,u._task_count=t._task_count,u._comment_count=t._comment_count,u})}function p(n){let t=i.value.params.column_field;t&&(M[t]=n.column.name),g.value=!0}function J(n){var s;let t=((s=o(n,"mobile_no"))==null?void 0:s.label)||"";return[{icon:j(we,{class:"h-4 w-4"}),label:__("Make a Call"),onClick:()=>K(t),condition:()=>t&&qe.value},{icon:j(se,{class:"h-4 w-4"}),label:__("New Note"),onClick:()=>ce(n)},{icon:j(oe,{class:"h-4 w-4"}),label:__("New Task"),onClick:()=>de(n)}].filter(_=>_.condition?_.condition():!0)}const I=y(""),R=y(!1),D=y({title:"",content:""});function ce(n){I.value=n,R.value=!0}const B=y(!1),_e=y({title:"",description:"",assigned_to:"",due_date:"",priority:"Low",status:"Backlog"});function de(n){I.value=n,B.value=!0}return(n,t)=>{const u=$("FeatherIcon"),s=$("Button"),_=$("Badge");return l(),v(be,null,[c(Ee,null,{"left-header":h(()=>[c(w(Me),{items:Q})]),"right-header":h(()=>{var e;return[(e=A.value)!=null&&e.customListActions?(l(),k(xe,{key:0,actions:A.value.customListActions},null,8,["actions"])):b("",!0),c(s,{variant:"solid",label:n.__("Create"),onClick:t[0]||(t[0]=a=>g.value=!0)},{prefix:h(()=>[c(u,{name:"plus",class:"h-4"})]),_:1},8,["label"])]}),_:1}),c(Ae,{ref_key:"viewControls",ref:V,modelValue:i.value,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value=e),loadMore:z.value,"onUpdate:loadMore":t[2]||(t[2]=e=>z.value=e),resizeColumn:T.value,"onUpdate:resizeColumn":t[3]||(t[3]=e=>T.value=e),updatedPageCount:S.value,"onUpdate:updatedPageCount":t[4]||(t[4]=e=>S.value=e),doctype:"CRM Deal",options:{allowedViews:["list","group_by","kanban"]}},null,8,["modelValue","loadMore","resizeColumn","updatedPageCount"]),w(E).params.viewType=="kanban"?(l(),k($e,{key:0,modelValue:i.value,"onUpdate:modelValue":t[6]||(t[6]=e=>i.value=e),options:{getRoute:e=>({name:"Deal",params:{dealId:e.name}}),onNewClick:e=>p(e)},onUpdate:t[7]||(t[7]=e=>V.value.updateKanbanSettings(e)),onLoadMore:t[8]||(t[8]=e=>V.value.loadMoreKanban(e))},{title:h(({titleField:e,itemName:a})=>[m("div",Fe,[e==="status"?(l(),v("div",Ne,[c(H,{class:ae(o(a,e).color)},null,8,["class"])])):e==="organization"&&o(a,e).label?(l(),v("div",et,[c(w(P),{class:"flex items-center",image:o(a,e).logo,label:o(a,e).label,size:"sm"},null,8,["image","label"])])):e==="deal_owner"&&o(a,e).full_name?(l(),v("div",tt,[c(w(P),{class:"flex items-center",image:o(a,e).user_image,label:o(a,e).full_name,size:"sm"},null,8,["image","label"])])):b("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),v("div",at,[c(w(ne),{text:o(a,e).label},{default:h(()=>[m("div",null,C(o(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),v("div",st,[o(a,e).value?(l(),k(_,{key:0,variant:"subtle",theme:o(a,e).color,size:"md",label:o(a,e).value},null,8,["theme","label"])):b("",!0)])):o(a,e).label?(l(),v("div",ot,C(o(a,e).label),1)):(l(),v("div",lt,C(n.__("No Title")),1))])]),fields:h(({fieldName:e,itemName:a})=>[o(a,e).label?(l(),v("div",nt,[e==="status"?(l(),v("div",ut,[c(H,{class:ae(o(a,e).color)},null,8,["class"])])):e==="organization"?(l(),v("div",rt,[o(a,e).label?(l(),k(w(P),{key:0,class:"flex items-center",image:o(a,e).logo,label:o(a,e).label,size:"xs"},null,8,["image","label"])):b("",!0)])):e==="deal_owner"?(l(),v("div",it,[o(a,e).full_name?(l(),k(w(P),{key:0,class:"flex items-center",image:o(a,e).user_image,label:o(a,e).full_name,size:"xs"},null,8,["image","label"])):b("",!0)])):b("",!0),["modified","creation","first_response_time","first_responded_on","response_by"].includes(e)?(l(),v("div",ct,[c(w(ne),{text:o(a,e).label},{default:h(()=>[m("div",null,C(o(a,e).timeAgo),1)]),_:2},1032,["text"])])):e==="sla_status"?(l(),v("div",_t,[o(a,e).value?(l(),k(_,{key:0,variant:"subtle",theme:o(a,e).color,size:"md",label:o(a,e).value},null,8,["theme","label"])):b("",!0)])):e==="_assign"?(l(),v("div",dt,[c(ke,{avatars:o(a,e).label,size:"xs"},null,8,["avatars"])])):(l(),v("div",pt,C(o(a,e).label),1))])):b("",!0)]),actions:h(({itemName:e})=>[m("div",mt,[m("div",ft,[c(he,{class:"h-4 w-4"}),o(e,"_email_count").label?(l(),v("span",vt,C(o(e,"_email_count").label),1)):b("",!0),gt,c(se,{class:"h-4 w-4"}),o(e,"_note_count").label?(l(),v("span",bt,C(o(e,"_note_count").label),1)):b("",!0),yt,c(oe,{class:"h-4 w-4"}),o(e,"_task_count").label?(l(),v("span",kt,C(o(e,"_task_count").label),1)):b("",!0),xt,c(Ce,{class:"h-4 w-4"}),o(e,"_comment_count").label?(l(),v("span",ht,C(o(e,"_comment_count").label),1)):b("",!0)]),c(w(je),{class:"flex items-center gap-2",options:J(e),variant:"ghost",onClick:t[5]||(t[5]=ye(()=>{},["stop","prevent"]))},{default:h(()=>[c(s,{icon:"plus",variant:"ghost"})]),_:2},1032,["options"])])]),_:1},8,["modelValue","options"])):i.value.data&&O.value.length?(l(),k(ze,{key:1,ref_key:"dealsListView",ref:A,modelValue:i.value.data.page_length_count,"onUpdate:modelValue":t[9]||(t[9]=e=>i.value.data.page_length_count=e),list:i.value,"onUpdate:list":t[10]||(t[10]=e=>i.value=e),rows:O.value,columns:i.value.data.columns,options:{showTooltip:!1,resizeColumn:!0,rowCount:i.value.data.row_count,totalCount:i.value.data.total_count},onLoadMore:t[11]||(t[11]=()=>z.value++),onColumnWidthUpdated:t[12]||(t[12]=()=>T.value++),onUpdatePageCount:t[13]||(t[13]=e=>S.value=e),onApplyFilter:t[14]||(t[14]=e=>V.value.applyFilter(e)),onApplyLikeFilter:t[15]||(t[15]=e=>V.value.applyLikeFilter(e)),onLikeDoc:t[16]||(t[16]=e=>V.value.likeDoc(e))},null,8,["modelValue","list","rows","columns","options"])):i.value.data?(l(),v("div",Ct,[m("div",wt,[c(De,{class:"h-10 w-10"}),m("span",null,C(n.__("No {0} Found",[n.__("Deals")])),1),c(s,{label:n.__("Create"),onClick:t[17]||(t[17]=e=>g.value=!0)},{prefix:h(()=>[c(u,{name:"plus",class:"h-4"})]),_:1},8,["label"])])])):b("",!0),g.value?(l(),k(Ze,{key:3,modelValue:g.value,"onUpdate:modelValue":t[18]||(t[18]=e=>g.value=e),quickEntry:r.value,"onUpdate:quickEntry":t[19]||(t[19]=e=>r.value=e),defaults:M},null,8,["modelValue","quickEntry","defaults"])):b("",!0),R.value?(l(),k(Ve,{key:4,modelValue:R.value,"onUpdate:modelValue":t[20]||(t[20]=e=>R.value=e),note:D.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","note","doc"])):b("",!0),B.value?(l(),k(Ie,{key:5,modelValue:B.value,"onUpdate:modelValue":t[21]||(t[21]=e=>B.value=e),task:_e.value,doctype:"CRM Deal",doc:I.value},null,8,["modelValue","task","doc"])):b("",!0),r.value?(l(),k(Re,{key:6,modelValue:r.value,"onUpdate:modelValue":t[22]||(t[22]=e=>r.value=e),doctype:"CRM Deal"},null,8,["modelValue"])):b("",!0)],64)}}};export{na as default};
//# sourceMappingURL=Deals-ea476d8b.js.map
