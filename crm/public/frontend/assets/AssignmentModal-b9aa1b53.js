import{m as h,h as k,k as b,q as N,i as U,r as p,b as i,g as _,w as l,d as m,u as g,e as V,t as E,c as I,f as O,p as j,l as w,F as J,I as y}from"./index-9a3d44ca.js";import{a as C,_ as M}from"./global-005ed632.js";import{_ as L}from"./Link-b1fdcf99.js";import{i as q}from"./Dropdown-d1bc143c.js";const P={class:"cursor-pointer"},R={class:"mt-3 flex flex-wrap items-center gap-2"},W={__name:"AssignmentModal",props:h({doc:{type:Object,default:null},docs:{type:Set,default:new Set},doctype:{type:String,default:""}},{modelValue:{},modelModifiers:{},assignees:{},assigneesModifiers:{}}),emits:h(["reload"],["update:modelValue","update:assignees"]),setup(v,{emit:x}){const o=v,A=x,u=k(v,"modelValue"),n=k(v,"assignees"),d=b([]),c=b(""),{getUser:f}=N(),B=e=>{n.value=n.value.filter(t=>t.name!==e)},S=U(()=>o.doc?o.doctype=="CRM Lead"?o.doc.lead_owner:o.doc.deal_owner:""),$=e=>{c.value="";let t={name:e,image:f(e).user_image,label:f(e).full_name};n.value.find(s=>s.name===e)||n.value.push(t)};function z(){if(n.value.length===0){c.value="Please select at least one assignee";return}const e=d.value.filter(s=>!n.value.find(r=>r.name===s.name)).map(s=>s.name),t=n.value.filter(s=>!d.value.find(r=>r.name===s.name)).map(s=>s.name);if(e.length)for(let s of e)y("frappe.desk.form.assign_to.remove",{doctype:o.doctype,name:o.doc.name,assign_to:s});t.length&&(o.docs.size?y("frappe.desk.form.assign_to.add_multiple",{doctype:o.doctype,name:JSON.stringify(Array.from(o.docs)),assign_to:t,bulk_assign:!0,re_assign:!0}).then(()=>{A("reload")}):y("frappe.desk.form.assign_to.add",{doctype:o.doctype,name:o.doc.name,assign_to:t})),u.value=!1}return q(n,e=>{d.value=[...e]}),(e,t)=>{const s=p("FeatherIcon"),r=p("Button"),D=p("ErrorMessage"),F=p("Dialog");return i(),_(F,{modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value=a),options:{title:e.__("Assign To"),size:"xl",actions:[{label:e.__("Cancel"),variant:"subtle",onClick:()=>{n.value=d.value,u.value=!1}},{label:e.__("Update"),variant:"solid",onClick:()=>z()}]}},{"body-content":l(()=>[m(L,{class:"form-control",value:"",doctype:"User",onChange:t[0]||(t[0]=a=>$(a)&&(e.$refs.input.value="")),placeholder:e.__("John Doe"),hideMe:!0},{"item-prefix":l(({option:a})=>[m(C,{class:"mr-2",user:a.value,size:"sm"},null,8,["user"])]),"item-label":l(({option:a})=>[m(g(M),{text:a.value},{default:l(()=>[V("div",P,E(g(f)(a.value).full_name),1)]),_:2},1032,["text"])]),_:1},8,["placeholder"]),V("div",R,[(i(!0),I(J,null,O(n.value,a=>(i(),_(g(M),{text:a.name,key:a.name},{default:l(()=>[m(r,{label:g(f)(a.name).full_name,theme:"gray",variant:"outline"},{prefix:l(()=>[m(C,{user:a.name,size:"sm"},null,8,["user"])]),suffix:l(()=>[a.name!==S.value?(i(),_(s,{key:0,class:"h-3.5",name:"x",onClick:j(T=>B(a.name),["stop"])},null,8,["onClick"])):w("",!0)]),_:2},1032,["label"])]),_:2},1032,["text"]))),128))]),c.value?(i(),_(D,{key:0,class:"mt-2",message:e.__(c.value)},null,8,["message"])):w("",!0)]),_:1},8,["modelValue","options"])}}};export{W as _};
//# sourceMappingURL=AssignmentModal-b9aa1b53.js.map
