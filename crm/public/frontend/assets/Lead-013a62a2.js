import{_ as fe,a as ve,L as ge}from"./SidePanelModal-7abc63d3.js";import{E as be}from"./EditIcon-5c615a04.js";import{A as Ce,a as xe,S as ye,b as we}from"./SLASection-60be6e93.js";import{E as W}from"./EmailIcon-5d882006.js";import{C as he}from"./CommentIcon-8a1c544e.js";import{P as G}from"./PhoneIcon-2b0b9034.js";import{T as ke}from"./TaskIcon-ba34b83b.js";import{N as Ie}from"./NoteModal-67a2219e.js";import{W as Ve}from"./WhatsAppIcon-a922c570.js";import{I as Le}from"./IndicatorIcon-8bdc1dd8.js";import{C as ze}from"./CameraIcon-d076352a.js";import{O as Ue}from"./OrganizationsIcon-f5eb7efc.js";import{C as Ee}from"./ContactsIcon-5941e60f.js";import{_ as $e,a as Ae}from"./LayoutHeader-f400e0a9.js";import{_ as Se}from"./AssignmentModal-b9aa1b53.js";import{s as Ne,_ as Me}from"./statuses-c18f787a.js";import{_ as J}from"./Link-b1fdcf99.js";import{_ as De}from"./Section-e7f6a7fa.js";import{_ as Re}from"./CustomActions-dd6491ed.js";import{c as Te,e as Be,g as y,h as Fe,i as R,o as Oe}from"./index-23e032df.js";import{g as je,b as Pe,_ as $}from"./global-005ed632.js";import{c as qe}from"./contacts-111adff3.js";import{o as We}from"./organizations-345b05ec.js";import{q as Ge,A as Je,v as Ke,x as T,a as He,k as c,i as K,j as Qe,r as A,b as r,c as g,u as a,g as _,w as n,l as f,d as l,F as H,I as B,G as Q,n as X,K as Xe,e as i,t as v,C as Ye,f as Ze,E as ea}from"./index-9a3d44ca.js";import{c as Y,w as aa}from"./settings-5e848745.js";import{D as Z}from"./Dropdown-d1bc143c.js";import{F as ta}from"./FileUploader-e02978ad.js";import{_ as ee}from"./Switch.vue_vue_type_script_setup_true_lang-edf4e043.js";import{_ as oa}from"./Tabs-9ce471e9.js";import"./DragVerticalIcon-21aa16a4.js";import"./FadedScrollableDiv-3ad27946.js";import"./DurationIcon-31a1b254.js";import"./CalendarIcon-e7721136.js";import"./LeadsIcon-6f6c2324.js";import"./DealsIcon-3bb51480.js";import"./EmailTemplateModal-8f279830.js";import"./TaskModal-74495bbe.js";import"./ArrowUpRightIcon-4de3e6ce.js";import"./label-c0466358.js";const sa={key:1,class:"flex h-full overflow-hidden"},la={class:"flex items-center justify-start gap-5 border-b p-5"},na={class:"group relative size-12"},ia={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},da={class:"flex flex-col gap-2.5 truncate"},ra={class:"truncate text-2xl font-medium"},ma={class:"flex gap-1.5"},ua={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ca={class:"flex flex-col overflow-y-auto"},_a={class:"mb-4 flex items-center gap-2 text-gray-600"},pa={class:"block text-base"},fa={class:"ml-6"},va={class:"flex items-center justify-between text-base"},ga={key:1,class:"mt-2.5 text-base"},ba={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Ca={class:"block text-base"},xa={class:"ml-6"},ya={class:"flex items-center justify-between text-base"},wa={key:1,class:"mt-2.5 text-base"},dt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ae){const{$dialog:te,makeCall:oe}=je(),{getContactByName:w,contacts:se}=qe(),{organizations:le}=We(),{statusOptions:ne,getLeadStatus:ie}=Ne(),{isManager:de}=Ge(),F=Je(),S=Ke(),h=ae,t=T({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:h.leadId},cache:["lead",h.leadId],onSuccess:o=>{Te(o),Be(o,{doc:o,$dialog:te,router:S,updateField:b,createToast:y,deleteDoc:ce,call:B})}});He(()=>{t.data||t.fetch()});const N=c(!1),V=c(!1),L=c(!1);function O(o,e,d){e=Array.isArray(o)?"":e,!(!Array.isArray(o)&&re(o,e))&&T({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:h.leadId,fieldname:o,value:e},auto:!0,onSuccess:()=>{t.reload(),N.value=!0,y({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),d==null||d()},onError:u=>{var U;y({title:__("Error updating lead"),text:__((U=u.messages)==null?void 0:U[0]),icon:"x",iconClasses:"text-red-600"})}})}function re(o,e){var u;let d=t.data.fields_meta||{};return(u=d[o])!=null&&u.reqd&&!e?(y({title:__("Error Updating Lead"),text:__("{0} is a required field",[d[o].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const me=K(()=>{let o=[{label:__("Leads"),route:{name:"Leads"}}];return o.push({label:t.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),o}),k=c(0),M=K(()=>[{name:"Activity",label:__("Activity"),icon:Ce},{name:"Emails",label:__("Emails"),icon:W},{name:"Comments",label:__("Comments"),icon:he},{name:"Calls",label:__("Calls"),icon:G,condition:()=>Y.value},{name:"Tasks",label:__("Tasks"),icon:ke},{name:"Notes",label:__("Notes"),icon:Ie},{name:"WhatsApp",label:__("WhatsApp"),icon:Ve,condition:()=>aa.value}].filter(e=>e.condition?e.condition():!0));Qe(M,o=>{if(o&&F.params.tabName){let e=o.findIndex(d=>d.name.toLowerCase()===F.params.tabName.toLowerCase());e!==-1&&(k.value=e)}});function ue(o){let e=o.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const D=T({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",h.leadId],params:{doctype:"CRM Lead",name:h.leadId},auto:!0});function b(o,e,d){O(o,e,()=>{t.data[o]=e,d==null||d()})}async function ce(o){await B("frappe.client.delete",{doctype:"CRM Lead",name:o}),S.push({name:"Leads"})}const z=c(!1),C=c(!1),x=c(!1),p=c(""),I=c("");async function j(o){let e=!1;if(C.value&&!p.value){y({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(x.value&&!I.value){y({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(C.value&&p.value&&(t.data.salutation=w(p.value).salutation,t.data.first_name=w(p.value).first_name,t.data.last_name=w(p.value).last_name,t.data.email_id=w(p.value).email_id,t.data.mobile_no=w(p.value).mobile_no,C.value=!1,e=!0),x.value&&I.value&&(t.data.organization=I.value,x.value=!1,e=!0),e)O({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,organization:t.data.organization},"",()=>j(!0)),z.value=!1;else{let d=await B("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:t.data.name});d&&(o&&(await le.reload(),await se.reload()),S.push({name:"Deal",params:{dealId:d}}))}}const P=c(null);function _e(){P.value.emailBox.show=!0}return(o,e)=>{var q;const d=A("FeatherIcon"),u=A("Button"),U=A("ErrorMessage"),pe=A("Dialog");return r(),g(H,null,[a(t).data?(r(),_($e,{key:0},{"left-header":n(()=>[l(a(Ae),{items:me.value},null,8,["items"])]),"right-header":n(()=>{var s;return[a(t).data._customActions?(r(),_(Re,{key:0,actions:a(t).data._customActions},null,8,["actions"])):f("",!0),(r(),_(Q(((s=a(t).data._assignedTo)==null?void 0:s.length)==1?"Button":"div"),null,{default:n(()=>[l(Me,{avatars:a(t).data._assignedTo,onClick:e[0]||(e[0]=m=>V.value=!0)},null,8,["avatars"])]),_:1})),l(a(Z),{options:a(ne)("lead",b)},{default:n(({open:m})=>[l(u,{label:a(t).data.status,class:X(a(ie)(a(t).data.status).colorClass)},{prefix:n(()=>[l(Le)]),suffix:n(()=>[l(d,{name:m?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(u,{label:o.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=m=>z.value=!0)},null,8,["label"])]}),_:1})):f("",!0),(q=a(t))!=null&&q.data?(r(),g("div",sa,[l(a(oa),{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=s=>k.value=s),tabs:M.value},{default:n(({tab:s})=>[l(xe,{ref_key:"activities",ref:P,doctype:"CRM Lead",title:s.name,tabs:M.value,reload:N.value,"onUpdate:reload":e[2]||(e[2]=m=>N.value=m),tabIndex:k.value,"onUpdate:tabIndex":e[3]||(e[3]=m=>k.value=m),modelValue:a(t),"onUpdate:modelValue":e[4]||(e[4]=m=>Xe(t)?t.value=m:null)},null,8,["title","tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(fe,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[i("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=s=>a(Fe)(a(t).data.name))},v(o.__(a(t).data.name)),1),l(a(ta),{onSuccess:e[10]||(e[10]=s=>b("image",s.file_url)),validateFile:ue},{default:n(({openFileSelector:s,error:m})=>[i("div",la,[i("div",na,[l(a(Pe),{size:"3xl",class:"size-12",label:a(t).data.first_name||o.__("Untitled"),image:a(t).data.image},null,8,["label","image"]),(r(),_(Q(a(t).data.image?a(Z):"div"),Ye(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?o.__("Change image"):o.__("Upload image"),onClick:s},{icon:"trash-2",label:o.__("Remove image"),onClick:()=>b("image","")}]}:{onClick:s},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[i("div",ia,[l(ze,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),i("div",da,[l(a($),{text:a(t).data.lead_name||o.__("Set first name")},{default:n(()=>[i("div",ra,v(a(t).data.lead_name||o.__("Untitled")),1)]),_:1},8,["text"]),i("div",ma,[a(Y)?(r(),_(a($),{key:0,text:o.__("Make a call")},{default:n(()=>[l(u,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(t).data.mobile_no?a(oe)(a(t).data.mobile_no):a(R)(o.__("No phone number set")))},{default:n(()=>[l(G,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):f("",!0),l(a($),{text:o.__("Send an email")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(W,{class:"h-4 w-4",onClick:e[8]||(e[8]=E=>a(t).data.email?_e():a(R)(o.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a($),{text:o.__("Go to website")},{default:n(()=>[l(u,{class:"h-7 w-7"},{default:n(()=>[l(ge,{class:"h-4 w-4",onClick:e[9]||(e[9]=E=>a(t).data.website?a(Oe)(a(t).data.website):a(R)(o.__("No website set")))})]),_:1})]),_:1},8,["text"])]),l(U,{message:o.__(m)},null,8,["message"])])])]),_:1}),a(t).data.sla_status?(r(),_(ye,{key:0,modelValue:a(t).data,"onUpdate:modelValue":e[11]||(e[11]=s=>a(t).data=s),onUpdateField:b},null,8,["modelValue"])):f("",!0),a(D).data?(r(),g("div",ua,[i("div",ca,[(r(!0),g(H,null,Ze(a(D).data,(s,m)=>(r(),g("div",{key:s.label,class:X(["flex flex-col p-3",{"border-b":m!==a(D).data.length-1}])},[l(De,{"is-opened":s.opened,label:s.label},ea({default:n(()=>[l(we,{fields:s.fields,modelValue:a(t).data,"onUpdate:modelValue":e[12]||(e[12]=E=>a(t).data=E),onUpdate:b},null,8,["fields","modelValue"])]),_:2},[m==0&&a(de)()?{name:"actions",fn:n(()=>[l(u,{variant:"ghost",class:"w-7 mr-2",onClick:e[13]||(e[13]=E=>L.value=!0)},{default:n(()=>[l(be,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):f("",!0)]),_:1})])):f("",!0),V.value?(r(),_(Se,{key:2,modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=s=>V.value=s),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[15]||(e[15]=s=>a(t).data._assignedTo=s),doc:a(t).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):f("",!0),l(pe,{modelValue:z.value,"onUpdate:modelValue":e[20]||(e[20]=s=>z.value=s),options:{title:o.__("Convert to Deal"),size:"xl",actions:[{label:o.__("Convert"),variant:"solid",onClick:j}]}},{"body-content":n(()=>[i("div",_a,[l(Ue,{class:"h-4 w-4"}),i("label",pa,v(o.__("Organization")),1)]),i("div",fa,[i("div",va,[i("div",null,v(o.__("Choose Existing")),1),l(a(ee),{modelValue:x.value,"onUpdate:modelValue":e[16]||(e[16]=s=>x.value=s)},null,8,["modelValue"])]),x.value?(r(),_(J,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:I.value,doctype:"CRM Organization",onChange:e[17]||(e[17]=s=>I.value=s)},null,8,["value"])):(r(),g("div",ga,v(o.__("New organization will be created based on the data in details section")),1))]),i("div",ba,[l(Ee,{class:"h-4 w-4"}),i("label",Ca,v(o.__("Contact")),1)]),i("div",xa,[i("div",ya,[i("div",null,v(o.__("Choose Existing")),1),l(a(ee),{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=s=>C.value=s)},null,8,["modelValue"])]),C.value?(r(),_(J,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:p.value,doctype:"Contact",onChange:e[19]||(e[19]=s=>p.value=s)},null,8,["value"])):(r(),g("div",wa,v(o.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),L.value?(r(),_(ve,{key:3,modelValue:L.value,"onUpdate:modelValue":e[21]||(e[21]=s=>L.value=s)},null,8,["modelValue"])):f("",!0)],64)}}};export{dt as default};
//# sourceMappingURL=Lead-013a62a2.js.map
